<?xml version="1.0"?>
<!-- FRE Usage documentation: http://www.gfdl.noaa.gov/fms/fre -->
<!--
Quick start guide
This xml consists of 1/4 degree Ocean-Ice experiments with JRA version1.4 interannual forcings.

module load fre/bronx-15
fremake -x OMIP_JRA.xml -p ncrc4.intel16 -t prod MOM6_SIS2_compile
frerun  -x OMIP_JRA.xml -p ncrc4.intel16 -t prod OM4p125_JRA55do1.4_cycle1 -r basic
-->

<experimentSuite rtsVersion="4" xmlns:xi="http://www.w3.org/2001/XInclude">
  <property name="RELEASE"        value="xanadu_esm4_20190304"/>     <!-- git tag for general component source code-->
  <property name="SHARED_GIT_TAG" value="$(RELEASE)"/>               <!-- git tag for shared source code -->
  <property name="OCEAN_SHARED_GIT_TAG" value="$(RELEASE)"/>         <!-- git tag for ocean_shared source code -->
  <property name="MOM6_DATE"      value="2019.08.08"/>               <!-- git tag date for MOM6 source code -->
  <property name="MOM6_GIT_TAG"   value="ba839be"/>              <!-- git tag for MOM6 source code, actually MOM6-examples -->
  <property name="FRE_STEM"       value="$(RELEASE)_mom6_$(MOM6_DATE)"/> <!-- customize as needed -->
  <!-- Please make sure to change "YOURGROUPLETTER" to your group, such as b, f, g, m, o... -->
  <property name="GFDL_GROUP"     value="gfdl_o"/><!-- Replace YOURGROUPLETTER with GFDL group letter -->
  <property name="OM4_ANALYSIS"   value="ice_ocean_SIS2/OM4_025"/>  <!--example containing .frepp scripts for analysis-->
  <!--Production run properties. Users can modify these according to their need and/or performance analysis-->
  <property name="PROD_SIMTIME"   value="61"/>
  <!--Post-processing  chunk lengths -->
  <property name="CHUNK_LENGTH_1" value="1yr"/>
  <property name="CHUNK_LENGTH_A" value="5yr"/>
  <property name="CHUNK_LENGTH_B" value="20yr"/>
  <!--Start year of PP -->
  <property name="PP_START_YEAR"   value="1958"/>      <!--Use these values for CORE2 dynamic forcing runs -->
  <property name="PP_FINAL_YEAR"   value="2018"/>      <!--JRA 1958-2018 needs 1yr pp for last year -->
  <property name="FRE_VERSION"     value="bronx-16"/> <!-- fre version to be used -->
  <property name="ProjectID"       value="CMIP6"/>      <!-- database top level -->
  <property name="ANALYSIS_SWITCH" value="on"/>       <!-- on/off switch for ATM/LND analysis -->
  <!--pp fixer scripts for CMIP6-->
  <property name="CMIP6_PP_FIXER_SCRIPTS_DIR" value="/home/oar.gfdl.cmip6/CMIP6_publishing/pp_fixer_scripts"/>
  <property name="CMIP6_PP_FIXER_SWITCH" value="off"/>

  <!--Users need not change the following properties -->
  <property name="reference_tag"  value="xanadu_esm4_20190304_mom6_2019.08.08"/> <!-- Reference answers for frecheck -->
  <!-- The following properties are for testing/debugging purposes and should normally be empty-->
  <property name="DEBUGLEVEL" value=""/>
  <property name="PLATINFO"   value=""/>  <!--This is necessary only if you want to run exact same experiment on multiple platforms-->

  <property name="AWG_INPUT_HOME_GAEA"  value="awg_include"/>
  <property name="AWG_INPUT_HOME_GFDL"  value="/nbhome/$USER/$(FRE_STEM)$(PLATINFO)/$(name)/mdt_xml/awg_include"/>
  <property name="gfdlO_pdata"     value="/lustre/f2/pdata/gfdl/gfdl_O"/>

  <!--JRA dataset location. There are used in awg_include/xml_building_blocks/om4_common.xml-->
  <property name="append_to_setup_csh"  value="set fyear=1958"/><!--The start year of forcing dataseti. FRE hack to set fyear.-->
  <property name="JRA_dataset"     value="/lustre/f2/pdata/gfdl/gfdl_O/datasets/reanalysis/JRA55-do/v1.4.0/"/>
  <property name="JRA_dataset_8th" value="/lustre/f2/dev/Raphael.Dussin/forcings/OM4_125_runoff/"/>

  <setup>
    <xi:include href="awg_include/xml_building_blocks/platforms.xml" xpointer="xpointer(//freInclude/platform[@name='ncrc4.intel16'])"/>
    <xi:include href="awg_include/xml_building_blocks/platforms.xml" xpointer="xpointer(//freInclude/platform[@name='ncrc3.intel16'])"/>
    <xi:include href="awg_include/xml_building_blocks/platforms.xml" xpointer="xpointer(//freInclude/platform[@name='gfdl.ncrc4-intel16'])"/>
    <xi:include href="awg_include/xml_building_blocks/platforms.xml" xpointer="xpointer(//freInclude/platform[@name='gfdl.ncrc3-intel16'])"/>
  </setup>

  <freInclude name="resourceparams_O9084p125_production">
	     <resources jobWallclock="15:59:00"  segRuntime="7:58:00">
               <ocn ranks="9084" layout = "120,112"   io_layout = "4,4" mask_table="mask_table.4356.120x112" threads="1"/>
               <ice              layout = "120,112"   io_layout = "4,4" mask_table="mask_table.4356.120x112"/>
             </resources>
  </freInclude>

   <!--= COMPILE =-->
   <property name="PROG_MAIN"   value="coupler/coupler_main.o"/>
   <property name="LIBS_ROOT"   value="MOM6_SIS2_compile"/>
   <property name="FMS_LIB_DIR" value="./$(LIBS_ROOT)/$(platform)-$(target)/exec"/>
   <property name="MY_LIBS"     value="$(EXEC_ROOT)/$(FMS_LIB_DIR)"/>
   <experiment name="MOM6_SIS2_compile">
      <description>
Make the executable for ocean-ice experiments.
      </description>
    <component name="fms" paths="FMS/amip_interp FMS/column_diagnostics FMS/diag_integral FMS/fft FMS/horiz_interp FMS/memutils FMS/oda_tools FMS/sat_vapor_pres FMS/topography FMS/astronomy FMS/constants  FMS/diag_manager FMS/field_manager FMS/include FMS/monin_obukhov FMS/platform FMS/station_data FMS/tracer_manager FMS/axis_utils FMS/coupler FMS/drifters FMS/fms FMS/interpolator FMS/mosaic FMS/random_numbers FMS/time_interp FMS/tridiagonal FMS/block_control  FMS/data_override       FMS/exchange  FMS/fv3gfs  FMS/mpp FMS/time_manager">
     <description domainName="infrastructure" communityName="FMS" communityVersion="$(RELEASE)" communityGrid=""/>
      <source versionControl="git" root="https://github.com/NOAA-GFDL">
            <codeBase version="$(RELEASE)"> FMS.git </codeBase>
      	    <csh><![CDATA[
              ( cd FMS && git checkout $(SHARED_GIT_TAG) )
              ]]>
            </csh>
      </source>
      <compile>
            <cppDefs>-Duse_libMPI -Duse_netCDF $(F2003_FLAGS) -DMAXFIELDMETHODS_=400</cppDefs>
      </compile>
    </component>

    <component name="mom6" requires="fms" paths="mom6/src/MOM6/config_src/dynamic mom6/src/MOM6/config_src/coupled_driver mom6/src/MOM6/src/*/ mom6/src/MOM6/src/*/*/ ocean_shared/generic_tracers ocean_shared/mocsy/src">
      <description domainName="Ocean" communityName="GFDL-MOM6" communityVersion="$(MOM6_GIT_TAG)" communityGrid="Tripolar"/>
       <source versionControl="git" root="http://gitlab.gfdl.noaa.gov/fms">
        <codeBase version="$(OCEAN_SHARED_GIT_TAG)"> ocean_shared.git </codeBase>
        <csh><![CDATA[
          git clone https://github.com/NOAA-GFDL/MOM6-examples.git mom6
          pushd mom6
          git checkout $(MOM6_GIT_TAG)  #needed for older git on zeus
          git submodule init src/MOM6 src/SIS2 src/icebergs tools/python/MIDAS
          git clone --recursive https://github.com/NOAA-GFDL/MOM6.git src/MOM6
          git clone             https://github.com/NOAA-GFDL/SIS2.git src/SIS2
          git clone             https://github.com/NOAA-GFDL/icebergs.git src/icebergs
          git submodule update #This gets the right version of submodules
          popd

          pushd mom6
          set platform_domain = `perl -T -e "use Net::Domain(hostdomain) ; print hostdomain"`
          if ("${platform_domain}" =~ *"fairmont.rdhpcs.noaa.gov"* ) then
            ln -s /scratch4/GFDL/gfdlscr/pdata/gfdl_O/datasets/ .datasets
          else if ("${platform_domain}" =~ *"ccs.ornl.gov"* ) then
            ln -s /lustre/atlas/proj-shared/cli061/pdata/gfdl_O/datasets/ .datasets
          else
            ln -s /lustre/f2/pdata/gfdl/gfdl_O/datasets/ .datasets
          endif
          popd

          test -e mom6/.datasets
          if ($status != 0) then
            echo ""; echo "" ; echo "   WARNING:  .datasets link in MOM6 examples directory is invalid"; echo ""; echo ""
          endif

        ]]></csh>
      </source>
      <compile>
        <cppDefs><![CDATA[ $(F2003_FLAGS) -DMAX_FIELDS_=100 -DNOT_SET_AFFINITY -D_USE_MOM6_DIAG -D_USE_GENERIC_TRACER  -DUSE_PRECISION=2 -D_FILE_VERSION="'"`git-version-string $<`"'" ]]></cppDefs>
        <!--makeOverrides>OPENMP=""</makeOverrides>  openmp switch for MOM6 may cause crash -->
      </compile>
    </component>

      <component name="sis2" paths="mom6/src/SIS2/config_src/dynamic_symmetric mom6/src/SIS2/src mom6/src/icebergs ice_param" requires="fms mom6" includeDir="$root/$(LIBS_ROOT)/src/mom6/src/MOM6/src/framework" >
         <description domainName="Sea Ice SIS2" communityName="GFDL-SIS2" communityVersion="$(RELEASE)" communityGrid="Tripolar"/>
         <source versionControl="git" root="https://github.com/NOAA-GFDL">
	   <codeBase version="$(RELEASE)"> ice_param.git </codeBase>
         </source>
         <compile>
            <cppDefs><![CDATA[$(F2003_FLAGS) -D_FILE_VERSION="'"`git-version-string $<`"'"]]></cppDefs>
         </compile>
      </component>

      <component name="land_null" paths="land_null" requires="fms">
         <description domainName="NA" communityName="NA" communityVersion="NA" communityGrid="NA"/>
         <source versionControl="git" root="https://github.com/NOAA-GFDL">
            <codeBase version="$(RELEASE)"> land_null.git </codeBase>
         </source>
      </component>

      <component name="atmos_null" paths="atmos_null" requires="fms">
         <source versionControl="git" root="https://github.com/NOAA-GFDL">
           <codeBase version="$(RELEASE)"> atmos_null.git </codeBase>
         </source>
         <compile>
            <cppDefs>$(F2003_FLAGS) </cppDefs>
        </compile>
      </component>
      <component name="coupler" paths="coupler" requires="fms land_null atmos_null sis2 mom6">
        <description domainName="FMS Coupler" communityName="coupler" communityVersion="$(RELEASE)" communityGrid=""/>
        <source versionControl="git" root="https://github.com/NOAA-GFDL">
          <codeBase version="$(RELEASE)"> coupler.git </codeBase>
        </source>
        <compile>
            <cppDefs><![CDATA[$(F2003_FLAGS) -D_USE_LEGACY_LAND_ -Duse_AM3_physics -D_FILE_VERSION="'"`git-version-string $<`"'"]]></cppDefs>
        </compile>
      </component>
   </experiment>

   <!--The property MOM6_EXAMPLES should point to the mom6 directory that is checked out. It is needed by MOM6 to access its input data files-->
   <property name="MOM6_EXAMPLES"  value="$root/$(LIBS_ROOT)/src/mom6"/>

   <!--****************************************************************************************-->
   <!--***************************** 1/8 degree experiments        ****************************-->
   <!--****************************************************************************************-->

   <experiment name="OM4p125_JRA55do1.4_r6_cycle1" inherit="MOM6_SIS2_compile">
    <description>
global 1/8 degree z ocean_ice experiment
regridded runoff and salinity
JRA55do1-4 dynamic inter_annual forcing data
No additional diurnal cycle imposed
Use downsampled diagnostics _d2
ADJUST_NET_FRESH_WATER_TO_ZERO  = True
READ_TIDEAMP = True
#override KAPPA_H2_FACTOR = 2.8  ! increase from 0.84 recommended by Matt
    </description>
    <input>
      <namelist name="coupler_nml">
       months = $months,
       days   = $days,
       current_date = 1958,1,1,0,0,0,
       hours = 0
       minutes = 0
       seconds = 0
       calendar = 'julian',
       dt_cpld  = 3600,
       dt_atmos = 3600,
       do_atmos = .false.,
       do_land = .false.,
       do_ice = .true.,
       do_ocean = .true.,
       atmos_npes = 0,
       ocean_npes = 0,
       concurrent = .false.
       use_lag_fluxes=.false.
       atmos_nthreads = $atm_threads
       ocean_nthreads = $ocn_threads
     </namelist>
     <namelist name="xgrid_nml">
       make_exchange_reproduce = .true.
       interp_method = 'second_order'
     </namelist>
     <namelist name="fms_nml">
       clock_grain='ROUTINE'
       clock_flags='NONE'
       domains_stack_size = 8000000
       stack_size =0
     </namelist>
     <namelist name="fms_io_nml" >
       fms_netcdf_restart=.true.
       threading_read='multi'
       max_files_r = 800
       max_files_w = 800
     </namelist>
     <namelist name="atmos_model_nml" >
       layout= 0, 0
     </namelist>
     <!--verona-->
     <namelist name="sat_vapor_pres_nml">
      construct_table_wrt_liq = .true.,
      construct_table_wrt_liq_and_ice = .true.,
     </namelist>

     <dataFile label="namelist" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_EXAMPLES)/ice_ocean_SIS2/OM4_025/input.nml</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/ice_ocean_SIS2/OM4_025/input.nml</dataSource>
     </dataFile>

     <!--common setup for JRA forcing dataset and data_table-->
     <xi:include href="awg_include/xml_building_blocks/om4_common.xml" xpointer="xpointer(//freInclude[@name='OM4_JRA_always_csh']/input/node())"/>
     <xi:include href="awg_include/xml_building_blocks/om4_common.xml" xpointer="xpointer(//freInclude[@name='JRA_data_table']/input/node())"/>
     <!--append the resolution dependent runoff override-->
     <dataTable order="append">
#JRA runoff
"ICE" , "runoff"        , "friver"      , "./INPUT/JRA_friver_2880x2240.nc", "none" ,  1.0
"ICE" , "calving"       , "licalvf"     , "./INPUT/JRA_licalvf_2880x2240.nc", "none" ,  1.0
     </dataTable>

     <!--OM4 gridSpec mosaic datasets-->
     <xi:include xpointer="xpointer(//freInclude[@name='OM4p125_grid']/input/node())"/>
     <!--MOM6 Input datasets-->
     <xi:include xpointer="xpointer(//freInclude[@name='OM4p125_data']/input/node())"/>
     <!--SIS2 Input datasets-->
     <xi:include xpointer="xpointer(//freInclude[@name='SIS2p125_data']/input/node())"/>

     <!--diag_tables-->
     <diagTable>
$name
$baseDate
     </diagTable>

     <!--field_tables-->
     <dataFile label="fieldTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_EXAMPLES)/ice_ocean_SIS2/OM4_025/field_table</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/ice_ocean_SIS2/OM4_025/field_table</dataSource>
     </dataFile>

     <!--MOM_overrides-->
     <csh>
        <![CDATA[
if ( $currentSeg == 1 ) then
   #Take current date from coupler_nml
   if(-e $work/INPUT/coupler.res ) \rm -rf $work/INPUT/coupler.res
endif

cat > $work/INPUT/MOM_override << MOM_OVERRIDE_EOF
#override NIGLOBAL = 2880
#override NJGLOBAL = 2240
#override TOPO_EDITS_FILE = ""
#override TIDEAMP_FILE = "tidal_amplitude.v20181107.nc"
#override KAPPA_H2_FACTOR = 2.8  ! increase from 0.84 recommended by Matt
#override CHL_FILE = "seawifs-clim-1997-2010.2880x2240.v20190815.nc"
#override SALT_RESTORE_FILE = "salt_restore_PHC2.2880x2240.v20190815.nc"
#override SALT_RESTORE_VARIABLE = "SALT"  ! default = "sos"
#override DT = 300.0                      !   [s] !reduced from 900.0 for OM4_025
#override DT_THERM = 3600.0               !   [s] !reduced from 7200.0 for OM4_025
#override BAD_VAL_SST_MIN = -5.0  ! decreased from default of -3.0 to avoid extremes in 1/8 degree model
#override U_TRUNC_FILE = "MOM_U_truncations"
#override V_TRUNC_FILE = "MOM_V_truncations"
MOM_OVERRIDE_EOF

cat > $work/INPUT/SIS_override << SIS_OVERRIDE_EOF
#override NIGLOBAL = 2880
#override NJGLOBAL = 2240
#override DT_ICE_DYNAMICS = 450 !reduced from 1200.0 for OM4_025
#override DT_RHEOLOGY = 25.0
#override U_TRUNC_FILE = "SIS_U_truncations"
#override V_TRUNC_FILE = "SIS_V_truncations"
SIS_OVERRIDE_EOF

     ]]></csh>

   </input>

    <runtime>
      <production simTime="$(PROD_SIMTIME)" units="years">
          <segment simTime="12" units="months"/>
          <xi:include xpointer="xpointer(//freInclude[@name='resourceparams_O9084p125_production']/node())"/>
      </production>
      <regression name="basic">
        <run months="1" > <xi:include href="awg_include/xml_building_blocks/layouts.xml" xpointer="xpointer(//freInclude[@name='resourceparams_O2085p125']/node())"/> </run>
      </regression>
      <regression name="rts">
        <run days="15 16" > <xi:include href="awg_include/xml_building_blocks/layouts.xml" xpointer="xpointer(//freInclude[@name='resourceparams_O2085p125']/node())"/> </run>
        <run months="1" > <xi:include href="awg_include/xml_building_blocks/layouts.xml" xpointer="xpointer(//freInclude[@name='resourceparams_O2880']/node())"/> </run>
         <run days="2" > <xi:include href="awg_include/xml_building_blocks/layouts.xml" xpointer="xpointer(//freInclude[@name='resourceparams_O2240']/node())"/> </run>
         <run days="2" > <xi:include href="awg_include/xml_building_blocks/layouts.xml" xpointer="xpointer(//freInclude[@name='resourceparams_O1600']/node())"/> </run>
      </regression>
      <regression name="debug">
        <run days="2" >   <xi:include href="awg_include/xml_building_blocks/layouts.xml" xpointer="xpointer(//freInclude[@name='resourceparams_O1600']/node())"/> </run>
        <run days="1 1" > <xi:include href="awg_include/xml_building_blocks/layouts.xml" xpointer="xpointer(//freInclude[@name='resourceparams_O1600']/node())"/> </run>
      </regression>
      <regression name="timing">
        <run months="1" > <xi:include href="awg_include/xml_building_blocks/layouts.xml" xpointer="xpointer(//freInclude[@name='resourceparams_O2085p125']/node())"/> </run>
        <run months="1" > <xi:include href="awg_include/xml_building_blocks/layouts.xml" xpointer="xpointer(//freInclude[@name='resourceparams_O2902p125']/node())"/> </run>
        <run months="1" > <xi:include href="awg_include/xml_building_blocks/layouts.xml" xpointer="xpointer(//freInclude[@name='resourceparams_O3649p125']/node())"/> </run>
        <run months="1" > <xi:include href="awg_include/xml_building_blocks/layouts.xml" xpointer="xpointer(//freInclude[@name='resourceparams_O4509p125']/node())"/> </run>
        <run months="1" > <xi:include href="awg_include/xml_building_blocks/layouts.xml" xpointer="xpointer(//freInclude[@name='resourceparams_O9084p125']/node())"/> </run>
        <run months="1" > <xi:include href="awg_include/xml_building_blocks/layouts.xml" xpointer="xpointer(//freInclude[@name='resourceparams_O11270p125']/node())"/> </run>
      </regression>
      <reference restart="$(REFERENCE)/archive/1x0m2d_1600x1o/restart/19580103.tar"/>
    </runtime>

    <postProcess>
      <csh><![CDATA[
         cd $work
         #Make a directory to trick FRE to pick up and archive in ascii
         mkdir extra.results
         mv *velocity_truncations MOM_parameter_doc* SIS_parameter_doc* seaice.stats* ocean.stats* extra.results/
         #When the ocean uses a mask_table the ocean_static.nc file produced by the model run has holes in coordinates (geolon,geolat)
         #This causes problems for ferret and python tools for analysis.
         #Copy a non-masked version of ocean_static.nc to be saved as a history file to be used by the analysis scipts .
         cp $work/INPUT/ocean_static_no_mask_table.nc $work/
      ]]></csh>
      <refineDiag script="$(NB_ROOT)/mom6/tools/analysis/MOM6_refineDiag.csh  $(NB_ROOT)/mdt_xml/awg_include/refineDiag/refineDiag_data_stager_globalAve.csh"/>
      <xi:include xpointer="xpointer(//freInclude[@name='OM4_cmip6_postprocess_p125']/postProcess/node())"/>
    </postProcess>
   </experiment>

   <!--This is how to run the next cycles of an experiment. Replace the initCond with the actual last year restart of the previous cycle-->
   <experiment name="OM4p125_JRA55do1.4_r6_cycle2" inherit="OM4p125_JRA55do1.4_r6_cycle1">
    <input>
     <!--Replace the initCond dataSource with the actual last year restart of the previous cycle-->
     <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
      <dataSource platform="$(platform)">lustre/f2/scratch/oar.gfdl.ogrp-account/CMIP6/OMIP/xanadu_mom6_20181101/OM4p125_IAF_csf_JRA55do1-4_r5_cycle1/ncrc4.intel16f2-prod/archive/restart/20180101.tar</dataSource>
     </dataFile>
     <!--There is  MOM6/SIS2 restart provided in initCond.-->
     <namelist name="MOM_input_nml" >
         output_directory = './',
         input_filename = 'r'
         restart_input_dir = 'INPUT/',
         restart_output_dir = 'RESTART/',
         parameter_filename = 'INPUT/MOM_input','INPUT/MOM_layout','INPUT/MOM_override','INPUT/MOM_saltrestore'
     </namelist>
     <namelist name="SIS_input_nml" >
         output_directory = './',
         input_filename = 'r'
         restart_input_dir = 'INPUT/',
         restart_output_dir = 'RESTART/',
         parameter_filename = 'INPUT/SIS_input','INPUT/SIS_layout','INPUT/SIS_override'
     </namelist>
    </input>
   </experiment>

   <freInclude name="OM4p125_grid">
    <input>
      <dataFile label="gridSpec" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">/lustre/f2/dev/Raphael.Dussin/input/xanadu/OM4p125_grid/OM4p125_grid_20190822_merged_bathy.tar</dataSource>
        <dataSource site="gfdl">/archive/Raphael.Dussin/datasets/OM4p125/OM4p125_grid_20190822_merged_bathy.tar</dataSource>
      </dataFile>
    </input>
   </freInclude>

   <freInclude name="OM4p125_data">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/ice_ocean_SIS2/OM4_025.JRA/MOM_input</dataSource>
      </dataFile>
      <!--salt restore data file is included in the grid tar-->
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/ice_ocean_SIS2/OM4_025.JRA/MOM_saltrestore</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       <!--The following is a copy of /lustre/f1/unswept/Matthew.Harrison/MOM6_datasets/GIS_0125/tikal/tidal_amplitude.nc -->
       <dataSource platform="$(platform)">$(ARCHIVE_NNZ)/input/xanadu/OM4p125_grid/tidal_amplitude.v20181107.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/ice_ocean_SIS2/OM4_025.JRA/INPUT/MOM_channels_global_025</dataSource>
      </dataFile>
      <!--seawif data file is included in the grid tar-->
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/ice_ocean_SIS2/OM4_025.JRA/INPUT/hycom1_75_800m.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/ice_ocean_SIS2/OM4_025.JRA/INPUT/All_edits.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/ice_ocean_SIS2/OM4_025.JRA/INPUT/woa13_decav_ptemp_monthly_fulldepth_01.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/ice_ocean_SIS2/OM4_025.JRA/INPUT/woa13_decav_s_monthly_fulldepth_01.nc</dataSource>
      </dataFile>
      <!--geothermal data file is included in the grid tar-->

     <!--Due to high resolution of this experiment it is not recommended to run with the full MOM6 diag_table-->
     <!--A set of downsampled diagnotics-->
     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table.MOM6.d2sample</dataSource>
     </dataFile>
     <diagTable order="append">
#TKE_tidal diagnostics needed for tuning KAPPA_H2_FACTOR
"ocean_annual",               12, "months",   1, "days", "time"
"ocean_model",   "TKE_tidal",        "TKE_tidal",          "ocean_annual",   "mean", "none", "none",2
"ocean_model",   "TKE_itidal",       "TKE_itidal",         "ocean_annual",   "mean", "none", "none",2
    </diagTable>

      <namelist name="MOM_input_nml" >
         output_directory = './',
         input_filename = '$restart_flag'
         restart_input_dir = 'INPUT/',
         restart_output_dir = 'RESTART/',
         parameter_filename = 'INPUT/MOM_input','INPUT/MOM_layout','INPUT/MOM_saltrestore','INPUT/MOM_override'
     </namelist>

     <!--mask_table files are included in the grid tar-->

     </input>
   </freInclude>

   <freInclude name="SIS2p125_data">
    <input>
<!--Due to high resolution of this experiment do not use the full SIS2 diag_table
     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_EXAMPLES)/ice_ocean_SIS2/OM4_025.JRA/diag_table.SIS</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/ice_ocean_SIS2/OM4_025.JRA/diag_table.SIS</dataSource>
     </dataFile>
-->
     <diagTable order="append">
#
#A short subset od seaice diagnotics for 1/8 degree models
#
"ice_month",              1, "months", 1, "days", "time"
"ice_model", "EXT",        "EXT",          "ice_month", "all", "mean", "none", 2
"ice_model", "siu",        "siu",          "ice_month", "all", "mean", "none", 2
"ice_model", "siv",        "siv",          "ice_month", "all", "mean", "none", 2
"ice_model", "siconc",     "siconc",       "ice_month", "all", "mean", "none", 2
"ice_model", "sisnconc",   "sisnconc",     "ice_month", "all", "mean", "none", 2
"ice_model", "simass",     "simass",       "ice_month", "all", "mean", "none", 2
"ice_model", "sisnmass",   "sisnmass",     "ice_month", "all", "mean", "none", 2
"ice_model", "sisnthick",  "sisnthick",    "ice_month", "all", "mean", "none", 2
"ice_model", "sithick",    "sithick",      "ice_month", "all", "mean", "none", 2
"ice_model", "sivol",      "sivol",        "ice_month", "all", "mean", "none", 2
"ice_model", "MIB",        "MIB",          "ice_month", "all", "mean", "none", 2
     </diagTable>

     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/ice_ocean_SIS2/OM4_025/SIS_input</dataSource>
     </dataFile>
     <namelist name="SIS_input_nml" >
         output_directory = './',
         input_filename = '$restart_flag'
         restart_input_dir = 'INPUT/',
         restart_output_dir = 'RESTART/',
         parameter_filename = 'INPUT/SIS_input','INPUT/SIS_layout','INPUT/SIS_override'
     </namelist>
     </input>
   </freInclude>

   <freInclude name="OM4_cmip6_postprocess_p125">
   <postProcess>
      <!--PostProcessing component models-->
      <component type="ocean_daily_cmip" source="ocean_daily" sourceGrid="ocean-tripolar" cmip="on">
        <timeSeries freq="daily" chunkLength="$(CHUNK_LENGTH_A)">
          <variables>sos tos zos</variables>
        </timeSeries>
      </component>

      <component type="ocean_annual_z" start="$(PP_START_YEAR)" source="ocean_annual_z"  sourceGrid="ocean-tripolar" cmip="on">
        <timeAverage source="annual" interval="$(CHUNK_LENGTH_A)">
          <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(NB_ROOT)/mom6/$(OM4_ANALYSIS)/ocn_annual_z.frepp"/>
          <analysis switch="$(ANALYSIS_SWITCH)" cumulative="yes" script="$(AWG_INPUT_HOME)/analysis/stub/atw_ocean_av_annual_subsfc_ocean.csh -D ocean_annual_z.%04d-%04d."/>
        </timeAverage>
        <timeAverage source="annual" interval="$(CHUNK_LENGTH_B)">
          <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(NB_ROOT)/mom6/$(OM4_ANALYSIS)/ocn_annual_z.frepp"/>
        </timeAverage>
        <timeSeries freq="annual"  chunkLength="$(CHUNK_LENGTH_A)" source="ocean_annual_z"/>
      </component>

      <!--Ocean scalars-->
      <component type="ocean_scalar_monthly" start="$(PP_START_YEAR)" source="ocean_scalar_month" sourceGrid="ocean-tripolar" cmip="on">
        <timeSeries freq="monthly" chunkLength="$(CHUNK_LENGTH_A)" source="ocean_scalar_month"/>
        <timeAverage source="monthly" interval="$(CHUNK_LENGTH_A)"/>
        <timeAverage source="monthly" interval="$(CHUNK_LENGTH_B)"/>
      </component>

      <component type="ocean_scalar_annual"  start="$(PP_START_YEAR)" source="ocean_scalar_annual" sourceGrid="ocean-tripolar" cmip="on">
        <timeSeries freq="annual"   chunkLength="$(CHUNK_LENGTH_A)" source="ocean_scalar_annual"/>
        <timeAverage source="annual" interval="$(CHUNK_LENGTH_A)"/>
        <timeAverage source="annual" interval="$(CHUNK_LENGTH_B)"/>
      </component>

      <!--ICE-->
      <component type="ice"  start="$(PP_START_YEAR)"  source="ice_month"  sourceGrid="ocean-tripolar" cmip="on">
        <timeSeries freq="monthly" chunkLength="$(CHUNK_LENGTH_A)"  source="ice_month">
	   <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(NB_ROOT)/mom6/tools/analysis/Krasting-SeaIce.csh"/>
           <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(CMIP6_PP_FIXER_SCRIPTS_DIR)/seaice_units.csh -c ice"/>
           <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(CMIP6_PP_FIXER_SCRIPTS_DIR)/sivol.csh -c ice"/>
	</timeSeries>
        <timeAverage source="annual"  interval="$(CHUNK_LENGTH_A)"/>
        <timeAverage source="annual"  interval="$(CHUNK_LENGTH_B)"/>
      </component>
<!--The 1/8 degree grid needs a remap file different from the one that frepp uses by default.
    In the components we provide this remap file via a label="xyInterpRegridFile"-->
      <component type="ocean_annual_z_1x1deg" source="ocean_annual_z" sourceGrid="ocean-tripolar" xyInterp="180,360" cmip="on">
        <dataFile label="xyInterpRegridFile">
/archive/Niki.Zadeh/input/xanadu/OM4p125_grid/OM4p125_grid_20190822_merged_bathy_remap_file_5760x4480_to_360x180.nc
        </dataFile>
        <timeSeries freq="annual" chunkLength="$(CHUNK_LENGTH_A)"/>
        <timeAverage source="annual" interval="$(CHUNK_LENGTH_A)"/>
      </component>
      <component type="ice_1x1deg"  source="ice_month" sourceGrid="ocean-tripolar" xyInterp="180,360" cmip="on">
        <dataFile label="xyInterpRegridFile">
/archive/Niki.Zadeh/input/xanadu/OM4p125_grid/OM4p125_grid_20190822_merged_bathy_remap_file_5760x4480_to_360x180.nc
        </dataFile>
        <timeSeries freq="monthly" chunkLength="$(CHUNK_LENGTH_A)">
           <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(CMIP6_PP_FIXER_SCRIPTS_DIR)/seaice_units.csh -c ice_1x1deg"/>
           <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(CMIP6_PP_FIXER_SCRIPTS_DIR)/sivol.csh -c ice_1x1deg"/>
        </timeSeries>
        <timeAverage source="annual"  interval="$(CHUNK_LENGTH_A)"/>
      </component>

      <!--d2 pp-->
      <component type="ocean_monthly_z_d2" start="$(PP_START_YEAR)"  source="ocean_month_z_d2" sourceGrid="ocean-tripolar">
        <timeSeries freq="monthly" chunkLength="$(CHUNK_LENGTH_B)" source="ocean_month_z_d2"/>
        <timeAverage source="monthly" interval="$(CHUNK_LENGTH_A)"/>
      </component>
      <component type="ocean_annual_rho2_d2"  start="$(PP_START_YEAR)" source="ocean_annual_rho2_d2" sourceGrid="ocean-tripolar">
        <timeSeries freq="annual"   chunkLength="$(CHUNK_LENGTH_B)" source="ocean_annual_rho2_d2"/>
        <timeAverage source="annual" interval="$(CHUNK_LENGTH_A)"/>
        <timeAverage source="annual" interval="$(CHUNK_LENGTH_B)"/>
      </component>
      <component type="ocean_annual_z_d2" start="$(PP_START_YEAR)" source="ocean_annual_z_d2"  sourceGrid="ocean-tripolar">
        <timeAverage source="annual" interval="$(CHUNK_LENGTH_A)">
          <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(NB_ROOT)/mom6/$(OM4_ANALYSIS)/ocn_annual_z.frepp"/>
        </timeAverage>
        <timeAverage source="annual" interval="$(CHUNK_LENGTH_B)">
          <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(NB_ROOT)/mom6/$(OM4_ANALYSIS)/ocn_annual_z.frepp"/>
        </timeAverage>
        <timeSeries freq="annual"  chunkLength="$(CHUNK_LENGTH_B)" source="ocean_annual_z_d2"/>
      </component>
      <!-- currenlty no ocean_daily diags
      <component type="ocean_daily_1x1deg" source="ocean_daily" sourceGrid="ocean-tripolar" xyInterp="180,360" cmip="on">
        <dataFile label="xyInterpRegridFile">
/archive/Niki.Zadeh/input/xanadu/OM4p125_grid/OM4p125_grid_20190822_merged_bathy_remap_file_5760x4480_to_360x180.nc
        </dataFile>
        <timeSeries freq="daily" chunkLength="$(CHUNK_LENGTH_A)"/>
      </component>
      -->
      <!-- currenlty no ocean_monthly diags
      <component type="ocean_monthly_1x1deg" start="$(PP_START_YEAR)" source="ocean_month" sourceGrid="ocean-tripolar" xyInterp="180,360" cmip="on">
        <dataFile label="xyInterpRegridFile">
/archive/Niki.Zadeh/input/xanadu/OM4p125_grid/OM4p125_grid_20190822_merged_bathy_remap_file_5760x4480_to_360x180.nc
        </dataFile>
        <timeSeries freq="monthly" chunkLength="$(CHUNK_LENGTH_A)" source="ocean_month">
          <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(CMIP6_PP_FIXER_SCRIPTS_DIR)/hfevapds.csh -c ocean_monthly_1x1deg"/>
          <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(NB_ROOT)/mom6/$(OM4_ANALYSIS)/ocn_monthly.frepp"/>
        </timeSeries>
      </component>
      <component type="ocean_monthly_z_1x1deg" source="ocean_month_z" sourceGrid="ocean-tripolar" xyInterp="180,360" cmip="on">
        <dataFile label="xyInterpRegridFile">
/archive/Niki.Zadeh/input/xanadu/OM4p125_grid/OM4p125_grid_20190822_merged_bathy_remap_file_5760x4480_to_360x180.nc
        </dataFile>
        <timeSeries freq="monthly" chunkLength="$(CHUNK_LENGTH_A)">
           <analysis switch="on" cumulative="no" script="$(CMIP6_PP_FIXER_SCRIPTS_DIR)/zostoga.csh -t 1708"/>
        </timeSeries>
        <timeAverage source="monthly" interval="$(CHUNK_LENGTH_A)"/>
        <timeAverage source="annual" interval="$(CHUNK_LENGTH_A)"/>
      </component>
      <component type="ocean_annual_1x1deg" source="ocean_annual" sourceGrid="ocean-tripolar" xyInterp="180,360" cmip="on">
        <dataFile label="xyInterpRegridFile">
/archive/Niki.Zadeh/input/xanadu/OM4p125_grid/OM4p125_grid_20190822_merged_bathy_remap_file_5760x4480_to_360x180.nc
        </dataFile>
        <timeSeries freq="annual" chunkLength="$(CHUNK_LENGTH_A)">
          <variables>
             boundary_forcing_heat_tendency_2d  boundary_forcing_salt_tendency_2d  dispkexyfo evs  ficeberg  frazil_heat_tendency_2d
             friver                             heat_content_cond                           heat_content_fprec        heat_content_massin
             heat_content_massout               heat_content_surfwater                              Heat_PmE
             hfds                               hfevapds                                    hfibthermds               hflso
             hfrainds                           hfrunoffds                                  hfsifrazil                hfsnthermds
             hfsso                              LwLatSens                 mass_wt
             MEKE_KH                            MEKE_Le                                     MEKE_Ue                   MLD_003_max
             MLD_003_min                        MLD_003                                     mlotstmax                 mlotstmin
             mlotst                             mlotstsq                                    MSTAR                     net_heat_coupler
             net_massin                         net_massout                                 nonpenSW                  opottempmint
             opottemptend_2d                    osalttend_2d                                pbo                       prlq
             prsn                               pso                                         rlntds                    rsntds
             S_advection_xy_2d                  sfdsi                                       Sh_tendency_vert_remap_2d sob
             somint                             sos                                         sossq                     speed
             subML_N2                           T_advection_xy_2d                           Th_tendency_vert_remap_2d TKE_itidal
             TKE_tidal                          tob                       tos_max
             tos_min                            tos                                         tossq                     ustar
             wfo                                zos                                         zossq
          </variables>
        </timeSeries>

        <timeAverage source="annual" interval="10yr"/>
        <timeAverage source="annual" interval="$(CHUNK_LENGTH_A)"/>
      </component>
      -->
  </postProcess>
  </freInclude>
</experimentSuite>
