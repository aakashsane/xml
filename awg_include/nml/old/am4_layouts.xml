  <experiment name="c96_atmos_domain_decomp">
<!--
c96 means 96x96 grid points per face
fv_layout=X,Y means a domain decomposition of iec=96/X , jec=96/Y per face.
E.g.  fv_layout="3,24" gives:
  X-AXIS =   32  32  32
  Y-AXIS =    4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4

NOTE: In the follwoing npes is the number of PE cores reserved but it may NOT be equal to the actual number of PE's used.
      Since many of the following configurations use the same number of npes, I arbitarily incremented npes by 1 to distingush them.
      This would cost one node (32 cores) of resources.
      We should go back to use the override mechanism of FRE to avoid this.  
-->    
    <input>
      <csh><![CDATA[
# Some possible domain decompositionsn.
set do_ocean = "false"
set do_concurrent_radiation = ".false."
set domains_stack_size = "2097152"

if ( "$npes" == "432" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "576" ) then
  set atmos_npes = "288"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "4,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "4,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,4";  set ice_io_layout   =  "1,4"

else if ( "$npes" == "864" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "870" ) then
  set atmos_npes = "432"
  set do_concurrent_radiation = ".true.";set radiation_nthreads = "1"
  set atmos_nthreads = "1"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "1728" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "1729" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "12,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,12";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,12";  set ice_io_layout   =  "1,3"
else if ( "$npes" == "1730" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"
else if ( "$npes" == "1731" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "4"
  set nxblocks = "1" ; set nyblocks = "4" 
  set fv_layout    =   "3,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"
else if ( "$npes" == "1732" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "4"
  set nxblocks = "4" ; set nyblocks = "1" 
  set fv_layout    =   "3,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"
else if ( "$npes" == "1733" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "8"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ocean_layout =   "72,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "1740" ) then
  set atmos_npes = "432"
  set do_concurrent_radiation = ".true.";set radiation_nthreads = "2"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"
  set domains_stack_size = "2097152"

else if ( "$npes" == "2304" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2"
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8";  set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8";  set ice_io_layout   =  "1,4"

else if ( "$npes" == "2592" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
set do_concurrent_radiation = ".true." ; set radiation_nthreads = "1"
  set nxblocks = 2
  set nyblocks = 2
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "2688" ) then
  set atmos_npes = "672"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "8,14";  set fv_io_layout    =  "1,2"
  set land_layout  =   "8,14";  set land_io_layout  =  "1,2"
  set ice_layout   =   "112,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "112,6";   set ocn_io_layout =  "1,3"

else if ( "$npes" == "3072" ) then
  set atmos_npes = "768"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "8,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "128,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "128,6";   set ocn_io_layout =  "1,3"

else if ( "$npes" == "3456" ) then 
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2"
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,3"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "3458" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "8"
  set nxblocks = "4" ; set nyblocks = "2"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3"; set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"

else if ( "$npes" == "3470" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
set do_concurrent_radiation = ".true." ; set radiation_nthreads = "2"
  set nxblocks = 2
  set nyblocks = 2
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "3840" ) then 
  set atmos_npes = "960"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2"
  set fv_layout    =   "10,16";   set fv_io_layout    =  "1,4"
  set land_layout  =   "10,16";   set land_io_layout  =  "1,4"
  set ocean_layout =   "160,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "160,6";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "4224" ) then 
  set atmos_npes = "1056"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2"
  set fv_layout    =   "8,22";   set fv_io_layout    =  "1,2"
  set land_layout  =   "8,22";   set land_io_layout  =  "1,2"
  set ocean_layout =   "176,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "176,6";  set ice_io_layout   =  "1,3"


else if ( "$npes" == "4608" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "8"
  set nxblocks = "1" ; set nyblocks = "8" 
  set fv_layout    =   "8,12"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12"; set land_io_layout  =  "1,4"
  set ocean_layout =   "144,4"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"

else if ( "$npes" == "4609" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"

#FATAL from PE  4524: Domain Decomposition:  Cubed Sphere compute domain has a minium requirement of 4 points in X and Y
#This means components of fv_layout for c96 could at most be 96/4=24
#So, atmos_nthreads = 1 does not work for any npes > 24x24x6=3456
#else if ( "$npes" == "4609" ) then
#  set atmos_npes = "4608"
#  set atmos_nthreads = "1"
#  set nxblocks = "1" ; set nyblocks = "6" 
#  set fv_layout    =   "24,32"; set fv_io_layout    =  "1,4"
#  set land_layout  =   "24,32"; set land_io_layout  =  "1,4"
#  set ocean_layout =   "144,32"; set ocean_io_layout =  "1,4"
#  set ice_layout   =   "144,32"; set ice_io_layout   =  "1,4"
#FATAL from PE  2271: Domain Decomposition:  Cubed Sphere compute domain has a minium requirement of 4 points in X and Y, respectively

else if ( "$npes" == "6912" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "8"
  set nxblocks = "1" ; set nyblocks = "8"
  set fv_layout    =   "12,12";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,12";   set land_io_layout  =  "1,3"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "9216" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "8"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "8,24"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,24"; set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set domains_stack_size = "2097152"
else if ( "$npes" == "9217" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "24,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "24,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set domains_stack_size = "2097152"

else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in xml."
  if ( $echoOn ) set echo
  exit 1
endif

      ]]></csh>
      
    </input>
  </experiment>

  <experiment name="c192_atmos_domain_decomp">
    <input>
      <csh><![CDATA[
# Possible domain decomposition for c192 atmosphere only experiments (numbers from Rusty Benson).
set domains_stack_size = "3097152"
set do_ocean = "false"
set do_concurrent_radiation = ".false."

if ( "$npes" == "864" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "6,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,12";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3"; set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"


else if ( "$npes" == "1152" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,4"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"

else if ( "$npes" == "2304" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "4"
  set nxblocks = "3" ; set nyblocks = "8" 
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,4"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"


else if ( "$npes" == "3456" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set nxblocks = "4" ; set nyblocks = "4" 
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,6"; set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"

else if ( "$npes" == "4608" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "6" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"

else if ( "$npes" == "6144" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"

else if ( "$npes" == "6145" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set nxblocks = "3" ; set nyblocks = "3" 
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"

else if ( "$npes" == "6912" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "8"
  set nxblocks = "2" ; set nyblocks = "8"
  set fv_layout    =   "12,12";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,12";   set land_io_layout  =  "1,3"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "9216" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set nxblocks = "4" ; set nyblocks = "1" 
  set fv_layout    =   "24,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "24,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set domains_stack_size = "2097152"

else if ( "$npes" == "9217" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "8"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set domains_stack_size = "2097152"

else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in this xml."
  if ( $echoOn ) set echo
  exit 1
endif
      ]]></csh>

    </input>
  </experiment>

  <experiment name="c96_coupled_domain_decomp">
    <input>
      <csh><![CDATA[
# Coupled configurations
  set do_ocean = "true"
  set do_concurrent_radiation = ".false."

  set domains_stack_size = "2097152"


if ( "$npes" == "1584" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "1152"

else if ( "$npes" == "3168" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2304"

else if ( "$npes" == "1585" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "4" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "1152"

else if ( "$npes" == "1376" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "4" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.242.32x36"
  set ocean_npes = "910"

else if ( "$npes" == "1454" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "4" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "36,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.274.36x36"
  set ocean_npes = "1022"

else if ( "$npes" == "2208" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.548.32x72"
  set ocean_npes = "1756"

else if ( "$npes" == "2431" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "6,6";  set fv_io_layout    =  "1,3"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "36,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.622.36x72"
  set ocean_npes = "1970"

else if ( "$npes" == "2432" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "36,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.622.36x72"
  set ocean_npes = "1970"

else if ( "$npes" == "4672" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "72,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1402.72x72"
  set ocean_npes = "3782"

else if ( "$npes" == "2560" ) then
  set atmos_npes = "288"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "4,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "4,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,4";  set ice_io_layout   =  "1,4"
  set ocn_layout   =   "36,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.622.36x72"
  set ocean_npes = "1970"

else if ( "$npes" == "2561" ) then
  set atmos_npes = "288"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "4,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "4,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "96,3";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "36,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.622.36x72"
  set ocean_npes = "1970"

else if ( "$npes" == "4960" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2"
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "72,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1402.72x72"
  set ocean_npes = "3782"


else if ( "$npes" == "2880" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set ocean_npes   = "2432"

else if ( "$npes" == "2016" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,45"; set ocn_io_layout   =  "1,5"; set ocn_mask_table = "mask_table.315.32x45"
  set ocean_npes = "1125"

else if ( "$npes" == "2620" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.548.32x72"
  set ocean_npes = "1756"

else if ( "$npes" == "3296" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set ocean_npes   = "2432"

else if ( "$npes" == "3584" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2"
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set ocean_npes   = "2432"

else if ( "$npes" == "5279" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,12"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,12"; set land_io_layout  =  "2,4"
  set ice_layout   =   "72,12"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "90,54"; set ocn_io_layout   =  "2,6"; set ocn_mask_table = "mask_table.1309.90x54"
  set ocean_npes   = "3551"

else if ( "$npes" == "4704" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2"
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "90,54"; set ocn_io_layout   =  "2,6"; set ocn_mask_table = "mask_table.1309.90x54"
  set ocean_npes   = "3551"

else if ( "$npes" == "6975" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "2,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "90,72"; set ocn_io_layout   =  "2,4"; set ocn_mask_table = "mask_table.1809.90x72"
  set ocean_npes   = "4671"


else if ( "$npes" == "6400" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,12"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,12"; set land_io_layout  =  "2,4"
  set ice_layout   =   "72,12"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "90,72"; set ocn_io_layout   =  "2,4"; set ocn_mask_table = "mask_table.1809.90x72"
  set ocean_npes   = "4671"


####Experimental setups
else if ( "$npes" == "1600_1" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,45"; set ocn_io_layout   =  "1,5"; set ocn_mask_table = "mask_table.315.32x45"
  set ocean_npes = "1125"
else if ( "$npes" == "1472" ) then
#uses 1454 pes
  set atmos_npes = "432"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "36,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.274.36x36"
  set ocean_npes = "1022"
else if ( "$npes" == "2752" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2304"
else if ( "$npes" == "3169" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2304"

else if ( "$npes" == "4256" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1229.64x72"
  set ocean_npes = "3379"

else if ( "$npes" == "3456" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2304"

else if ( "$npes" == "2912" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.548.32x72"
  set ocean_npes = "1756"

else if ( "$npes" == "5824" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2"
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "90,72"; set ocn_io_layout   =  "2,4"; set ocn_mask_table = "mask_table.1809.90x72"
  set ocean_npes   = "4671"


else if ( "$npes" == "4160" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,12"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,12"; set land_io_layout  =  "2,4"
  set ice_layout   =   "72,12"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set ocean_npes   = "2432"

else if ( "$npes" == "5697" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "4"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1229.64x72"
  set ocean_npes = "3379"

else if ( "$npes" == "5696" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "2,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1229.64x72"
  set ocean_npes = "3379"


else if ( "$npes" == "6112" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "2,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "72,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1402.72x72"
  set ocean_npes = "3782"

else if ( "$npes" == "8128" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2"
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "90,72"; set ocn_io_layout   =  "2,4"; set ocn_mask_table = "mask_table.1809.90x72"
  set ocean_npes   = "4671"


else if ( "$npes" == "13792" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "2,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "90,144"; set ocn_io_layout   =  "2,4"; set ocn_mask_table = "mask_table.3785.90x144"
  set ocean_npes   = "9175"

#############################################################################################
# CM4i settings
else if ( "$npes" == "900" ) then
  set atmos_npes = 864
  set atmos_nthreads = 1
  set nxblocks = "1" ; set nyblocks = "1" 
  set fv_layout    = "12,12";   set fv_io_layout    = "1,4"
  set land_layout  = "12,12";   set land_io_layout  = "1,4"
  set ice_layout   = "144,6";   set ice_io_layout   = "1,6"
  set ocn_layout   = "6,6";     set ocn_io_layout   = "1,6"; set ocn_mask_table = "MOM_mask_table"  #360x210
  set ocean_npes = 36

else if ( "$npes" == "924" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "10,6";  set ocn_io_layout   =  "1,6"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "60"

else if ( "$npes" == "928" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "6,6";   set ocn_io_layout   =  "1,6"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "36"

else if ( "$npes" == "1792" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "8,8";    set ocn_io_layout   =  "1,8"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "64"

else if ( "$npes" == "3585" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "12,24";   set land_io_layout  =  "1,4"
  set ice_layout   =   "144,12";  set ice_io_layout   =  "1,4"
  set ocn_layout   =   "8,16";   set ocn_io_layout   =  "1,8"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "128"

else if ("$npes" == "1878" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "15,10";  set ocn_io_layout   =  "1,10"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "150"

else if ("$npes" == "1878" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "15,10";  set ocn_io_layout   =  "1,10"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "150"

else if ( "$npes" == "32" ) then
#This setting is only for testing fast e2e
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "" ; set nyblocks = "" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "2,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "90,72"; set ocn_io_layout   =  "2,4"; set ocn_mask_table = "mask_table.1809.90x72"
  set ocean_npes   = "4671"

else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in this xml."
  if ( $echoOn ) set echo
  exit 1
endif

cat > $work/INPUT/MOM_layout << LAYOUT_EOF
LAYOUT = $ocn_layout
#override IO_LAYOUT = $ocn_io_layout
MASKTABLE = $ocn_mask_table
LAYOUT_EOF

cat > $work/INPUT/SIS_layout << SIS_LAYOUT_EOF
#override undef NIPROC
#override undef NJPROC
#override undef NIPROC_IO
#override undef NJPROC_IO
#override LAYOUT = $ice_layout
#override IO_LAYOUT = $ice_io_layout
SIS_LAYOUT_EOF

      ]]></csh>

    </input>
  </experiment>


  <experiment name="c192_coupled_domain_decomp">
    <input>
      <csh><![CDATA[
# Coupled configurations
set do_ocean = "true"
set do_concurrent_radiation = ".false."
set domains_stack_size = "3097152"
if ( "$npes" == "1152" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1" 
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "24,12"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "288"

else if ( "$npes" == "1119" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1"
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "16,18"; set ocn_io_layout   =  "4,2"; set ocn_mask_table = "mask_table.33.16x18"
  set ocean_npes = "255"

else if ( "$npes" == "1728" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1"
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "0,0"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "576"

else if ( "$npes" == "1632_1" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1" 
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,18"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "mask_table.96.32x18"
  set ocean_npes = "480"

else if ( "$npes" == "1632" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "3" ; set nyblocks = "4" 
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,18"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "mask_table.96.32x18"
  set ocean_npes = "480"

else if ( "$npes" == "3456" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "4" 
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "1152"

else if ( "$npes" == "3457" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "4" 
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "0,0"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "1152"

else if ( "$npes" == "3458" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "4" 
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "36,32"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "1152"

else if ( "$npes" == "3210" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "4" 
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.242.32x36"
  set ocean_npes = "910"

else if ( "$npes" == "4384" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set nxblocks = "4" ; set nyblocks = "4" 
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.242.32x36"
  set ocean_npes = "910"

else if ( "$npes" == "4385" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,12"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.242.32x36"
  set ocean_npes = "910"

else if ( "$npes" == "5216" ) then 
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2"
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.548.32x72"
  set ocean_npes = "1756"


else if ( "$npes" == "5536" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.242.32x36"
  set ocean_npes = "910"

else if ( "$npes" == "3429" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "4" 
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,45"; set ocn_io_layout   =  "1,5"; set ocn_mask_table = "mask_table.315.32x45"
  set ocean_npes = "1125"

else if ( "$npes" == "3744" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "4" 
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,45"; set ocn_io_layout   =  "1,5"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "1440"



else if ( "$npes" == "6364" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.548.32x72"
  set ocean_npes = "1756"

else if ( "$npes" == "6912" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2304"

else if ( "$npes" == "7200" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "36,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2592"


else if ( "$npes" == "5440" ) then 
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2"
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "36,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.622.36x72"
  set ocean_npes = "1970"

else if ( "$npes" == "5888" ) then 
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2"
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set ocean_npes   = "2432"


else if ( "$npes" == "6592" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "36,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.622.36x72"
  set ocean_npes = "1970"

else if ( "$npes" == "13024" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4"
  set fv_layout    =   "12,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "72,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1402.72x72"
  set ocean_npes = "3782"

else if ( "$npes" == "13824" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set nxblocks = "4" ; set nyblocks = "1" 
  set fv_layout    =   "24,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "24,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "4608"

else if ( "$npes" == "7040" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "4" ; set nyblocks = "1" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set do_ocean = "true"
  set ocean_npes   = "2432"

else if ( "$npes" == "7008" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "75,32"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes   = "2400"

else if ( "$npes" == "7848" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "" ; set nyblocks = "" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes   = "3240"

else if ( "$npes" == "8169" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set nxblocks = "" ; set nyblocks = "" 
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,45"; set ocn_io_layout   =  "1,5"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes   = "2025"

else if ( "$npes" == "8448" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set nxblocks = "" ; set nyblocks = ""
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes   = "2304"

else if ( "$npes" == "8576" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set nxblocks = "" ; set nyblocks = "" 
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set do_ocean = "true"
  set ocean_npes   = "2432"

else if ( "$npes" == "9344" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4"
  set fv_layout    =   "12,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,24";   set land_io_layout  =  "1,3"
  set ice_layout   =   "144,12";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set do_ocean = "true"
  set ocean_npes   = "2432"

else if ( "$npes" == "9824" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4"
  set fv_layout    =   "12,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,24";   set land_io_layout  =  "1,3"
  set ice_layout   =   "144,12";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "54,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1007.54x72"
  set do_ocean = "true"
  set ocean_npes   = "2881"

else if ( "$npes" == "12595" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4" 
  set fv_layout    =   "16,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "16,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72";  set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1229.64x72"
  set ocean_npes = "3379"

else if ( "$npes" == "12596" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "8"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72";  set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1229.64x72"
  set ocean_npes = "3379"

else if ( "$npes" == "13025" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4" 
  set fv_layout    =   "16,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "16,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "72,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1402.72x72"
  set ocean_npes = "3782"

else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in this xml."
  if ( $echoOn ) set echo
  exit 1
endif

cat > $work/INPUT/MOM_layout << LAYOUT_EOF
LAYOUT = $ocn_layout
#override IO_LAYOUT = $ocn_io_layout
MASKTABLE = $ocn_mask_table
LAYOUT_EOF

cat > $work/INPUT/SIS_layout << SIS_LAYOUT_EOF
#override undef NIPROC
#override undef NJPROC
#override undef NIPROC_IO
#override undef NJPROC_IO
#override LAYOUT = $ice_layout
#override IO_LAYOUT = $ice_io_layout
SIS_LAYOUT_EOF

      ]]></csh>


      </input>
  </experiment>
