<?xml version="1.0"?>
<!-- MDT XML version 20140522 -->

<!--
GFDL FAIR USE POLICY

GFDL recognizes the essential nature of collaboration in the scientific
enterprise, including the importance of novel application and analysis of our
models. In order to maximize mutual benefit from collaboration, the use of
experimental GFDL models** should be done in a manner that ensures that
individuals involved in model development receive proper credit for their
work; in order to minimize the potential for misapplication of experimental
models, collaborations should actively engage model developers. Publication of
results using experimental GFDL models should be done in consultation with
scientists that participated in the model development. Consultation with GFDL
model developers should occur before submission of publications based on
experimental GFDL models, and should include agreement on the appropriate level
of acknowledgment, co-authorship and participation by the model developers.
Since experimental models have not been thoroughly vetted, experimental GFDL
models and their output should be distributed only after consultation with the
developers of the model. After a GFDL model has been described in a
peer-reviewed publication it is no longer experimental, and results based on
the model should cite the publication(s) describing the model.
 
** "Experimental GFDL models" refers to models (e.g., a coupled climate model),
model components (e.g., parameterization schemes), model configurations (e.g.,
the specific arrangement and parameter settings of model components) arising
from model development efforts at GFDL, but whose formulation and configuration
have not yet been documented in the peer-reviewed literature, as well as outputs
from integrations with these models.
-->

<!-- GFDL Model Development Team (MDT) documentation: http://wiki.gfdl.noaa.gov/index.php/MDT_Coupled -->
<!-- GFDL MDT Atmosphere Working Group (AWG) documentation: http://cobweb.gfdl.noaa.gov/~cjg/awg/ -->

<!-- QUICK START GUIDE:

# Change the occcurances of YOURGROUPLETTER in this file to your group letter (small), such as f, w, o, g+,...

# To check out codes and compile:
module load fre/bronx-10
fremake -x CM4_am4p5.xml -p ncrc2.intel -t prod-openmp cm4_libs_compile -nolink
SIS:
fremake -x CM4_am4p5.xml -p ncrc2.intel -t prod-openmp cm4_compile
SIS2:
fremake -x CM4_am4p5.xml -p ncrc2.intel -t prod-openmp cm4_sis2_compile

# To run regression test (for the coupled experiment CM4_c96L32_am4f4_2000): 
SIS:
frerun -r basic -x CM4_am4p5.xml -p ncrc2.intel -t prod-openmp CM4_c96L32_am4g5_2000
SIS2:
frerun -r basic -x CM4_am4p5.xml -p ncrc2.intel -t prod-openmp CM4_c96L32_am4g5_2000_sis2

# To run a complete coupled experiment (with automated database entry if MDBIswitch in "on"):
SIS:
frerun -x CM4_am4p5.xml -p ncrc2.intel -t prod-openmp CM4_c96L32_am4g5_2000
SIS2
frerun -x CM4_am4p5.xml -p ncrc2.intel -t prod-openmp CM4_c96L32_am4g5_2000_sis2

# To check what is the input data of this experiment:
inputfiles -x CM4_am4p5.xml -p ncrc2.intel CM4_c96L32_am4g5_2000

NOTES:
      If the experiment name + FRESTEM is too long the post-process initiated on gaea may fail.
      This is because, there is a small limit set by moab on the number of total characters for
      ppEnv environment variable which  is roughly the sum of the strings made by
      1. the refine diag list
      2. the contents of the <csh> section of the gfdl platform
      
-->

<experimentSuite rtsVersion="4" xmlns:xi="http://www.w3.org/2003/XInclude">

  <!--User shoould set the following properties according to the plan for the production run-->	
  <property name="RELEASE"      value="ulm_201505"/>              <!-- Release tag for the shared source code -->
  <property name="MOM6_DATE"    value="2015.07.09b"/>      <!-- git tag date for MOM6 source code -->
  <property name="MOM6_GIT_TAG" value="dev/master/$(MOM6_DATE)"/>  <!-- git tag for MOM6 source code -->
  <property name="AWG_GIT_TAG"  value="awg_v20150702"/> <!-- git tag for AWG  source code -->
  <property name="ProjectID"    value="MDT"/>             <!-- database top level -->

  <property name="PROD_SIMTIME"     value="60"/>   <!--simulation length in years-->
  <property name="PP_CPLD_CHUNK_A"  value="5yr"/>  <!--smaller chunk length for pp/analysis-->
  <property name="PP_CPLD_CHUNK_B"  value="20yr"/> <!--bigger  chunk length for pp/analysis-->

  <!--The following properties need to be set only if the user wants to monitor the run progress at MDBI
      and are not needed for the run or post-processing -->   
  <property name="EXP_CPLD_START"   value="0001"/> <!--simulation start year--> 
  <property name="EXP_CPLD_END"     value="0060"/> <!--simulation end   year--> 
  
  <!--The rest of the properties need not to be changed by the user unless to customize the run-->

  <property name="FRE_STEM"  value="$(RELEASE)_$(AWG_GIT_TAG)_mom6sis2_$(MOM6_DATE)"/>   <!--  customize as needed -->
  <property name="FRE_VERSION" value="fre/bronx-10"/>             <!-- fre version to be used -->
  <property name="ANALYSIS_SWITCH" value="on"/>                  <!-- on/off switch for ATM/LND analysis -->
  <property name="MDBIswitch" value="on"/>                       <!-- on/off switch for MDBI database -->

 
  <!-- Reference release tag for existing files in the archives for answer comparison. Used in "REFERENCE" property. -->
  <property name="reference_tag"   value="ulm_201505_awg_v20150702_mom6sis2_2015.07.09b_answers"/>
                          
  <property name="DEBUGLEVEL" value=""/>

  <!--========================================-->
  <!--Do not change the rest of the properties-->
  <!--========================================-->

  <property name="AWG_INPUT_HOME_GAEA"  value="awg_include"/>
  <property name="AWG_INPUT_HOME_NESCC" value="awg_include"/>
  <property name="AWG_INPUT_HOME_GFDL" value="/nbhome/$USER/$(FRE_STEM)/$(name)/mdt_xml/awg_include"/>

<!--=================-->
<!--= CHANGING NPES =-->
<!--=================-->

<!--
This xml includes a number of predefined options for the number of PEs.
Changing the number of PEs can be accomplished by 
modifying 'npes' and segment 'runTime' in the xml <production> block:

      <production simTime="$(EXP_AMIP_LEN)" units="years" npes="1728" runTime="16:00:00">
        <segment simTime="12" units="months" runTime="3:00:00"/>
      </production>

Choosing a particular PE number is a balancing act. The higher npes, 
the faster the model throughput, but also the lower the model efficiency
(i.e. the overall simulation will cost more in terms of core hours).
    
-->
   <property name="domainparams_A216x2"
	     value="
	       coupler_nml:do_ocean=.false.;coupler_nml:ocean_npes=0;
               coupler_nml:atmos_npes=216;coupler_nml:atmos_nthreads=2;	
               fv_core_nml:layout=3,12;fv_core_nml:io_layout=1,4;atmos_model_nml:nxblocks=4;atmos_model_nml:nyblocks=2;
	       land_model_nml:layout=3,12;land_model_nml:io_layout=1,4;
	       ice_model_nml:layout=72,3;ice_model_nml:io_layout=1,3;
	       fms_nml:domains_stack_size=2097152"/>
   <property name="domainparams_A432x2"
	     value="
	       coupler_nml:do_ocean=.false.;coupler_nml:ocean_npes=0;
               coupler_nml:atmos_npes=432;coupler_nml:atmos_nthreads=2;	
               fv_core_nml:layout=3,24;fv_core_nml:io_layout=1,4;atmos_model_nml:nxblocks=4;atmos_model_nml:nyblocks=2;
	       land_model_nml:layout=3,24;land_model_nml:io_layout=1,4;
	       ice_model_nml:layout=144,3;ice_model_nml:io_layout=1,3;
	       fms_nml:domains_stack_size=2097152"/>


  <setup>

    <platform name="ncrc2.intel">
<!-- Please make sure to change "YOURGROUPLETTER" to your group, such as b, f, g, m, o... -->
      <project>gfdl_YOURGROUPLETTER</project>
      <directory stem="$(FRE_STEM)">
        <!--unswept locations--><!-- CPERM=/lustre/f1/unswept -->
        <root>$CPERM/$USER/$(FRE_STEM)</root>
        <scripts>$CPERM/$USER/$(FRE_STEM)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/scripts</scripts>
        <state>$CPERM/$USER/$(FRE_STEM)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/state</state>
        <!--swept locations (including the staged archive location)-->
        <archive>$CTMP/$USER/$(stem)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/archive</archive>
        <stdout>$CTMP/$USER/$(stem)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/stdout</stdout>
        <work>$CTMP/$USER/work/$(stem)/$FRE_JOBID</work>
      </directory>
      <property name="EXEC_ROOT"         value="$CPERM/$USER/$(stem)"/>
      <property name="F2003_FLAGS"       value=" -DINTERNAL_FILE_NML -g -traceback"/>
      <property name="AWG_INPUT_HOME"    value="$(AWG_INPUT_HOME_GAEA)"/>
      <property name="AWG_ARCHIVE_ROOT"  value="/lustre/f1/unswept/Chris.Golaz/archive/mdt"/>
      <property name="LWH_ARCHIVE_ROOT"  value="/lustre/f1/pdata/gfdl_M"/>
      <property name="NB_ROOT"           value="/nbhome/$USER/$(FRE_STEM)/$(name)"/>
      <property name="CWG_HOME"          value="/lustre/f1/unswept/John.Krasting/cwg"/>
      <property name="REFERENCE"         value="/lustre/f1/unswept/Niki.Zadeh/$(reference_tag)/$(name)/$(platform)-$(target)"/>
      <property name="ARCHIVE_INPUT_NZ"  value="/lustre/f1/unswept/Niki.Zadeh/archive/input"/>
     
      <csh><![CDATA[
        source $MODULESHOME/init/csh
 
        module use -a /ncrc/home2/fms/local/modulefiles
        module unload PrgEnv-pgi PrgEnv-pathscale PrgEnv-intel PrgEnv-gnu PrgEnv-cray
        module unload netcdf fre
        module load PrgEnv-intel/4.0.46
        module load $(FRE_VERSION)
        module load git
 
        setenv KMP_STACKSIZE 512m
        setenv NC_BLKSZ 1M
        setenv F_UFMTENDIAN big
      ]]></csh>

    </platform>

    <platform name="ncrc2.gnu">
<!-- Please make sure to change "YOURGROUPLETTER" to your group, such as b, f, g, m, o... -->
      <project>gfdl_YOURGROUPLETTER</project>
      <directory stem="$(FRE_STEM)">
        <!--unswept locations--><!-- CPERM=/lustre/f1/unswept -->
	<root>$HOME/$(stem)</root>
	<exec>$CPERM/$USER/$(stem)/$(name)/$(platform)-$(target)/exec</exec>
	<state>$CPERM/$USER/$(stem)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/state</state>
 	<scripts>$CPERM/$USER/$(stem)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/scripts</scripts>
        <!--swept locations (including the staged archive location)-->
        <archive>$CTMP/$USER/$(stem)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/archive</archive>
        <stdout>$CTMP/$USER/$(stem)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/stdout</stdout>
        <work>$CTMP/$USER/work/$(stem)/$FRE_JOBID</work>
      </directory>
      <property name="EXEC_ROOT"         value="$CPERM/$USER/$(stem)"/>
      <property name="F2003_FLAGS"       value=" -DINTERNAL_FILE_NML -g -fbacktrace"/>
      <property name="AWG_INPUT_HOME"    value="$(AWG_INPUT_HOME_GAEA)"/>
      <property name="AWG_ARCHIVE_ROOT"  value="/lustre/f1/unswept/Chris.Golaz/archive/mdt"/>
      <property name="NB_ROOT"           value="/nbhome/$USER/$(FRE_STEM)/$(name)"/>
      <property name="CWG_HOME"          value="/lustre/f1/unswept/John.Krasting/cwg"/>
      <property name="REFERENCE"         value="/lustre/f1/unswept/Niki.Zadeh/$(reference_tag)/$(name)/$(platform)-$(target)"/>
      <property name="ARCHIVE_INPUT_NZ"  value="/lustre/f1/unswept/Niki.Zadeh/archive/input"/>
     
      <csh><![CDATA[
        source $MODULESHOME/init/csh
 
        module use -a /ncrc/home2/fms/local/modulefiles
        module unload PrgEnv-pgi PrgEnv-pathscale PrgEnv-intel PrgEnv-gnu PrgEnv-cray
        module unload netcdf fre
        module load PrgEnv-gnu
        module load $(FRE_VERSION)
        module load git
 
        setenv KMP_STACKSIZE 512m
        setenv NC_BLKSZ 1M
        setenv F_UFMTENDIAN big
        # MAIN_PROGRAM env is needed by the GNU compiler
        setenv MAIN_PROGRAM coupler/coupler_main.o
      ]]></csh>

    </platform>
    
    <platform name="ncrc2.default">
      <xi:include xpointer="xpointer(//setup/platform[@name='ncrc2.intel']/node())" />
    </platform>

    <platform name="nescc.intel">
      <project>gfdlport</project>
      <directory stem="$(FRE_STEM)">
        <root>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)</root>
        <src>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)/$(name)/src</src>
        <exec>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)/$(name)/$(platform)-$(target)/exec</exec>
        <scripts>$HOME/$(stem)/$(name)/$(platform)-$(target)/scripts</scripts>
        <stdout>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)/$(name)/$(platform)-$(target)/stdout</stdout>
        <state>$HOME/$(stem)/$(name)/$(platform)-$(target)/state</state>
        <work>/scratch2/portfolios/GFDL/gfdlscr/$USER/work/$FRE_JOBID</work>
        <ptmp>/scratch2/portfolios/GFDL/gfdlscr/$USER/ptmp</ptmp>
        <stmp>/scratch2/portfolios/GFDL/gfdlscr/$USER/stmp</stmp>
        <archive>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)/$(name)/$(platform)-$(target)</archive>
      </directory>
      <property name="EXEC_ROOT"         value="$(rootDir)"/>
      <property name="F2003_FLAGS"       value=" -DINTERNAL_FILE_NML"/>
      <property name="AWG_INPUT_HOME"    value="$(AWG_INPUT_HOME_NESCC)"/>
      <property name="AWG_ARCHIVE_ROOT"  value="/scratch2/portfolios/GFDL/gfdlscr/John.Krasting/awg/mdt"/>
      <property name="NB_ROOT"           value="/nbhome/$USER/$(FRE_STEM)/$(name)"/>
      <property name="CWG_HOME"          value="/scratch2/portfolios/GFDL/gfdlscr/John.Krasting/cwg"/>
      <property name="REFERENCE"         value="/scratch2/portfolios/GFDL/gfdlscr/Niki.Zadeh/$(reference_tag)/$(name)/$(platform)-$(target)"/>
      <property name="ARCHIVE_INPUT_NZ"  value="/scratch2/portfolios/GFDL/gfdlscr/Niki.Zadeh/archive/input"/>

      <csh><![CDATA[
        module use ~fms/local/modulefiles
        #module load intel/12-12.0.4.191 #need more up-to-date compiler for ulm
        module load intel/13.0.079
        module load netcdf/4.1.1-intel-12
        module load mpt/2.06
        module load $(FRE_VERSION)
        module load nco
        setenv MPICH_CPUMASK_DISPLAY
        setenv KMP_STACKSIZE 512m
        setenv NC_BLKSZ 1M
        setenv F_UFMTENDIAN big
        setenv SMA_SHMALLOC_FORCE_EQUAL off
        setenv MPI_BUFS_PER_PROC 512
        setenv MPI_BUFS_PER_HOST 512
      ]]></csh>
    </platform>

    
    <platform name="nescc.default">
      <xi:include xpointer="xpointer(//setup/platform[@name='nescc.intel']/node())" />
    </platform>

    <platform name="theia.intel">
      <project>gfdlport</project>
      <directory stem="$(FRE_STEM)">
        <root>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)</root>
        <src>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)/$(name)/src</src>
        <exec>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)/$(name)/$(platform)-$(target)/exec</exec>
        <scripts>$HOME/$(stem)/$(name)/$(platform)-$(target)/scripts</scripts>
        <stdout>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)/$(name)/$(platform)-$(target)/stdout</stdout>
        <state>$HOME/$(stem)/$(name)/$(platform)-$(target)/state</state>
        <work>/scratch2/portfolios/GFDL/gfdlscr/$USER/work/$FRE_JOBID</work>
        <ptmp>/scratch2/portfolios/GFDL/gfdlscr/$USER/ptmp</ptmp>
        <stmp>/scratch2/portfolios/GFDL/gfdlscr/$USER/stmp</stmp>
        <archive>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)/$(name)/$(platform)-$(target)</archive>
      </directory>

      <property name="EXEC_ROOT"         value="$(rootDir)"/>
      <property name="F2003_FLAGS"       value=" -DINTERNAL_FILE_NML -g -traceback"/>
      <property name="AWG_INPUT_HOME"    value="$(AWG_INPUT_HOME_NESCC)"/>
      <property name="AWG_ARCHIVE_ROOT"  value="/scratch2/portfolios/GFDL/gfdlscr/Niki.Zadeh/awg/mdt"/>
      <property name="NB_ROOT"           value="/nbhome/$USER/$(FRE_STEM)$(DEBUGLEVEL)/$(name)"/>
      <property name="CWG_HOME"          value="/scratch2/portfolios/GFDL/gfdlscr/John.Krasting/cwg"/>
      <property name="REFERENCE"         value=""/>
      <property name="ARCHIVE_INPUT_NZ"  value="/scratch2/portfolios/GFDL/gfdlscr/Niki.Zadeh/archive/input"/>
      <csh><![CDATA[
        module use -a /home/fms/local/modulefiles
        module use -a /contrib/gfdl/modulefiles
        module load intel/15.1.133
        module load netcdf/4.3.0
        module load hdf5/1.8.14
        module load impi/5.0.1.035
        module load $(FRE_VERSION)

        setenv KMP_STACKSIZE 512m
        setenv NC_BLKSZ 1M
        setenv F_UFMTENDIAN big
        ]]>
      </csh>
    </platform>

    <platform name="theia.default">
      <xi:include xpointer="xpointer(//setup/platform[@name='theia.intel']/node())" />
    </platform>

    <platform name="gfdl.default">
      <property name="NB_ROOT"  value="/nbhome/$USER/$(FRE_STEM)/$(name)"/><!--Do not change this! Other platforms use  the same value. -->
      <directory stem="$(FRE_STEM)">
        <archive>$ARCHIVE/$(stem)/$(name)/$(platform)-$(target)</archive>
        <postProcess>$(archiveDir)/pp</postProcess>
        <analysis>$(NB_ROOT)</analysis><!--Do not change this! frepp translates this to $out_dir. This is also the directory under which  frepp looks for mom6 clone.  -->
	<ptmp>/ptmp/$USER</ptmp>
      </directory>
      <property name="EXEC_ROOT"         value="$(rootDir)"/>
      <property name="F2003_FLAGS"       value=" -DINTERNAL_FILE_NML"/>
      <property name="AWG_INPUT_HOME"    value="$(AWG_INPUT_HOME_GFDL)"/>
      <property name="AWG_ARCHIVE_ROOT"  value="/archive/cjg/mdt"/>
      <property name="CWG_HOME"          value="/archive/John.Krasting/cwg"/>
      <property name="REFERENCE"         value=""/>
      <property name="ARCHIVE_INPUT_NZ"  value=""/>

      <csh><![CDATA[
        source $MODULESHOME/init/csh
        module use -a /home/fms/local/modulefiles
        module purge
        module load $(FRE_VERSION)
        module load fre-analysis
        module load git
        setenv FREVERSION $(FRE_VERSION)           
        setenv NBROOT $(NB_ROOT)
        /home/Niki.Zadeh/nnz_tools/bin/verify -m $(MOM6_GIT_TAG) -x dev
      ]]>
      </csh>
    </platform>
    <platform name="gfdl.ncrc2-default">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.default']/node())" />
    </platform>
    <platform name="gfdl.ncrc2-intel">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.default']/node())" />
    </platform>

    <platform name="gfdl.nescc-default">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.default']/node())" />
    </platform>
    <platform name="gfdl.nescc-intel">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.default']/node())" />
    </platform>

    <platform name="gfdl.theia-intel">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.default']/node())" />
    </platform>

    <platform name="gfdl-ws.default">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.default']/node())" />
    </platform>

  </setup>

<!--===========-->
<!--= COMPILE =-->
<!--===========-->
  <!--The property MOM6_EXAMPLES should point to the mom6 directory that is checked out. It is needed by MOM6 to access its input data files-->
  <property name="LIBS_ROOT"      value="cm4_libs_compile"/> <!--name of libs compile experiment-->
  
  <property name="MOM6_EXAMPLES"  value="$root/$(LIBS_ROOT)/src/mom6"/>
  <property name="FMS_LIB_DIR"    value="./$(LIBS_ROOT)/$(platform)-$(target)/exec"/>
  <property name="MY_LIBS"        value="$(EXEC_ROOT)/$(FMS_LIB_DIR)"/>

  <experiment name="cm4_libs_compile">
    <description>

Experiment to build executable.
* ulm code base
* MOM6 ocean code (updated to dev/master/2015.04.24)
* Code updates from John Dunne for new surface fluxes options (drag_min_jpd_20141030)
* Code changes from Ming Zhao for low sensitivity configuration. Changes answers for all! (lowsen20141106_miz)
* Chris Golaz total activation bug fix (ulm_total_act_fix_cjg)
* Chris Golaz bug fix to enable do_gust_cv and convect_shutoff options. May change answer.
* David Paynter radiation bug fix for debug mode
* Ming Zhao code changes for am4f3 (am4f3_20150225_miz and git tags user/cjg/am4f3_20150225_miz). Changes answers.
* Code update from Huan Guo to merge moist_processes.F90 changes (am4f3_convect_fix_20150303_h1g)
* Huan Guo code changes to scale aerosol wet deposition using namelist parameter (wetDep_scale_20150311_h1g)
* Changes from Paul Ginoux to enable fast aerosols.
* Changes from Ming Zhao to decrease climate sensitivity
* Changes from John Wilson for cg drag and topo drag
    </description>

    <component name="fms" paths="shared">
     <description domainName="infrastructure" communityName="FMS" communityVersion="$(RELEASE)" communityGrid=""/>
      <source versionControl="git" root="http://gitlab.gfdl.noaa.gov/fms">
            <codeBase version="$(RELEASE)"> shared.git </codeBase>
            <csh><![CDATA[
            ( cd shared && git checkout $(RELEASE) )
# AWG updates
            ( cd shared && git checkout $(AWG_GIT_TAG) )
            ]]>
            </csh>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) -Duse_libMPI -Duse_netCDF </cppDefs>
      </compile>
    </component>

    <component name="atmos_phys" requires="fms" paths="atmos_param atmos_shared">
      <description domainName="" communityName="" communityVersion="$(RELEASE)" communityGrid=""/>
      <source versionControl="git" root="http://gitlab.gfdl.noaa.gov/fms">
        <codeBase version="$(RELEASE)"> atmos_shared.git atmos_param.git </codeBase>
        <!-- This csh section is needed for systems that use an older git version that doesn't
             support cloning a specific tag directly. -->
        <csh><![CDATA[
          # AWG updates
          ( cd atmos_param  && git checkout $(AWG_GIT_TAG) )
          ( cd atmos_shared && git checkout $(AWG_GIT_TAG) )

          ]]>
        </csh>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) -DCLUBB</cppDefs>
      </compile>
    </component>

    <component name="atmos_dyn" paths="atmos_drivers/coupled
                                       atmos_cubed_sphere/driver/coupled
                                       atmos_cubed_sphere/model
                                       atmos_cubed_sphere/model_nh_null
                                       atmos_cubed_sphere/tools" requires="fms atmos_phys">
      <source versionControl="git" root="http://gitlab.gfdl.noaa.gov/fms">
        <codeBase version="$(RELEASE)">atmos_drivers.git atmos_cubed_sphere.git</codeBase>
        <!-- This csh section is needed for systems that use an older git version that doesn't
             support cloning a specific tag directly. -->
        <csh><![CDATA[
          ( cd atmos_drivers && git checkout $(AWG_GIT_TAG) )
          ( cd atmos_cubed_sphere && git checkout $(AWG_GIT_TAG) )
          ]]>
        </csh>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) -DSPMD</cppDefs>
      </compile>
    </component>

    <component paths="ice_sis ice_param" requires="fms" name="ice_sis">
         <source versionControl="git" root="http://gitlab.gfdl.noaa.gov/fms">
            <codeBase version="$(RELEASE)"> ice_sis.git ice_param.git </codeBase>
         </source>
         <compile>
            <cppDefs>$(F2003_FLAGS)</cppDefs>
         </compile>
    </component>

    <component name="land_lad2" requires="fms" paths="land_lad2">
      <description domainName="LM3" communityName="land_lad2" communityVersion="$(RELEASE)" communityGrid=""/>
      <source>
        <codeBase version="$(RELEASE)"> land_lad2 </codeBase>
	<csh>
          # Protection from negative soil water divergence situations
          cvs up -r ulm_merge_pjp land_lad2/soil/soil.F90
        </csh>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS)</cppDefs>

         <!--The following csh block is needed for compiler pre-processors that are not ANSI-compliant, such as pathscale-->
         <csh> <![CDATA[
sed -e 's/<TAB>/\t/' >land/Makefile-cpp <<EOF
CPPDEFS =  $(F2003_FLAGS)
FRETARGET = $(target)

ifneq (\$(findstring hdf5,\${FRETARGET}),)
else
  CPPDEFS += -Duse_LARGEFILE
endif

vpath %.F90 \$(shell find ${src_dir}/land_lad2 -type d)

land/%.f90: %.F90
<TAB>cpp \${CPPDEFS} -C -v -I ${src_dir}/shared/include -o \$@ \$<

EOF

foreach foo ( `find ${src_dir}/land_lad2 -type f -name \*.F90` )
  make -f land/Makefile-cpp land/$foo:t:r.f90
end
find ${bld_dir}/land -type f -name \*.f90 > land/pathnames_land_lad2
        ]]></csh>

      </compile>
    </component>

    <component name="mom6" requires="fms ocean_shared" paths="mom6/src/MOM6/config_src/dynamic mom6/src/MOM6/config_src/coupled_driver mom6/src/MOM6/src/*/ mom6/src/MOM6/src/*/*/">
      <description domainName="Ocean" communityName="GFDL-MOM6" communityVersion="$(MOM6_GIT_TAG)" communityGrid="Tripolar"/>
      <source versionControl="git" root="http://github.com">
        <codeBase version="$(MOM6_GIT_TAG)"> NULL </codeBase>
        <csh>
          git clone -b $(MOM6_GIT_TAG) http://github.com/NOAA-GFDL/MOM6-examples.git mom6
          pushd mom6
          git checkout $(MOM6_GIT_TAG)  #needed for older git on zeus
          git submodule init src/MOM6 src/SIS2 tools/python/025gridGeneration/MIDAS
          git clone --recursive http://github.com/NOAA-GFDL/MOM6.git src/MOM6 
          git clone             http://github.com/NOAA-GFDL/SIS2.git src/SIS2
          git submodule update #This gets the right version of submodules
          popd

          pushd mom6
          set platform_domain = `perl -T -e "use Net::Domain(hostdomain) ; print hostdomain"`
          if ("${platform_domain}" =~ *"fairmont.rdhpcs.noaa.gov"* ) then
            ln -s /scratch2/portfolios/GFDL/gfdlscr/John.Krasting/pdata/gfdl_O/datasets/ .datasets
          else
            ln -s /lustre/f1/pdata/gfdl_O/datasets/ .datasets
          endif
          popd	  

          test -e mom6/.datasets
          if ($status != 0) then
            echo ""; echo "" ; echo "   WARNING:  .datasets link in MOM6 examples directory is invalid"; echo ""; echo ""
          endif
        </csh>
      </source>
      <compile>
        <cppDefs><![CDATA[ $(F2003_FLAGS) -D_USE_GENERIC_TRACER -D_FILE_VERSION="'"`git-version-string $<`"'" ]]></cppDefs>
        <makeOverrides>OPENMP=""</makeOverrides> <!-- openmp switch for MOM6 may cause crash -->
      </compile>
    </component>

    <component name="sis2" paths="mom6/src/SIS2 ice_param" requires="fms mom6" includeDir="$root/$(LIBS_ROOT)/src/mom6/src/MOM6/src/framework" > 
         <source>
	   <codeBase version="$(RELEASE)"> ice_param </codeBase> 
         </source>
         <compile>
            <cppDefs><![CDATA[$(F2003_FLAGS) -D_FILE_VERSION="'"`git-version-string $<`"'"]]>
            </cppDefs>
         </compile>
    </component>

    <component paths="ocean_shared" requires="fms" name="ocean_shared">
      <description domainName="Ocean Generic Tracers" communityName="GFDL-ocean-shared" communityVersion="$(RELEASE)" communityGrid="Tripolar"/>
      <source versionControl="git" root="http://gitlab.gfdl.noaa.gov/fms">
        <codeBase version="$(RELEASE)"> ocean_shared.git </codeBase>
        <csh><![CDATA[
        ( cd ocean_shared && git checkout $(RELEASE) )
        ]]>
        </csh>
      </source>
      <compile>
        <cppDefs><![CDATA[$(F2003_FLAGS) -D_FILE_VERSION="'"`git-version-string $<`"'"]]></cppDefs>
      </compile>
    </component>
  </experiment>

  <!-- cm4_compile is the compile experiment name -->
  <experiment name="cm4_compile" inherit="cm4_libs_compile">
      <component paths="shared" name="fms" includeDir="$root/$(LIBS_ROOT)/src/shared/include">
         <library path="$(MY_LIBS)/fms/libfms.a" headerDir="$(MY_LIBS)/fms"/>
      </component>
      <component name="land_lad2" paths="land_lad2" requires="fms">
         <library path="$(MY_LIBS)/land_lad2/libland_lad2.a" headerDir="$(MY_LIBS)/land_lad2"/>
      </component>
      <component name="atmos_phys" paths="atmos_phys atmos_param" requires="fms">
          <library path="$(MY_LIBS)/atmos_phys/libatmos_phys.a" headerDir="$(MY_LIBS)/atmos_phys"/>
      </component>
      <component name="atmos_dyn" paths="atmos_drivers/coupled
                                       atmos_cubed_sphere/driver/coupled
                                       atmos_cubed_sphere/model
                                       atmos_cubed_sphere/model_nh_null
                                       atmos_cubed_sphere/tools" requires="fms atmos_phys">
          <library path="$(MY_LIBS)/atmos_dyn/libatmos_dyn.a" headerDir="$(MY_LIBS)/atmos_dyn"/>
      </component>
      <component paths="ocean_shared" requires="fms" name="ocean_shared">
         <library path="$(MY_LIBS)/ocean_shared/libocean_shared.a" headerDir="$(MY_LIBS)/ocean_shared"/>
      </component> 
      <component paths="mom6" requires="fms ocean_shared" name="mom6">
         <library path="$(MY_LIBS)/mom6/libmom6.a" headerDir="$(MY_LIBS)/mom6"/>
      </component> 
      <component paths="ice_sis" requires="fms" name="ice_sis">
         <library path="$(MY_LIBS)/ice_sis/libice_sis.a" headerDir="$(MY_LIBS)/ice_sis"/>
      </component> 
      <component name="coupler" paths="coupler" requires="fms atmos_dyn atmos_phys land_lad2 ice_sis mom6 ocean_shared">
        <description domainName="FMS Coupler" communityName="coupler" communityVersion="$(RELEASE)" communityGrid=""/>  
        <source versionControl="git" root="http://gitlab.gfdl.noaa.gov/fms">
          <codeBase version="$(RELEASE)"> coupler.git </codeBase>
          <csh><![CDATA[
          # AWG updates
          ( cd coupler && git checkout $(AWG_GIT_TAG) )
          ]]>
          </csh>
        </source>
        <compile>
          <cppDefs><![CDATA[$(F2003_FLAGS) -D_FILE_VERSION="'"`git-version-string $<`"'"]]></cppDefs>
         </compile>
      </component>
  </experiment>
  
  <experiment name="cm4_sis2_compile" inherit="cm4_libs_compile">
      <component paths="shared" name="fms" includeDir="$root/$(LIBS_ROOT)/src/shared/include">
         <library path="$(MY_LIBS)/fms/libfms.a" headerDir="$(MY_LIBS)/fms"/>
      </component>
      <component name="land_lad2" paths="land_lad2" requires="fms">
         <library path="$(MY_LIBS)/land_lad2/libland_lad2.a" headerDir="$(MY_LIBS)/land_lad2"/>
      </component>
      <component name="atmos_phys" paths="atmos_phys atmos_param" requires="fms">
          <library path="$(MY_LIBS)/atmos_phys/libatmos_phys.a" headerDir="$(MY_LIBS)/atmos_phys"/>
      </component>
      <component name="atmos_dyn" paths="atmos_drivers/coupled
                                       atmos_cubed_sphere/driver/coupled
                                       atmos_cubed_sphere/model
                                       atmos_cubed_sphere/model_nh_null
                                       atmos_cubed_sphere/tools" requires="fms atmos_phys">
          <library path="$(MY_LIBS)/atmos_dyn/libatmos_dyn.a" headerDir="$(MY_LIBS)/atmos_dyn"/>
      </component>
      <component paths="ocean_shared" requires="fms" name="ocean_shared">
         <library path="$(MY_LIBS)/ocean_shared/libocean_shared.a" headerDir="$(MY_LIBS)/ocean_shared"/>
      </component> 
      <component paths="mom6" requires="fms ocean_shared" name="mom6">
         <library path="$(MY_LIBS)/mom6/libmom6.a" headerDir="$(MY_LIBS)/mom6"/>
      </component> 
      <component paths="sis2" requires="fms" name="sis2">
         <library path="$(MY_LIBS)/sis2/libsis2.a" headerDir="$(MY_LIBS)/sis2"/>
      </component> 
      <component name="coupler" paths="coupler" requires="fms atmos_dyn atmos_phys land_lad2 sis2 mom6 ocean_shared">
        <description domainName="FMS Coupler" communityName="coupler" communityVersion="$(RELEASE)" communityGrid=""/>  
        <source versionControl="git" root="http://gitlab.gfdl.noaa.gov/fms">
          <codeBase version="$(RELEASE)"> coupler.git </codeBase>
          <csh><![CDATA[
          # AWG updates
          ( cd coupler && git checkout $(AWG_GIT_TAG) )
          ]]>
          </csh>
        </source>
        <compile>
          <cppDefs><![CDATA[$(F2003_FLAGS) -D_FILE_VERSION="'"`git-version-string $<`"'"]]></cppDefs>
         </compile>
      </component>
  </experiment>

<!--============================-->
<!--= TEMPLATES FOR INPUT DATA =-->
<!--============================-->
  <experiment name="L48_data">
    <input>
      <dataFile label="input" target="INPUT/gas_conc_3D_am3p9.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/aerosol/gas_conc_3D48L_am3p9.nc</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="L32_data">
    <input>
      <dataFile label="input" target="INPUT/gas_conc_3D_am3p9.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/aerosol/gas_conc_3D32L_am3p9.nc</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="c96L48_initCond">
    <input>
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">/lustre/f1/unswept/Larry.Horowitz/awg/IC/awg_C96L48_LM3_OM4_025_grid_lm3p2_19810101.remapped.v20150604.tar</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="c96L32_initCond">
    <input>
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">/lustre/f1/unswept/Niki.Zadeh/archive/input/ulm/awg_C96L32_LM3_OM4_025_grid_lm3p2_19810101.remapped.topodrag.v20150507.minus_ice_model_restart.tar</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="c192L48_initCond">
    <input>
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/ic/awg_C192L48_LM3_OM4_025_grid_southshifted_19810101.remapped.v20150302.tar</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="c192L32_initCond">
    <input>
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">/lustre/f1/unswept/Huan.Guo/INPUT/InitCond/AWG_c192L32_newLand20150522/Combine_LM3p2sosn_C192_OM4_025_19810101.remapped.v20150521_With_southshifted.v20150302.tar</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="field_table_am4p5">
    <input>
      <dataFile label="fieldTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/field_table/field_table_am4p5</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="field_table_am4p5_faero">
    <input>
      <dataFile label="fieldTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/field_table/field_table_am4p5_faero</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="field_table_am4p5_fullchem">
    <input>
      <dataFile label="fieldTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/field_table/field_table_am4p5_fullchem_v20150604</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="common_data_lm3p2">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/common/sea_esf_dec2014.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)"> /lustre/f1/unswept/Bruce.Wyman/archive/mdt/awg/input/common/new_sea_esf_aug2013.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">/lustre/f1/unswept/Sergey.Malyshev/awg/input/lm3/lm3_data_20150322.tar</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/aerosol_inputs.dec2009.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/RCP/cmip5_rcp45.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(LWH_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/tropchem_dec2014.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/historical/emissions.1x1.1859_2020.tar</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/emissions.isoprene.1x1.1859_2020.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(LWH_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/historical/emissions.isoprene_no_biogenic.1x1.1859_2020.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/anthro_so2.1859_2010.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/emissions/emissions.simple.so2.1x1.1859_2020.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/emis_fuel_aircraft.1859_2010.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/emissions/emissions.aircraft.aero.1x1.1859_2020.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/emissions/so2_0.25_volcanoes.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/AM4_201503" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/aerosol/am4_optical_table_20150325.dat</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="diag_table_lm3p2_faero">
    <input>
      <diagTable>
$name
$baseDate

      </diagTable>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_atmos_faero</dataSource>
      </dataFile>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_atmos_simpleSO4</dataSource>
      </dataFile>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_land</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="diag_table_lm3p2_fullaero">
    <input>
      <diagTable>
$name
$baseDate

      </diagTable>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_atmos</dataSource>
      </dataFile>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_atmos_simpleSO4</dataSource>
      </dataFile>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_land</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="diag_table_lm3p2_fullchem">
    <input>
      <diagTable>
$name
$baseDate

      </diagTable>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_atmos</dataSource>
      </dataFile>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_atmos_fullchemOnly_v20140325</dataSource>
      </dataFile>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_land</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="amip_data">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
<!--    <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/sst/hadisst.186912-201401.tar</dataSource> -->
        <dataSource platform="$(platform)">/lustre/f1/unswept/Chris.Golaz/awg/input/sst/hadisst.186912-201502.tar</dataSource>
      </dataFile>
      <dataFile label="dataTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/data_table/data_table_amip</dataSource>
      </dataFile>
      <dataFile label="dataTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/data_table/data_table_co2</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="climo_data">
    <input>
      <dataFile label="input" target="INPUT/hadisst_sst.data.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/sst.climo.1981-2000.data.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/hadisst_ice.data.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/ice.climo.1981-2000.data.nc</dataSource>
      </dataFile>
      <!-- Repeat data_table_amip but not data_table_co2 -->
      <dataFile label="dataTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/data_table/data_table_amip</dataSource>
      </dataFile>
    </input>
  </experiment>



  <experiment name="c96_data_lm3p2">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <!--<dataSource platform="$(platform)">/lustre/f1/unswept/Ming.Zhao/archive/mdt/awg/newland/19810101.static_veg.southshifted.remapped_to_c96_OM4_025.v20150120.tar</dataSource>-->
        <dataSource platform="$(platform)">/lustre/f1/unswept/Sergey.Malyshev/fre/tikal/LM3/LM3p2_C96_CM2G_historical_HC1_quick/ncrc2.default-prod/static_veg/19810101.static_veg.lm3p2.remapped_to_c96_OM4_025.v20150322.tar</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/lm3/c96_OM4_025_hydrography_v20140620.tar</dataSource>
      </dataFile>
      <dataFile label="gridSpec" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/grid/c96_OM4_025_grid_v20140620.tar</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="c96_atmos_domain_decomp">
<!--
c96 means 96x96 grid points per face
fv_layout=X,Y means a domain decomposition of iec=96/X , jec=96/Y per face.
E.g.  fv_layout="3,24" gives:
  X-AXIS =   32  32  32
  Y-AXIS =    4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4

NOTE: In the follwoing npes is the number of PE cores reserved but it may NOT be equal to the actual number of PE's used.
      Since many of the following configurations use the same number of npes, I arbitarily incremented npes by 1 to distingush them.
      This would cost one node (32 cores) of resources.
      We should go back to use the override mechanism of FRE to avoid this.  
-->    
    <input>
      <csh><![CDATA[
# Some possible domain decompositionsn.
set do_ocean = "false"
set do_concurrent_radiation = ".false."
set domains_stack_size = "2097152"

if ( "$npes" == "432" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "864" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "870" ) then
  set atmos_npes = "432"
  set do_concurrent_radiation = ".true.";set radiation_nthreads = "1"
  set atmos_nthreads = "1"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "1728" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "1729" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "12,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,12";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,12";  set ice_io_layout   =  "1,3"
else if ( "$npes" == "1730" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"
else if ( "$npes" == "1731" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "4"
  set nxblocks = "1" ; set nyblocks = "4" 
  set fv_layout    =   "3,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"
else if ( "$npes" == "1732" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "4"
  set nxblocks = "4" ; set nyblocks = "1" 
  set fv_layout    =   "3,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"
else if ( "$npes" == "1733" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "8"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ocean_layout =   "72,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "1740" ) then
  set atmos_npes = "432"
  set do_concurrent_radiation = ".true.";set radiation_nthreads = "2"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"
  set domains_stack_size = "2097152"

else if ( "$npes" == "2304" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2"
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8";  set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8";  set ice_io_layout   =  "1,4"

else if ( "$npes" == "2592" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
set do_concurrent_radiation = ".true." ; set radiation_nthreads = "1"
  set nxblocks = 2
  set nyblocks = 2
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "2688" ) then
  set atmos_npes = "672"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "8,14";  set fv_io_layout    =  "1,2"
  set land_layout  =   "8,14";  set land_io_layout  =  "1,2"
  set ice_layout   =   "112,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "112,6";   set ocn_io_layout =  "1,3"

else if ( "$npes" == "3072" ) then
  set atmos_npes = "768"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "8,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "128,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "128,6";   set ocn_io_layout =  "1,3"

else if ( "$npes" == "3456" ) then 
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2"
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,3"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "3458" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "8"
  set nxblocks = "4" ; set nyblocks = "2"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3"; set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"

else if ( "$npes" == "3470" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
set do_concurrent_radiation = ".true." ; set radiation_nthreads = "2"
  set nxblocks = 2
  set nyblocks = 2
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "3840" ) then 
  set atmos_npes = "960"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2"
  set fv_layout    =   "10,16";   set fv_io_layout    =  "1,4"
  set land_layout  =   "10,16";   set land_io_layout  =  "1,4"
  set ocean_layout =   "160,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "160,6";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "4224" ) then 
  set atmos_npes = "1056"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2"
  set fv_layout    =   "8,22";   set fv_io_layout    =  "1,2"
  set land_layout  =   "8,22";   set land_io_layout  =  "1,2"
  set ocean_layout =   "176,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "176,6";  set ice_io_layout   =  "1,3"


else if ( "$npes" == "4608" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "8"
  set nxblocks = "1" ; set nyblocks = "8" 
  set fv_layout    =   "8,12"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12"; set land_io_layout  =  "1,4"
  set ocean_layout =   "144,4"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"

else if ( "$npes" == "4609" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"

#FATAL from PE  4524: Domain Decomposition:  Cubed Sphere compute domain has a minium requirement of 4 points in X and Y
#This means components of fv_layout for c96 could at most be 96/4=24
#So, atmos_nthreads = 1 does not work for any npes > 24x24x6=3456
#else if ( "$npes" == "4609" ) then
#  set atmos_npes = "4608"
#  set atmos_nthreads = "1"
#  set nxblocks = "1" ; set nyblocks = "6" 
#  set fv_layout    =   "24,32"; set fv_io_layout    =  "1,4"
#  set land_layout  =   "24,32"; set land_io_layout  =  "1,4"
#  set ocean_layout =   "144,32"; set ocean_io_layout =  "1,4"
#  set ice_layout   =   "144,32"; set ice_io_layout   =  "1,4"
#FATAL from PE  2271: Domain Decomposition:  Cubed Sphere compute domain has a minium requirement of 4 points in X and Y, respectively

else if ( "$npes" == "6912" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "8"
  set nxblocks = "1" ; set nyblocks = "8"
  set fv_layout    =   "12,12";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,12";   set land_io_layout  =  "1,3"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "9216" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "8"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "8,24"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,24"; set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set domains_stack_size = "2097152"
else if ( "$npes" == "9217" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "24,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "24,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set domains_stack_size = "2097152"



else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in xml."
  if ( $echoOn ) set echo
  exit 1
endif

      ]]></csh>
      
    </input>
  </experiment>


  <experiment name="common_csh_blocks">
    <input>
      <csh><![CDATA[

# runCommand:
set platform_domain = `perl -T -e "use Net::Domain(hostdomain) ; print hostdomain"`
if ("${platform_domain}" == "ncrc.gov") then

  set place = $atmos_nthreads
  if ( $do_concurrent_radiation == ".true." ) then
     @ place += $radiation_nthreads
     setenv MALLOC_CHECK_ 5
     setenv MPICH_GNI_NDREG_LAZYMEM disabled	
  endif

  if ( $do_ocean == "true" ) then
    alias runCommand "aprun -d $place -n $atmos_npes ./$executable:t : -n $ocean_npes -d 1 ./$executable:t"
   else
    alias runCommand "aprun -d $place -n $atmos_npes ./$executable:t"
  endif
else if ("${platform_domain}" == "zeus.fairmont.rdhpcs.noaa.gov" ) then
  if ( $do_ocean == "true" ) then
    alias runCommand "mpiexec_mpt -np $atmos_npes -v omplace -nt $atmos_nthreads ./$executable:t : -np $ocean_npes -v omplace -nt 1 ./$executable:t"
   else
     alias runCommand "mpiexec_mpt -np $atmos_npes -v omplace -nt $atmos_nthreads ./$executable:t"
  endif
else if ("${platform_domain}" == "theia.fairmont.rdhpcs.noaa.gov" ) then
  if ( $do_ocean == "true" ) then
    alias runCommand "mpirun -n $atmos_npes  -env I_MPI_PIN_PROCESSOR_LIST allcores:grain=1,shift=$atmos_nthreads ./$executable:t : -n $ocean_npes -env I_MPI_PIN_PROCESSOR_LIST allcores:grain=1,shift=1 ./$executable:t"
   else
     alias runCommand "mpirun -n $atmos_npes -env I_MPI_PIN_PROCESSOR_LIST allcores:grain=1,shift=$atmos_nthreads ./$executable:t"
  endif
else
  echo "FATAL: Invalid platform ... unsure how to structure mpirun command"
  exit 53
endif

# Copy AWG and OWG ascii input files to GFDL (waiting for FRE to do this for us)
if ( $?flagOutputXferOn && $?flagOutputPostProcessOn ) then
#  module switch gcp/2.2 gcp/2.3
  #gcp --batch does not understand some variations of home filesystem like /autofs/mnt/ncrc-svm1_home1 so we need to massage rtsxml to comply
  set xmldirlocal = `dirname $rtsxml | sed -r "s/^\/(autofs|ncrc)\/.+\/$USER\//\~$USER\//"`
  set xmldirRemote = `echo $xmldirlocal | sed -r "$patternSedHome"`
  if ("${platform_domain}" == "ncrc.gov") then
    set xmldirRemote = `echo $xmldirlocal | sed -r "$patternSedHome;$patternSedCTMP;$patternSedCPERM"`
    gcp --batch -cd -r --sync $xmldirlocal/awg_include gfdl:$(AWG_INPUT_HOME_GFDL)/..
    gcp --batch -cd -r --sync $xmldirlocal/awg_include gfdl:$xmldirRemote/
  else if ("${platform_domain}" =~ *"fairmont.rdhpcs.noaa.gov"* ) then
    gcp -cd -r --sync $xmldirlocal/awg_include gfdl:$(AWG_INPUT_HOME_GFDL)/..
    gcp -cd -r --sync $xmldirlocal/awg_include gfdl:$xmldirRemote/
  endif
  #trick to copy MOM6 directory but avoid traversing the .datasets links
  tar cvf mom6.tar --exclude='.datasets' -C $(MOM6_EXAMPLES) . > /dev/null
  #tar cvf mom6.tar  --exclude='.datasets' --exclude='src' --exclude='INPUT'  -C $(MOM6_EXAMPLES) . > /dev/null
  mkdir mom6
  tar xvf mom6.tar -C ./mom6 > /dev/null
  if ("${platform_domain}" == "ncrc.gov") then
    gcp --batch -cd -r --sync mom6 gfdl:$(NB_ROOT)/
  else if ("${platform_domain}" =~ *"fairmont.rdhpcs.noaa.gov"* ) then
    gcp -cd -r --sync mom6 gfdl:$(NB_ROOT)/
  endif
endif

# create dummy MOM6 parameter file for do_ocean=.false.
touch $work/INPUT/MOM_input
touch $work/INPUT/MOM_override
touch $work/INPUT/SIS_override
touch $work/INPUT/SIS_layout
ln -s $work/INPUT/topog.nc $work/INPUT/ocean_topog.nc 

# Record the job stdout location for later use timings database

cat >> $HOME/frejobs_stdout <<EOF_frejobs
$stdoutDir/$FRE_JOBID
EOF_frejobs


      ]]></csh>

      <csh type="always"><![CDATA[
####COMMON ALWAYS CSH BEGINS######
# MOM6 restart switch
if ( $currentSeg == 1 ) then
   set restart_flag = 'n'
else
   set restart_flag = 'r'
endif

# adjustment of dry mass first time only
set adjust_dry_mass = ".true."
if (-e $work/INPUT/coupler.res) then
   set t1 = (`grep "Model start time"   $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   set t2 = (`grep "Current model time" $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   foreach i (1 2 3 4 5 6)
      if ( $t1[$i] != $t2[$i] ) then
         set adjust_dry_mass = ".false."
         break   
      endif      
   end
endif

####COMMON ALWAYS CSH ENDS######

      ]]></csh>
      
     </input>
  </experiment>
 
  <experiment name="c192_data_lm3p2">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <!--dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/lm3/19810101.static_veg.remapped_to_C192_OM4_025_southshifted.v20150302.tar</dataSource-->
        <dataSource platform="$(platform)">/lustre/f1/unswept/Sergey.Malyshev/DATA/static_veg/static_veg_LM3p2sosn_C192_OM4_025_historical_HC1_1981.remapped.v20150521.tar</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/lm3/c192_OM4_025_hydrography_v20140708.tar </dataSource>
      </dataFile>
      <dataFile label="gridSpec" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/grid/c192_OM4_025_grid_v20140708.tar</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="c192_atmos_domain_decomp">
    <input>
      <csh><![CDATA[
# Possible domain decomposition for c192 atmosphere only experiments (numbers from Rusty Benson).
set domains_stack_size = "3097152"
set do_ocean = "false"
set do_concurrent_radiation = ".false."

if ( "$npes" == "864" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "6,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,12";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3"; set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"


else if ( "$npes" == "1152" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,4"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"

else if ( "$npes" == "2304" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "4"
  set nxblocks = "3" ; set nyblocks = "8" 
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,4"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"


else if ( "$npes" == "3456" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set nxblocks = "4" ; set nyblocks = "4" 
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,6"; set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"

else if ( "$npes" == "4608" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "6" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"

else if ( "$npes" == "6144" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"

else if ( "$npes" == "6145" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set nxblocks = "3" ; set nyblocks = "3" 
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"

else if ( "$npes" == "6912" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "8"
  set nxblocks = "2" ; set nyblocks = "8"
  set fv_layout    =   "12,12";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,12";   set land_io_layout  =  "1,3"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"

else if ( "$npes" == "9216" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set nxblocks = "4" ; set nyblocks = "1" 
  set fv_layout    =   "24,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "24,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set domains_stack_size = "2097152"

else if ( "$npes" == "9217" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "8"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set domains_stack_size = "2097152"

else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in this xml."
  if ( $echoOn ) set echo
  exit 1
endif
      ]]></csh>

    </input>
  </experiment>

  <experiment name="c96_coupled_domain_decomp">
    <input>
      <csh><![CDATA[
# Coupled configurations
  set do_ocean = "true"
  set do_concurrent_radiation = ".false."

  set domains_stack_size = "2097152"


if ( "$npes" == "1584" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "1152"

else if ( "$npes" == "3168" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2304"

else if ( "$npes" == "1585" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "4" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "1152"

else if ( "$npes" == "1376" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "4" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.242.32x36"
  set ocean_npes = "910"

else if ( "$npes" == "1454" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "4" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "36,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.274.36x36"
  set ocean_npes = "1022"

else if ( "$npes" == "2208" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.548.32x72"
  set ocean_npes = "1756"

else if ( "$npes" == "2432" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "36,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.622.36x72"
  set ocean_npes = "1970"

else if ( "$npes" == "4672" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "72,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1402.72x72"
  set ocean_npes = "3782"

else if ( "$npes" == "2560" ) then
  set atmos_npes = "288"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "4,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "4,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,4";  set ice_io_layout   =  "1,4"
  set ocn_layout   =   "36,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.622.36x72"
  set ocean_npes = "1970"

else if ( "$npes" == "4960" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2"
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "72,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1402.72x72"
  set ocean_npes = "3782"


else if ( "$npes" == "2880" ) then
  set atmos_npes = "216"
  set atmos_nthreads = "2"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "3,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "72,3";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set ocean_npes   = "2432"

else if ( "$npes" == "2016" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,45"; set ocn_io_layout   =  "1,5"; set ocn_mask_table = "mask_table.315.32x45"
  set ocean_npes = "1125"

else if ( "$npes" == "2620" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.548.32x72"
  set ocean_npes = "1756"

else if ( "$npes" == "3296" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set ocean_npes   = "2432"

else if ( "$npes" == "3584" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2"
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set ocean_npes   = "2432"

else if ( "$npes" == "5279" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,12"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,12"; set land_io_layout  =  "2,4"
  set ice_layout   =   "72,12"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "90,54"; set ocn_io_layout   =  "2,6"; set ocn_mask_table = "mask_table.1309.90x54"
  set ocean_npes   = "3551"

else if ( "$npes" == "4704" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2"
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "90,54"; set ocn_io_layout   =  "2,6"; set ocn_mask_table = "mask_table.1309.90x54"
  set ocean_npes   = "3551"

else if ( "$npes" == "6975" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "2,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "90,72"; set ocn_io_layout   =  "2,4"; set ocn_mask_table = "mask_table.1809.90x72"
  set ocean_npes   = "4671"


else if ( "$npes" == "6400" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,12"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,12"; set land_io_layout  =  "2,4"
  set ice_layout   =   "72,12"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "90,72"; set ocn_io_layout   =  "2,4"; set ocn_mask_table = "mask_table.1809.90x72"
  set ocean_npes   = "4671"


####Experimental setups
else if ( "$npes" == "1600_1" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,45"; set ocn_io_layout   =  "1,5"; set ocn_mask_table = "mask_table.315.32x45"
  set ocean_npes = "1125"
else if ( "$npes" == "1472" ) then
#uses 1454 pes
  set atmos_npes = "432"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "36,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.274.36x36"
  set ocean_npes = "1022"
else if ( "$npes" == "2752" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2304"
else if ( "$npes" == "3169" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2304"

else if ( "$npes" == "4256" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1229.64x72"
  set ocean_npes = "3379"

else if ( "$npes" == "3456" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2304"

else if ( "$npes" == "2912" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.548.32x72"
  set ocean_npes = "1756"

else if ( "$npes" == "5824" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2"
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "90,72"; set ocn_io_layout   =  "2,4"; set ocn_mask_table = "mask_table.1809.90x72"
  set ocean_npes   = "4671"


else if ( "$npes" == "4160" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,12"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,12"; set land_io_layout  =  "2,4"
  set ice_layout   =   "72,12"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set ocean_npes   = "2432"

else if ( "$npes" == "5697" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "4"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1229.64x72"
  set ocean_npes = "3379"

else if ( "$npes" == "5696" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "2,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1229.64x72"
  set ocean_npes = "3379"


else if ( "$npes" == "6112" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "2,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "72,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1402.72x72"
  set ocean_npes = "3782"

else if ( "$npes" == "8128" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2"
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "90,72"; set ocn_io_layout   =  "2,4"; set ocn_mask_table = "mask_table.1809.90x72"
  set ocean_npes   = "4671"


else if ( "$npes" == "13792" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "2,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "90,144"; set ocn_io_layout   =  "2,4"; set ocn_mask_table = "mask_table.3785.90x144"
  set ocean_npes   = "9175"

#############################################################################################
# CM4i settings
else if ( "$npes" == "900" ) then
  set atmos_npes = 864
  set atmos_nthreads = 1
  set nxblocks = "1" ; set nyblocks = "1" 
  set fv_layout    = "12,12";   set fv_io_layout    = "1,4"
  set land_layout  = "12,12";   set land_io_layout  = "1,4"
  set ice_layout   = "144,6";   set ice_io_layout   = "1,6"
  set ocn_layout   = "6,6";     set ocn_io_layout   = "1,6"; set ocn_mask_table = "MOM_mask_table"  #360x210
  set ocean_npes = 36

else if ( "$npes" == "924" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "10,6";  set ocn_io_layout   =  "1,6"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "60"

else if ( "$npes" == "928" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "6,6";   set ocn_io_layout   =  "1,6"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "36"

else if ( "$npes" == "1792" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "8,8";    set ocn_io_layout   =  "1,8"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "64"

else if ( "$npes" == "3585" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "12,24";   set land_io_layout  =  "1,4"
  set ice_layout   =   "144,12";  set ice_io_layout   =  "1,4"
  set ocn_layout   =   "8,16";   set ocn_io_layout   =  "1,8"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "128"

else if ("$npes" == "1878" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "15,10";  set ocn_io_layout   =  "1,10"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "150"

else if ("$npes" == "1878" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set nxblocks = "2" ; set nyblocks = "2" 
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "15,10";  set ocn_io_layout   =  "1,10"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "150"

else if ( "$npes" == "32" ) then
#This setting is only for testing fast e2e
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "" ; set nyblocks = "" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "2,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "90,72"; set ocn_io_layout   =  "2,4"; set ocn_mask_table = "mask_table.1809.90x72"
  set ocean_npes   = "4671"

else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in this xml."
  if ( $echoOn ) set echo
  exit 1
endif

cat > $work/INPUT/MOM_layout << LAYOUT_EOF
LAYOUT = $ocn_layout
#override IO_LAYOUT = $ocn_io_layout
MASKTABLE = $ocn_mask_table
LAYOUT_EOF

cat > $work/INPUT/SIS_layout << SIS_LAYOUT_EOF
#override undef NIPROC
#override undef NJPROC
#override undef NIPROC_IO
#override undef NJPROC_IO
#override LAYOUT = $ice_layout
#override IO_LAYOUT = $ice_io_layout
SIS_LAYOUT_EOF

      ]]></csh>

    </input>
  </experiment>


  <experiment name="c192_coupled_domain_decomp">
    <input>
      <csh><![CDATA[
# Coupled configurations
set do_ocean = "true"
set do_concurrent_radiation = ".false."
set domains_stack_size = "3097152"
if ( "$npes" == "1152" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1" 
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "24,12"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "288"

else if ( "$npes" == "1119" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1"
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "16,18"; set ocn_io_layout   =  "4,2"; set ocn_mask_table = "mask_table.33.16x18"
  set ocean_npes = "255"

else if ( "$npes" == "1728" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1"
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "0,0"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "576"

else if ( "$npes" == "1632_1" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "1"
  set nxblocks = "1" ; set nyblocks = "1" 
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,18"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "mask_table.96.32x18"
  set ocean_npes = "480"

else if ( "$npes" == "1632" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set nxblocks = "3" ; set nyblocks = "4" 
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,18"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "mask_table.96.32x18"
  set ocean_npes = "480"

else if ( "$npes" == "3456" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "4" 
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "1152"

else if ( "$npes" == "3457" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "4" 
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "0,0"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "1152"

else if ( "$npes" == "3458" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "4" 
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "36,32"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "1152"

else if ( "$npes" == "3210" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "4" 
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.242.32x36"
  set ocean_npes = "910"

else if ( "$npes" == "4384" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set nxblocks = "4" ; set nyblocks = "4" 
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.242.32x36"
  set ocean_npes = "910"

else if ( "$npes" == "4385" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "2" 
  set fv_layout    =   "12,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,12"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.242.32x36"
  set ocean_npes = "910"

else if ( "$npes" == "5216" ) then 
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2"
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.548.32x72"
  set ocean_npes = "1756"


else if ( "$npes" == "5536" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.242.32x36"
  set ocean_npes = "910"

else if ( "$npes" == "3429" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "4" 
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,45"; set ocn_io_layout   =  "1,5"; set ocn_mask_table = "mask_table.315.32x45"
  set ocean_npes = "1125"

else if ( "$npes" == "3744" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set nxblocks = "1" ; set nyblocks = "4" 
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,45"; set ocn_io_layout   =  "1,5"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "1440"



else if ( "$npes" == "6364" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.548.32x72"
  set ocean_npes = "1756"

else if ( "$npes" == "6912" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2304"

else if ( "$npes" == "7200" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "36,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2592"


else if ( "$npes" == "5440" ) then 
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2"
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "36,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.622.36x72"
  set ocean_npes = "1970"

else if ( "$npes" == "5888" ) then 
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "2"
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set ocean_npes   = "2432"


else if ( "$npes" == "6592" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "36,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.622.36x72"
  set ocean_npes = "1970"

else if ( "$npes" == "13024" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4"
  set fv_layout    =   "12,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "72,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1402.72x72"
  set ocean_npes = "3782"

else if ( "$npes" == "13824" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set nxblocks = "4" ; set nyblocks = "1" 
  set fv_layout    =   "24,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "24,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "4608"

else if ( "$npes" == "7040" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "4" ; set nyblocks = "1" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set do_ocean = "true"
  set ocean_npes   = "2432"

else if ( "$npes" == "7008" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "75,32"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes   = "2400"

else if ( "$npes" == "7848" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set nxblocks = "" ; set nyblocks = "" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes   = "3240"

else if ( "$npes" == "8169" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set nxblocks = "" ; set nyblocks = "" 
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,45"; set ocn_io_layout   =  "1,5"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes   = "2025"

else if ( "$npes" == "8448" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set nxblocks = "" ; set nyblocks = ""
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes   = "2304"

else if ( "$npes" == "8576" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set nxblocks = "" ; set nyblocks = "" 
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set do_ocean = "true"
  set ocean_npes   = "2432"

else if ( "$npes" == "9344" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4"
  set fv_layout    =   "12,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,24";   set land_io_layout  =  "1,3"
  set ice_layout   =   "144,12";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set do_ocean = "true"
  set ocean_npes   = "2432"

else if ( "$npes" == "9824" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4"
  set fv_layout    =   "12,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,24";   set land_io_layout  =  "1,3"
  set ice_layout   =   "144,12";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "54,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1007.54x72"
  set do_ocean = "true"
  set ocean_npes   = "2881"

else if ( "$npes" == "12595" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4" 
  set fv_layout    =   "16,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "16,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72";  set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1229.64x72"
  set ocean_npes = "3379"

else if ( "$npes" == "12596" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "8"
  set nxblocks = "4" ; set nyblocks = "2" 
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72";  set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1229.64x72"
  set ocean_npes = "3379"

else if ( "$npes" == "13025" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set nxblocks = "2" ; set nyblocks = "4" 
  set fv_layout    =   "16,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "16,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "72,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1402.72x72"
  set ocean_npes = "3782"

else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in this xml."
  if ( $echoOn ) set echo
  exit 1
endif

cat > $work/INPUT/MOM_layout << LAYOUT_EOF
LAYOUT = $ocn_layout
#override IO_LAYOUT = $ocn_io_layout
MASKTABLE = $ocn_mask_table
LAYOUT_EOF

cat > $work/INPUT/SIS_layout << SIS_LAYOUT_EOF
#override undef NIPROC
#override undef NJPROC
#override undef NIPROC_IO
#override undef NJPROC_IO
#override LAYOUT = $ice_layout
#override IO_LAYOUT = $ice_io_layout
SIS_LAYOUT_EOF

      ]]></csh>


      </input>
  </experiment>

<!--================================-->
<!--= TEMPLATES FOR POSTPROCESSING =-->
<!--================================-->
  <experiment name="c96_climo_postprocess">
    <postProcess>

      <component type="atmos" zInterp="era40" source="atmos_month" sourceGrid="atmos-cubedsphere" xyInterp="180,288">
        <timeSeries freq="3hr" source="atmos_8xdaily" chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmos8xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
<!-- MDBI, this switch must be on to trigger "fredb" automatically -->
          <analysis switch="$(MDBIswitch)" cumulative="no" script="$FRE_CURATOR_HOME/share/bin/database_ingestor.csh"/>
<!-- /MDBI -->
        </timeSeries>
        <timeSeries freq="6hr" source="atmos_4xdaily" chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmos4xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="atmos_daily" chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmosDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmosMonthTS/*)">
            <xi:fallback/>
          </xi:include>
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/a1r/analysis/agu/Krasting/pywavelet_jpk_a1r.py -varname t_surf -comp atmos"/>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_A)">
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.atmos.csh"/>
	</timeAverage>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_B)">
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.atmos.csh"/>
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmosMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
        <timeAverage source="annual" interval="$(PP_CPLD_CHUNK_A)"/>
        <timeAverage source="annual" interval="$(PP_CPLD_CHUNK_B)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmosAnnualAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_level" source="atmos_month" sourceGrid="atmos-cubedsphere" xyInterp="180,288">
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)"/>
        <timeSeries freq="annual"  chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmosLevelAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_A)"/>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_B)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmosLevelMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_month_aer" source="atmos_month_aer" sourceGrid="atmos-cubedsphere" xyInterp="180,288" interpMethod="conserve_order1">
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_A)"/>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_B)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmosMonthAerAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_diurnal" source="atmos_diurnal" sourceGrid="atmos-cubedsphere" xyInterp="180,288">
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)"/>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_A)"/>
      </component>

      <component type="atmos_scalar" source="atmos_scalar">
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)"/>
      </component>

<!-- FULL CHEMISTRY -->
      <component type="tracer_level" source="atmos_tracer" sourceGrid="atmos-cubedsphere" xyInterp="180,288" interpMethod="conserve_order1">
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)"/>
        <timeSeries freq="annual" chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/tracerAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_A)"/>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_B)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/tracerMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

<!-- LAND -->
      <component type="land" source="land_month" sourceGrid="land-cubedsphere" xyInterp="180,288" interpMethod="conserve_order1">
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_CPLD_CHUNK_A)"/>
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/landMonthTS/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeAverage source="annual" interval="$(PP_CPLD_CHUNK_A)"/>
        <timeAverage source="annual" interval="$(PP_CPLD_CHUNK_B)"/>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_A)"/>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_B)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/landMonthAve/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeAverage>
      </component>

      <component type="land_cubic" source="land_month" cubicToLatLon="none">
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)" >
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/landMonthTSNative/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/landDailyTSNative/*)">
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
      </component>

      <component type="land_instant_cubic" source="land_month_inst" cubicToLatLon="none">
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)" />
      </component>

    </postProcess>
  </experiment>

   <experiment name="c192_climo_postprocess">
    <postProcess>

      <component type="atmos" zInterp="era40" source="atmos_month" sourceGrid="atmos-cubedsphere" xyInterp="360,576">
        <timeSeries freq="3hr" source="atmos_8xdaily" chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmos8xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
<!-- MDBI, this switch must be on to trigger "fredb" automatically -->
          <analysis switch="$(MDBIswitch)" cumulative="no" script="$FRE_CURATOR_HOME/share/bin/database_ingestor.csh"/>
<!-- /MDBI -->
        </timeSeries>
        <timeSeries freq="6hr" source="atmos_4xdaily" chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmos4xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="atmos_daily" chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmosDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmosMonthTS/*)">
            <xi:fallback/>
          </xi:include>
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/a1r/analysis/agu/Krasting/pywavelet_jpk_a1r.py -varname t_surf -comp atmos"/>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_A)">
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.atmos.csh"/>
	</timeAverage> 
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_B)">
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.atmos.csh"/>
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmosMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
        <timeAverage source="annual" interval="$(PP_CPLD_CHUNK_A)" calcInterval="$(PP_CPLD_CHUNK_A)"/>
        <timeAverage source="annual" interval="$(PP_CPLD_CHUNK_B)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmosAnnualAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_level" source="atmos_month" sourceGrid="atmos-cubedsphere" xyInterp="360,576">
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)"/>
        <timeSeries freq="annual"  chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmosLevelAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_A)"/>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_B)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmosLevelMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_month_aer" source="atmos_month_aer" sourceGrid="atmos-cubedsphere" xyInterp="360,576" interpMethod="conserve_order1">
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_A)"/>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_B)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/atmosMonthAerAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_diurnal" source="atmos_diurnal" sourceGrid="atmos-cubedsphere" xyInterp="360,576">
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)"/>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_A)"/>
      </component>

      <component type="atmos_scalar" source="atmos_scalar">
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)"/>
      </component>

<!-- FULL CHEMISTRY -->
      <component type="tracer_level" source="atmos_tracer" sourceGrid="atmos-cubedsphere" xyInterp="360,576" interpMethod="conserve_order1">
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)"/>
        <timeSeries freq="annual"  chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/tracerAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_A)"/>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_B)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/tracerMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

<!-- LAND -->
      <component type="land" source="land_month" sourceGrid="land-cubedsphere" xyInterp="360,576" interpMethod="conserve_order1">
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_CPLD_CHUNK_A)"/>
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/landMonthTS/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_A)"/>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_B)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/landMonthAve/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeAverage>
      </component>

      <component type="land_cubic" source="land_month" cubicToLatLon="none">
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)" >
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/landMonthTSNative/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_CPLD_CHUNK_A)">
          <xi:include href="./awg_include/analysis/analysis_cpld.xml" xpointer="xpointer(*/landDailyTSNative/*)">
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
      </component>

      <component type="land_instant_cubic" source="land_month_inst" cubicToLatLon="none">
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)" />
      </component>

    </postProcess>
  </experiment>


<!--====================-->
<!--= AMIP EXPERIMENTS =-->
<!--====================-->


<experiment name="c96L32_am4g5r1" inherit="cm4_compile">
    <description
communityProject="$(ProjectID)" 
communityModel="am4p5" 
communityModelID="am4p5"
communityExperimentName="$(name)" 
     >
AM4 prototype configuration "am4g5r1" from MDT Atmosphere Working Group.
Derived from "am4g5", but with flu_exchange bug fixes and revised settings
for dynamics time stepping.

- c96 horizontal grid with approximately 100km resolution and 32 vertical levels.
- Convection based on "double-plume" from Ming Zhao.
- Tiedtke cloud scheme

For more information about AWG configurations, refer to
http://cobweb.gfdl.noaa.gov/~cjg/awg

    </description>


    <input>
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">/lustre/f1/unswept/Huan.Guo/INPUT/InitCond/AWG_c96L32/topo_v20150507/awg_C96L32_LM3_OM4_025_grid_lm3p2_19810101.remapped.topodrag.v20150507.tar</dataSource>
      </dataFile>
      <namelist name="flux_exchange_nml">
        nblocks=$atmos_nthreads
      </namelist>
      <namelist name="atmos_model_nml">
         nxblocks = $nxblocks
	 nyblocks = $nyblocks
      </namelist>
      <!-- Namelist -->
      <namelist file="$(AWG_INPUT_HOME)/nml/ocean.nml"/>       
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p5_common.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4g5_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4g5_c96L32.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p5_amip.nml"/>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1980,1,1,0,0,0,
        calendar = 'julian'
        dt_atmos = 1800,
        dt_cpld  = 7200,
        use_lag_fluxes = .true.
        concurrent = .false.
        do_ocean = .false.
        ocean_npes = 0
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <!-- Input datasets -->
      <xi:include xpointer="xpointer(//experiment[@name='common_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='diag_table_lm3p2_faero']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='field_table_am4p5_faero']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='amip_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='L32_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_atmos_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>

    </input>

    <runtime>
      <regression name="basic">
        <run days="8"   npes="432" overrideParams="xgrid_nml:make_exchange_reproduce=.true."  runTimePerJob="02:30:00"/>
      </regression>
      <regression name="rts">
        <run days="4 4"  npes="432" overrideParams="xgrid_nml:make_exchange_reproduce=.true."  runTimePerJob="02:30:00"/>
        <run days="8"    npes="864" overrideParams="xgrid_nml:make_exchange_reproduce=.true."  runTimePerJob="02:30:00"/>
      </regression>

      <regression name="restarts">
        <run days="4 4" npes="432" overrideParams="xgrid_nml:make_exchange_reproduce=.true."  runTimePerJob="02:30:00"/>
      </regression>
      
      <regression name="debug">
        <run days="1" npes="3458"  runTimePerJob="02:30:00"/>
      </regression>
      
      <regression name="timing">
        <run months="1" npes="4224"  runTimePerJob="00:30:00"/>
      </regression>

      <regression name="timings">
        <run months="1" npes="432"  runTimePerJob="02:00:00"/>
        <run months="1" npes="864"  runTimePerJob="01:00:00"/>
        <run months="1" npes="1152"  runTimePerJob="00:40:00"/>
        <run months="1" npes="1728" runTimePerJob="00:45:00"/>
        <run months="1" npes="2304" runTimePerJob="00:30:00"/>
        <run months="1" npes="3072" runTimePerJob="00:30:00"/>
        <run months="1" npes="3456" runTimePerJob="00:30:00"/>
        <run months="1" npes="4608"  runTimePerJob="00:30:00"/>
     </regression>

      <regression name="timingsBig">
        <run months="1" npes="6912"  runTimePerJob="00:30:00"/>
        <run months="1" npes="9216"  runTimePerJob="00:30:00"/>
      </regression>

      <regression name="timingFRE">
        <run months="1" npes="216"  runTimePerJob="02:00:00" overrideParams="$(domainparams_A216x2)"/>
        <run months="1" npes="432"  runTimePerJob="02:00:00" overrideParams="$(domainparams_A432x2)"/>
      </regression>

      <reference restart="$(REFERENCE)/archive/1x0m8d_432pe/restart/19800109.tar"/>

    </runtime>

</experiment>


<experiment name="c96L32_am4g5r1_conc_rad" inherit="c96L32_am4g5r1">
    <input>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1980,1,1,0,0,0,
        calendar = 'julian'
        dt_atmos = 1800,
        dt_cpld  = 7200,
        use_lag_fluxes = .true.
        concurrent = .false.
        do_ocean = .false.
        ocean_npes = 0
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
        radiation_nthreads = $radiation_nthreads
        do_concurrent_radiation = $do_concurrent_radiation
       </namelist>
      <namelist name="flux_exchange_nml">
	nblocks=$atmos_nthreads
      </namelist>
    </input>
    
    <runtime>
      <regression name="basic">
        <run days="8"   npes="870" overrideParams="xgrid_nml:make_exchange_reproduce=.true."  runTimePerJob="02:30:00"/>
      </regression>
      <regression name="rts">
        <run days="4 4"  npes="870" overrideParams="xgrid_nml:make_exchange_reproduce=.true."  runTimePerJob="02:30:00"/>
      </regression>
      <regression name="timings">
        <run months="1"   npes="1740"  runTimePerJob="02:30:00"/>
        <run months="1"   npes="3470"  runTimePerJob="02:30:00"/>
      </regression>
    </runtime>
</experiment>


<experiment name="c192L32_am4g5r1" inherit="cm4_compile">
    <description
communityProject="$(ProjectID)" 
communityModel="am4p5" 
communityModelID="am4p5"
communityExperimentName="$(name)" 
     >
AM4 prototype configuration "am4g5r1" from MDT Atmosphere Working Group.
Derived from "am4g5", but with flu_exchange bug fixes and revised settings
for dynamics time stepping.

- c192 horizontal grid with approximately 50km resolution and 32 vertical levels.
- Convection based on "double-plume" from Ming Zhao.
- Tiedtke cloud scheme

For more information about AWG configurations, refer to
http://cobweb.gfdl.noaa.gov/~cjg/awg

    </description>


    <input>
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">/lustre/f1/unswept/Huan.Guo/INPUT/InitCond/AWG_c192L32_newLand20150522/Combine_LM3p2sosn_C192_OM4_025_19810101.remapped.v20150521_With_southshifted.v20150302.tar</dataSource>
      </dataFile>
      <namelist name="flux_exchange_nml">
        nblocks=$atmos_nthreads
      </namelist>
      <namelist name="atmos_model_nml">
         nxblocks = $nxblocks
	 nyblocks = $nyblocks
      </namelist>
      <!-- Namelist -->
      <namelist file="$(AWG_INPUT_HOME)/nml/ocean.nml"/>       
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p5_common.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4g5_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4g5_c192L32.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p5_amip.nml"/>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1980,1,1,0,0,0,
        calendar = 'julian'
        dt_atmos = 1200,
        dt_cpld  = 7200,
        use_lag_fluxes = .true.
        concurrent = .false.
        do_ocean = .false.
        ocean_npes = 0
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <!-- Input datasets -->
      <xi:include xpointer="xpointer(//experiment[@name='common_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='diag_table_lm3p2_faero']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='field_table_am4p5_faero']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='amip_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='L32_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192_atmos_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>

    </input>

    <runtime>
      <regression name="basic">
        <run days="8" npes="864" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:00:00"/>
      </regression>
      <regression name="rts">
        <run days="4 4" npes="864" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:00:00"/>
        <run days="8" npes="1152" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:00:00"/>
      </regression>

      <regression name="restarts">
        <run days="4 4" npes="864" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:00:00"/>
      </regression>
      <regression name="timing">
        <run months="1"   npes="2304" runTimePerJob="02:30:00"/>
        <run months="1"   npes="3456" runTimePerJob="03:00:00"/>
        <run months="1"   npes="4608" runTimePerJob="03:00:00"/>
      </regression>
      <regression name="timings">
        <run months="1"   npes="864"  runTimePerJob="03:30:00"/> 
        <run months="1"   npes="1152" runTimePerJob="03:00:00"/> 
        <run months="1"   npes="2304" runTimePerJob="02:30:00"/>
        <run months="1"   npes="3456" runTimePerJob="03:00:00"/>
        <run months="1"   npes="4608" runTimePerJob="03:00:00"/>
        <run months="1"   npes="6144" runTimePerJob="02:30:00"/>
        <run months="1"   npes="6912" runTimePerJob="02:00:00"/>
        <run months="1"   npes="9216"  runTimePerJob="02:00:00"/>
        <run months="1"   npes="9217"  runTimePerJob="02:00:00"/>
      </regression>

      <reference restart="$(REFERENCE)/archive/1x0m8d_864pe/restart/19800109.tar"/>

    </runtime>

</experiment>
   
<!--=====================-->
<!--= CPLD EXPERIMENTS =-->
<!--=====================-->
<!-- do_ocean=.false. -->

<!--=======================-->
<!--= CM4 EXPERIMENTS     =-->
<!--=======================-->

<experiment name="CM4_c96L32_am4g5r1_2000" inherit="cm4_compile">
    <description
communityProject="$(ProjectID)" 
communityModel="CM4_c96_am4p5_SIS  $(MOM6_GIT_TAG)" 
communityModelID="CM4_c96_am4p5_SIS"
communityExperimentName="$(name)">
    </description>
    <communityComment>
For more information please refer to the
&lt;a href="http://wiki.gfdl.noaa.gov/index.php/MDT_Coupled"&gt; Coupled Working Group Wiki.  &lt;/a&gt;
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_CPLD_START)"
      endTime="$(EXP_CPLD_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>

    <input>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1,1,1,0,0,0,
        calendar = 'NOLEAP'
        dt_atmos = 1800,
        dt_cpld  = 3600,
        use_lag_fluxes = .true.
        concurrent = .true.
        do_ocean = .true.
        ocean_npes = $ocean_npes
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <namelist name="flux_exchange_nml">
            nblocks=$atmos_nthreads
            debug_stocks = .FALSE.
            divert_stocks_report = .TRUE.
            do_area_weighted_flux = .FALSE.
      </namelist>
      <namelist name="fms_io_nml">
            fms_netcdf_restart=.true.
            threading_read='multi'
            max_files_r = 200
            max_files_w = 200
      </namelist>
      <namelist name="fms_nml">
            clock_grain='ROUTINE'
            clock_flags='NONE'
            domains_stack_size = 5000000
            stack_size =0
      </namelist>
      <namelist name="xgrid_nml">
        make_exchange_reproduce = .true.
        interp_method = 'second_order'
      </namelist>

      <namelist name="atmos_model_nml">
         nxblocks = $nxblocks
	 nyblocks = $nyblocks
      </namelist>
      <!--AWG Input datasets -->
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p5_common.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4g5_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4g5_c96L32.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p5_2000climo.nml"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='diag_table_lm3p2_faero']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='field_table_am4p5_faero']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='L32_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96L32_initCond']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_coupled_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>
      
      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data']/input/node())"/>
    </input>

    <runtime>
      <production simTime="$(PROD_SIMTIME)" units="years" npes="2432" runTime="12:00:00">
        <segment simTime="12" units="months" runTime="12:00:00"/>
      </production>
      <regression name="basic">
        <run days="10" npes="1584" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:20:00"/>
      </regression>

      <regression name="rts">
        <run days="5 5" npes="1584" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:20:00"/>
        <run days="10"  npes="3168" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="00:20:00"/>
        <run months="1" npes="2560" runTimePerJob="01:00:00"/>
     </regression>

      <regression name="restarts">
        <run days="5 5" npes="1584" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:20:00"/><!---->
      </regression>

      <regression name="debug">
        <run days="1" npes="2560" runTimePerJob="02:00:00"/>
      </regression>

      <regression name="timing">
        <run months="1" npes="4672" runTimePerJob="01:00:00"/>
      </regression>

      <regression name="timingsL32">
        <run months="1" npes="2432" runTimePerJob="01:00:00"/>
        <run months="1" npes="2560" runTimePerJob="01:00:00"/>
      </regression>
     
      <regression name="timingL48">
        <run months="1" npes="3296" runTimePerJob="01:00:00"/>
      </regression>
     
      <regression name="timingsL48">
        <run months="1" npes="1376" runTimePerJob="01:00:00"/>
        <run months="1" npes="1454" runTimePerJob="01:00:00"/>
        <run months="1" npes="2620" runTimePerJob="01:00:00"/>
        <run months="1" npes="3584" runTimePerJob="01:00:00"/>
	<run months="1" npes="5279" runTimePerJob="01:00:00"/>
        <run months="1" npes="6975" runTimePerJob="01:00:00"/>
        <run months="1" npes="4704" runTimePerJob="01:00:00"/>
        <run months="1" npes="3296" runTimePerJob="01:00:00"/>
      </regression>

      <reference restart="$(REFERENCE)/archive/1x0m10d_1584pe/restart/00010111.tar"/>

    </runtime>

    <postProcess>
      <xi:include xpointer="xpointer(//experiment[@name='c96_climo_postprocess']/postProcess/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='OM4_postprocess']/postProcess/node())"/>
    </postProcess>

</experiment>

<experiment name="CM4_c192L32_am4g5r1_2000" inherit="cm4_compile">
    <description
communityProject="$(ProjectID)" 
communityModel="CM4_c192_am4p5_SIS  $(MOM6_GIT_TAG)" 
communityModelID="CM4_c192_am4p5_SIS"
communityExperimentName="$(name)">
    </description>
    <communityComment>
For more information please refer to the
&lt;a href="http://wiki.gfdl.noaa.gov/index.php/MDT_Coupled"&gt; Coupled Working Group Wiki.  &lt;/a&gt;
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_CPLD_START)"
      endTime="$(EXP_CPLD_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>

    <input>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1,1,1,0,0,0,
        calendar = 'NOLEAP'
        dt_atmos = 1200,
        dt_cpld  = 3600,
        use_lag_fluxes = .true.
        concurrent = .true.
        do_ocean = .true.
        ocean_npes = $ocean_npes
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <namelist name="flux_exchange_nml">
            nblocks=$atmos_nthreads
            debug_stocks = .FALSE.
            divert_stocks_report = .TRUE.
            do_area_weighted_flux = .FALSE.
      </namelist>
      <namelist name="fms_io_nml">
            fms_netcdf_restart=.true.
            threading_read='multi'
            max_files_r = 200
            max_files_w = 200
      </namelist>
      <namelist name="fms_nml">
            clock_grain='ROUTINE'
            clock_flags='NONE'
            domains_stack_size = 5000000
            stack_size =0
      </namelist>
      <namelist name="xgrid_nml">
        make_exchange_reproduce = .true.
        interp_method = 'second_order'
      </namelist>

      <namelist name="atmos_model_nml">
         nxblocks = $nxblocks
	 nyblocks = $nyblocks
      </namelist>
      <!--AWG Input datasets -->
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p5_common.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4g5_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4g5_c192L32.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p5_2000climo.nml"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='diag_table_lm3p2_faero']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='field_table_am4p5_faero']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='L32_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192L32_initCond']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192_coupled_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>

      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data']/input/node())"/>
    </input>

    <runtime>
      <production simTime="$(PROD_SIMTIME)" units="years" npes="5888" runTime="12:00:00">
        <segment simTime="12" units="months" runTime="12:00:00"/>
      </production>
      <regression name="basic">
        <run days="10" npes="1728"  overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:20:00"/>
      </regression>

      <regression name="rts"> 
        <run days="5 5" npes="1728" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:20:00"/>
	<run days="10" npes="3456" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="00:30:00"/>
	<run days="10" npes="3429" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="00:30:00"/>
      </regression>

      <regression name="timingL32">
        <run months="1" npes="5888" runTimePerJob="01:00:00"/>
      </regression>

      <reference restart="$(REFERENCE)/archive/1x0m10d_1728pe/restart/00010111.tar"/>
    </runtime>

    <postProcess>
      <xi:include xpointer="xpointer(//experiment[@name='c192_climo_postprocess']/postProcess/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='OM4_postprocess']/postProcess/node())"/>
    </postProcess>

</experiment>



<!--================================-->
<!--= OCEAN-ICE DATA (0.25 degree) =-->
<!--================================-->
<experiment name="OM4_data">
    <input>
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/MOM_input
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/layer_coord.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/seawifs_1998-2006_smoothed_2X.v20140616.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/tidal_amplitude.v20140616.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/MOM_channels_global_025
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/vgrid_75_2m.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/WOA05_pottemp_salt.nc 
     </dataFile>      

     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.33.16x18     
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.96.32x18     
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.242.32x36     
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.274.36x36     
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.315.32x45    
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.548.32x72
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.622.36x72
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.808.45x72
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.1053.90x45
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.1809.90x72
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.1309.90x54     
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.1402.72x72
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.3785.90x144
     </dataFile>
<!--
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.1007.54x72       
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/mask_table.1229.64x72
-->
     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/diag_table.MOM6</dataSource>
        <dataSource site="nescc">$(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/diag_table.MOM6</dataSource>
        <dataSource site="theia">$(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/diag_table.MOM6</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/ice_ocean_SIS/OM4_025/diag_table.MOM6</dataSource>
     </dataFile>

     <namelist name="MOM_input_nml" >
         output_directory = './',
         input_filename = '$restart_flag'
         restart_input_dir = 'INPUT/',
         restart_output_dir = 'RESTART/',
         parameter_filename = 'INPUT/MOM_input','INPUT/MOM_layout','INPUT/MOM_override'
     </namelist>
      <namelist name="ice_albedo_nml">
            t_range = 10.
      </namelist>
      <namelist name="monin_obukhov_nml">
	stable_option = 2,
        rich_crit = 1.0,
        zeta_trans = 0.5
      </namelist>
 
     </input>

</experiment>

<experiment name="SIS_data">
    <input>
     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/diag_table.SIS</dataSource>
        <dataSource site="nescc">$(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/diag_table.SIS</dataSource>
        <dataSource site="theia">$(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/diag_table.SIS</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/ice_ocean_SIS/OM4_025/diag_table.SIS</dataSource>
     </dataFile>

     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/diag_table.icebergs</dataSource>
        <dataSource site="nescc">$(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/diag_table.icebergs</dataSource>
        <dataSource site="theia">$(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/diag_table.icebergs</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/ice_ocean_SIS/OM4_025/diag_table.icebergs</dataSource>
     </dataFile>

     <dataFile label="input" target="INPUT/ice_model.res.nc" chksum="" size="" timestamp="">
       $(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/.datasets/OM4_025/INPUT/ice_model.res.v20140620.nc
     </dataFile> 

     <namelist name="ice_model_nml">
           layout = $ice_layout
           io_layout = $ice_io_layout
           nsteps_dyn=144
           nsteps_adv=2
           num_part = 6
           wd_turn = 0.0
           spec_ice=.false.
           ice_bulk_salin = 0.0
           alb_sno = 0.85                    ! keep CM2 setting
           alb_ice = 0.65                    ! keep CM2 setting
           t_range_melt = 1.0                ! NOTE: CM2 uses 1.0
           heat_rough_ice = 5.0e-4
           cm2_bugs = .false.
           do_icebergs = .true.
           add_diurnal_sw = .false.
           do_ice_limit=.false.
           max_ice_limit=4.0
           channel_viscosity=0.e5
           h_lo_lim = 1.e-10
      </namelist>
      <namelist name="icebergs_nml">
        really_debug=.FALSE.
        debug=.FALSE.
        verbose=.FALSE.
        verbose_hrs=7200
        use_operator_splitting=.TRUE.
        bergy_bit_erosion_fraction=0.0
        sicn_shift=0.1
        parallel_reprod=.TRUE.
        traj_sample_hrs=0
        add_weight_to_ocean=.false.
      </namelist>

      <namelist name="ocean_albedo_nml">
            ocean_albedo_option = 5
      </namelist>
      <namelist name="ocean_rough_nml">
            rough_scheme = 'beljaars'
      </namelist>
     </input>
</experiment>

  <experiment name="OM4_postprocess">
    <postProcess>
        <csh><![CDATA[
	 #Take care of iceberg restarts and trajectories
         cd $work/RESTART
         ncrcat icebergs.res.nc.* icebergs.res.nc
         if ( -e icebergs.res.nc )  rm -f icebergs.res.nc.*
         cd $work
         ncrcat iceberg_trajectories.nc.* iceberg_trajectories.nc
         if ( -e iceberg_trajectories.nc ) rm -f iceberg_trajectories.nc.* 
         #Save the last line of timestats without the first (step number) column as a signature of MOM6 answers
         tail -1 timestats | cut -c8- > RESTART/$enddate.timestats.res
         #Save the whole timestats under ascii/
         mv timestats $enddate.timestats
         mv timestats.nc $enddate.timestats.nc
         #Make a directory to trick FRE to pick up and archive in ascii
         mkdir extra.results
         mv *velocity_truncations MOM_parameter_doc* SIS_parameter_doc* seaice.stats timestats extra.results/
         ]]></csh>
      <!--REFINE DIAG SCRIPT -->
      <!--refineDiag_data_stager.csh calculates global averages of basic quantities and stores them in a sqlit database file-->
      <!--By default a refineDiag script causes the annual history files to be unpacked and saved in /ptmp/$USER-->
      <refineDiag script="$(NB_ROOT)/mom6/tools/analysis/MOM6_refineDiag.csh /home/fms/local/opt/fre-analysis/test/eem/code/cm4_web_analysis/refineDiagScript/refineDiag_data_stager_globalAve.csh"/>

      <component type="ocean_monthly"   source="ocean_month" sourceGrid="ocean-tripolar">
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)" source="ocean_month">
          <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(NB_ROOT)/mom6/ice_ocean_SIS/OM4_025/ocn_monthly.frepp"/>
        </timeSeries>

        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_A)" >
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.ocean.csh"/>
	</timeAverage>
        <timeAverage source="monthly" interval="$(PP_CPLD_CHUNK_B)" >
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.ocean.csh"/>
	</timeAverage>
      </component>

      <component type="ocean_annual"    source="ocean_annual" sourceGrid="ocean-tripolar">
        <timeAverage source="annual"  interval="$(PP_CPLD_CHUNK_A)">
          <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(NB_ROOT)/mom6/ice_ocean_SIS/OM4_025/ocn_annual.frepp"/>
        </timeAverage>
        <timeAverage source="annual" interval="$(PP_CPLD_CHUNK_B)">
          <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(NB_ROOT)/mom6/ice_ocean_SIS/OM4_025/ocn_annual.frepp"/>
        </timeAverage>
      </component>

      <component type="ocean_annual_z" source="ocean_annual_z" sourceGrid="ocean-tripolar">
        <timeAverage source="annual" interval="$(PP_CPLD_CHUNK_A)">
          <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(NB_ROOT)/mom6/ice_ocean_SIS/OM4_025/ocn_annual_z.frepp"/>
        </timeAverage>
        <timeAverage source="annual" interval="$(PP_CPLD_CHUNK_B)">
          <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(NB_ROOT)/mom6/ice_ocean_SIS/OM4_025/ocn_annual_z.frepp"/>
        </timeAverage>

        <timeSeries freq="annual"   chunkLength="$(PP_CPLD_CHUNK_B)" source="ocean_annual_z"/>
	
      </component>

      
      <component type="ice"  source="ice_month" sourceGrid="ocean-tripolar">
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_A)"  source="ice_month">
	   <analysis switch="$(ANALYSIS_SWITCH)" script="$(NB_ROOT)/mom6/tools/analysis/Krasting-SeaIce.csh"/>
	</timeSeries>   
        <timeSeries freq="monthly" chunkLength="$(PP_CPLD_CHUNK_B)"  source="ice_month">
	   <analysis switch="$(ANALYSIS_SWITCH)" script="$(NB_ROOT)/mom6/tools/analysis/Krasting-SeaIce.csh"/>
	</timeSeries>   
        <timeAverage source="annual"  interval="$(PP_CPLD_CHUNK_A)"/>
        <timeAverage source="annual"  interval="$(PP_CPLD_CHUNK_B)"/>
      </component>     

    </postProcess>
  </experiment> 



<experiment name="c96L32_am4g5_fullchem" inherit="c96L32_am4g5">
    <description
communityProject="$(ProjectID)" 
communityModel="am4p5" 
communityModelID="am4p5"
communityExperimentName="$(name)" 
    >
AM4 prototype configuration "am4a1r1" from MDT Atmosphere Working Group,
with full AM3 chemistry activated.

c96 horizontal grid with approximately 100km resolution and 48 vertical levels.
Convection based on "double-plume 3" from Ming Zhao.
Configuration derived from "c96L48_awgp2d3".

For more information about AWG configurations, refer to
http://cobweb.gfdl.noaa.gov/~cjg/awg
    </description>

    <input>
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">/lustre/f1/unswept/Huan.Guo/INPUT/InitCond/AWG_c96L32/topo_v20150507/awg_C96L32_LM3_OM4_025_grid_lm3p2_19810101.remapped.topodrag.v20150507.tar</dataSource>
      </dataFile>

      <namelist name="ozone_nml">
      basic_ozone_type = 'predicted_ozone',
      ozone_data_source = 'predicted_ozone',
      do_coupled_stratozone=.true.
      </namelist>

      <namelist name="simple_sulfate_nml">
          aerocom_emission_filename='aerocom_emission_2000_cr6_volc2.nc'
      </namelist>

      <namelist name="tropchem_driver_nml">
        relaxed_dt = 864000.,
        ub_pres = 1.,
        relaxed_dt_lbc = 86400.,
        lb_pres = 800.e2,
        file_sulfate = 'sulfate.nc',
        file_conc = 'tracerIC.19800101.v2.nc',
        file_emis_1 = 'emissions.',
        file_emis_2 = '.1x1.1859_2020.nc',
        file_emis3d_1 = 'emissions3D.',
        file_emis3d_2 = '.1x1.1859_2020.nc',
        file_ub = 'ub_vals.mozart.nc',
        file_dry = 'depvel.nc',
        inv_list = '',
        file_aircraft = 'emissions.aircraft.1x1.1859_2020.nc',
        lght_no_prd_factor = 0.6,
        strat_chem_age_factor = 1.25,
        strat_chem_dclydt_factor = 1.,
        do_tropchem = .true.,
        use_tdep_jvals = .true.,
        file_jval_lut = 'jvals.v6fix.twilight.solarmax',
        file_jval_lut_min = 'jvals.v6fix.twilight.solarmin',
        o3_column_top = 0.002,
        repartition_water_tracers = .true.,
        allow_negative_cosz = .true.,
        allow_psc_settling_type1 = .true.,
        force_cly_conservation = .true.,
        set_min_h2o_strat = .true.,
        ch4_filename = 'ch4_gblannualdata',
        ch4_scale_factor = 1.e-9,
        verbose = 1,
        retain_cm3_bugs =.false.,
        check_convergence = .true. 
      </namelist>
     
      <!-- Input datasets -->
      <!--Note: FRE does not support partial xi:include inheritance!
	  If the child experiment has any additional/different xi:include then
	  the parent xi:include should be repeated and replaced carefully to make the desired experiment -->
      <xi:include xpointer="xpointer(//experiment[@name='common_data_fullchem']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='amip_data_fullchem']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='L32_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_atmos_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>

    </input>


  </experiment>

  
  <experiment name="common_data_fullchem">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)"> /lustre/f1/unswept/Bruce.Wyman/archive/mdt/awg/input/common/new_sea_esf_aug2013.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/common/sea_esf_dec2014.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">/lustre/f1/unswept/Sergey.Malyshev/awg/input/lm3/lm3_data_20150322.tar</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/aerosol_inputs.dec2009.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/RCP/cmip5_rcp45.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/tropchem_oct2011.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/megan2.1_input.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/historical/emissions.1x1.1859_2020.tar</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/AM4_201503" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/aerosol/am4_optical_table_20150325.dat</dataSource>
      </dataFile>
      <dataFile label="fieldTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/field_table/field_table_am4p5_fullchem_v20150604</dataSource>
      </dataFile>
      <fieldTable order="append">
#Verona: land co2 tracer required in fieldTable
"TRACER", "land_mod",     "co2"
"longname",     "carbon dioxide"
"units",        "kg/kg" /
       </fieldTable>


      <diagTable>
$name
$baseDate
      </diagTable>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_atmos</dataSource>
      </dataFile>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_land</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="amip_data_fullchem">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/sst/hadisst.186912-201401.tar</dataSource>
      </dataFile>
      <dataFile label="dataTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/data_table/data_table_amip</dataSource>
      </dataFile>
      <dataFile label="dataTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/data_table/data_table_co2</dataSource>
      </dataFile>
    </input>
  </experiment>

<experiment name="CM4_c96L32_am4g5r1_2000_COBALT" inherit="CM4_c96L32_am4g5r1_2000">
   <input> 

      <xi:include xpointer="xpointer(//experiment[@name='common_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='diag_table_lm3p2_faero']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='field_table_am4p5_faero']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='L32_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96L32_initCond']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_coupled_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>
      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data']/input/node())"/>

         <namelist name="generic_tracer_nml">
       do_generic_tracer=.true.
       do_generic_CFC=.false.
       do_generic_COBALT=.true.
       do_generic_TOPAZ=.false.
         </namelist>
         <namelist name="diag_manager_nml">
       max_axes = 100,
       max_num_axis_sets = 100,
       max_input_fields = 699
       max_output_fields = 699
       mix_snapshot_average_fields=.false.
         </namelist>

      <fieldTable order="append">
#generic tracers need a namelist
"namelists","ocean_mod","generic_cobalt/*global*"
/

"namelists","ocean_mod","generic_cobalt"
init = f
/
       </fieldTable>

        <csh type="always"><![CDATA[
####COMMON ALWAYS CSH BEGINS######
# MOM6 restart switch
if ( $currentSeg == 1 ) then
   set restart_flag = 'n'
else
   set restart_flag = 'r'
endif

# adjustment of dry mass first time only
set adjust_dry_mass = ".true."
if (-e $work/INPUT/coupler.res) then
   set t1 = (`grep "Model start time"   $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   set t2 = (`grep "Current model time" $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   foreach i (1 2 3 4 5 6)
      if ( $t1[$i] != $t2[$i] ) then
         set adjust_dry_mass = ".false."
         break   
      endif      
   end
endif
####COMMON ALWAYS CSH ENDS######

cat > $work/INPUT/MOM_override << OVERRIDE_EOF
#override ENERGYSAVEDAYS = 73.0
#override USE_OCMIP2_CFC = False
#override USE_generic_tracer = True
#override GENERIC_TRACER_IC_FILE = "MOM_GENERICS_NULL_"
OVERRIDE_EOF

     ]]></csh>
      
   </input>

    <runtime>
      <regression name="basic">
        <run days="10" npes="2752" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:20:00"/>
      </regression>

      <regression name="rts"> 
        <run days="5 5" npes="2752" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:20:00"/>
     </regression>

      <regression name="timingsL48">
        <run months="1" npes="2880" runTimePerJob="02:00:00"/>
        <run months="1" npes="4256" runTimePerJob="01:40:00"/>
        <run months="1" npes="5824" runTimePerJob="01:00:00"/>
      </regression>
      <regression name="timingL48">
        <run months="1" npes="2880" runTimePerJob="01:40:00"/>
      </regression>
 
    </runtime>

</experiment>


<experiment name="CM4_c96L32_am4g5r1_fullchem_COBALT" inherit="CM4_c96L32_am4g5r1_2000">

    <description>
This model is for testing purposes only. It's an engineer's attempt towards building a ESM4 prototype.
Do not use it for science!!!
    </description>


    <input>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 2000,1,1,0,0,0,
        calendar = 'NOLEAP'
        dt_atmos = 1800,
        dt_cpld  = 3600,
        use_lag_fluxes = .true.
        concurrent = .true.
        do_ocean = .true.
        ocean_npes = $ocean_npes
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>

      <namelist name="ozone_nml">
      basic_ozone_type = 'predicted_ozone',
      ozone_data_source = 'predicted_ozone',
      do_coupled_stratozone=.true.
      </namelist>

      <namelist name="simple_sulfate_nml">
          aerocom_emission_filename='aerocom_emission_2000_cr6_volc2.nc'
      </namelist>

      <namelist name="tropchem_driver_nml">
        relaxed_dt = 864000.,
        ub_pres = 1.,
        relaxed_dt_lbc = 86400.,
        lb_pres = 800.e2,
        file_sulfate = 'sulfate.nc',
        file_conc = 'tracerIC.19800101.v2.nc',
        file_emis_1 = 'emissions.',
        file_emis_2 = '.1x1.1859_2020.nc',
        file_emis3d_1 = 'emissions3D.',
        file_emis3d_2 = '.1x1.1859_2020.nc',
        file_ub = 'ub_vals.mozart.nc',
        file_dry = 'depvel.nc',
        inv_list = '',
        file_aircraft = 'emissions.aircraft.1x1.1859_2020.nc',
        lght_no_prd_factor = 0.6,
        strat_chem_age_factor = 1.25,
        strat_chem_dclydt_factor = 1.,
        do_tropchem = .true.,
        use_tdep_jvals = .true.,
        file_jval_lut = 'jvals.v6fix.twilight.solarmax',
        file_jval_lut_min = 'jvals.v6fix.twilight.solarmin',
        o3_column_top = 0.002,
        repartition_water_tracers = .true.,
        allow_negative_cosz = .true.,
        allow_psc_settling_type1 = .true.,
        force_cly_conservation = .true.,
        set_min_h2o_strat = .true.,
        ch4_filename = 'ch4_gblannualdata',
        ch4_scale_factor = 1.e-9,
        verbose = 1,
        retain_cm3_bugs =.false.,
        check_convergence = .true. 
      </namelist>
     
      <!-- Input datasets -->
      <!--Note: FRE does not support partial xi:include inheritance!
	  If the child experiment has any additional/different xi:include then
	  the parent xi:include should be repeated and replaced carefully to make the desired experiment -->
      <xi:include xpointer="xpointer(//experiment[@name='common_data_fullchem']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='L32_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96L32_initCond']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='diag_table_lm3p2_faero']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='field_table_am4p5_faero']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_coupled_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>
      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data']/input/node())"/>

         <namelist name="generic_tracer_nml">
       do_generic_tracer=.true.
       do_generic_CFC=.false.
       do_generic_COBALT=.true.
       do_generic_TOPAZ=.false.
         </namelist>
         <namelist name="diag_manager_nml">
       max_axes = 100,
       max_num_axis_sets = 100,
       max_input_fields = 699
       max_output_fields = 699
       mix_snapshot_average_fields=.false.
         </namelist>
	
      <fieldTable order="append">
#generic tracers need a namelist
"namelists","ocean_mod","generic_cobalt/*global*"
/

"namelists","ocean_mod","generic_cobalt"
init = f
/
       </fieldTable>

        <csh type="always"><![CDATA[
####COMMON ALWAYS CSH BEGINS######
# MOM6 restart switch
if ( $currentSeg == 1 ) then
   set restart_flag = 'n'
else
   set restart_flag = 'r'
endif

# adjustment of dry mass first time only
set adjust_dry_mass = ".true."
if (-e $work/INPUT/coupler.res) then
   set t1 = (`grep "Model start time"   $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   set t2 = (`grep "Current model time" $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   foreach i (1 2 3 4 5 6)
      if ( $t1[$i] != $t2[$i] ) then
         set adjust_dry_mass = ".false."
         break   
      endif      
   end
endif
####COMMON ALWAYS CSH ENDS######

cat > $work/INPUT/MOM_override << OVERRIDE_EOF
#override ENERGYSAVEDAYS = 73.0
#override USE_OCMIP2_CFC = False
#override USE_generic_tracer = True
#override GENERIC_TRACER_IC_FILE = "MOM_GENERICS_NULL_"
OVERRIDE_EOF

     ]]></csh>

     
   </input> 

    <runtime>
      <regression name="basic">
        <run days="10" npes="3456" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:20:00"/>
      </regression>
      <regression name="rts">
        <run days="5 5" npes="3456" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:20:00"/>
     </regression>

      <regression name="timingL48">
        <run months="1" npes="3584" runTimePerJob="02:00:00"/>
      </regression>
      
      <regression name="timingsL48">
        <run months="1" npes="2912" runTimePerJob="02:30:00"/>
        <run months="1" npes="3584" runTimePerJob="02:00:00"/>
        <run months="1" npes="3456" runTimePerJob="02:00:00"/>
        <run months="1" npes="4160" runTimePerJob="01:30:00"/>
        <run months="1" npes="5696" runTimePerJob="01:00:00"/>
        <run months="1" npes="6975" runTimePerJob="01:00:00"/>
        <run months="1" npes="6112" runTimePerJob="01:00:00"/>
        <run months="1" npes="8128" runTimePerJob="01:00:00"/>
      </regression>

    </runtime>
  </experiment>


<experiment name="CM4_c96L32_am4g5r1_fullchem" inherit="CM4_c96L32_am4g5r1_2000">

    <description>
This model is for testing purposes only. 
Do not use it for science!!!
    </description>


    <input>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 2000,1,1,0,0,0,
        calendar = 'NOLEAP'
        dt_atmos = 1800,
        dt_cpld  = 3600,
        use_lag_fluxes = .true.
        concurrent = .true.
        do_ocean = .true.
        ocean_npes = $ocean_npes
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>

      <namelist name="ozone_nml">
      basic_ozone_type = 'predicted_ozone',
      ozone_data_source = 'predicted_ozone',
      do_coupled_stratozone=.true.
      </namelist>

      <namelist name="simple_sulfate_nml">
          aerocom_emission_filename='aerocom_emission_2000_cr6_volc2.nc'
      </namelist>

      <namelist name="tropchem_driver_nml">
        relaxed_dt = 864000.,
        ub_pres = 1.,
        relaxed_dt_lbc = 86400.,
        lb_pres = 800.e2,
        file_sulfate = 'sulfate.nc',
        file_conc = 'tracerIC.19800101.v2.nc',
        file_emis_1 = 'emissions.',
        file_emis_2 = '.1x1.1859_2020.nc',
        file_emis3d_1 = 'emissions3D.',
        file_emis3d_2 = '.1x1.1859_2020.nc',
        file_ub = 'ub_vals.mozart.nc',
        file_dry = 'depvel.nc',
        inv_list = '',
        file_aircraft = 'emissions.aircraft.1x1.1859_2020.nc',
        lght_no_prd_factor = 0.6,
        strat_chem_age_factor = 1.25,
        strat_chem_dclydt_factor = 1.,
        do_tropchem = .true.,
        use_tdep_jvals = .true.,
        file_jval_lut = 'jvals.v6fix.twilight.solarmax',
        file_jval_lut_min = 'jvals.v6fix.twilight.solarmin',
        o3_column_top = 0.002,
        repartition_water_tracers = .true.,
        allow_negative_cosz = .true.,
        allow_psc_settling_type1 = .true.,
        force_cly_conservation = .true.,
        set_min_h2o_strat = .true.,
        ch4_filename = 'ch4_gblannualdata',
        ch4_scale_factor = 1.e-9,
        verbose = 1,
        retain_cm3_bugs =.false.,
        check_convergence = .true. 
      </namelist>
     
      <!-- Input datasets -->
      <!--Note: FRE does not support partial xi:include inheritance!
	  If the child experiment has any additional/different xi:include then
	  the parent xi:include should be repeated and replaced carefully to make the desired experiment -->
      <xi:include xpointer="xpointer(//experiment[@name='common_data_fullchem']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='L32_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96L32_initCond']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_coupled_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>
      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data']/input/node())"/>
     
   </input> 

    <runtime>
      <regression name="basic">
        <run days="10" npes="3456" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:20:00"/>
      </regression>
      <regression name="rts">
        <run days="5 5" npes="3456" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:20:00"/>
     </regression>

      <regression name="timingL48">
        <run months="1" npes="2016" runTimePerJob="02:00:00"/>
      </regression>
      
      <regression name="timingsL48">
      </regression>

    </runtime>
  </experiment>


<!--=======================-->
<!--= CM4_SIS2 EXPERIMENTS=-->
<!--=======================-->
  <experiment name="SIS2_data">
    <input>

     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_EXAMPLES)/ice_ocean_SIS2/OM4_025/diag_table.SIS</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/ice_ocean_SIS2/OM4_025/diag_table.SIS</dataSource>
     </dataFile>
     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_EXAMPLES)/ice_ocean_SIS2/OM4_025/diag_table.icebergs</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/ice_ocean_SIS2/OM4_025/diag_table.icebergs</dataSource>
     </dataFile>
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/ice_ocean_SIS2/OM4_025/SIS_input</dataSource>
     </dataFile>

<!-- No init ice yet
     <dataFile label="input" target="INPUT/ice_model.res.nc" chksum="" size="" timestamp="">
       <dataSource platform="$(platform)">$(MOM6_EXAMPLES)/ice_ocean_SIS/OM4_025/INPUT/.datasets/OM4_025/INPUT/ice_model.res.v20140620.nc</dataSource>
     </dataFile>
-->
     <namelist name="SIS_input_nml" >
         output_directory = './',
         input_filename = '$restart_flag'
         restart_input_dir = 'INPUT/',
         restart_output_dir = 'RESTART/',
         parameter_filename = 'INPUT/SIS_input','INPUT/SIS_layout','INPUT/SIS_override'
     </namelist>
      <namelist name="icebergs_nml">
        really_debug=.FALSE.
        debug=.FALSE.
        verbose=.FALSE.
        verbose_hrs=7200
        use_operator_splitting=.TRUE.
        bergy_bit_erosion_fraction=0.0
        sicn_shift=0.1
        parallel_reprod=.TRUE.
        traj_sample_hrs=0
        add_weight_to_ocean=.false.
      </namelist>
      <namelist name="ocean_albedo_nml">
            ocean_albedo_option = 5
      </namelist>
      <namelist name="ocean_rough_nml">
            rough_scheme = 'beljaars'
      </namelist>
     </input>
  </experiment>

<experiment name="CM4_c96L32_am4g5r1_2000_sis2_EPBL" inherit="CM4_c96L32_am4g5r1_2000_sis2">
								       
   <input>
      <csh type="always"><![CDATA[
####COMMON ALWAYS CSH BEGINS######
# MOM6 restart switch
if ( $currentSeg == 1 ) then
   set restart_flag = 'n'
else
   set restart_flag = 'r'
endif

# adjustment of dry mass first time only
set adjust_dry_mass = ".true."
if (-e $work/INPUT/coupler.res) then
   set t1 = (`grep "Model start time"   $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   set t2 = (`grep "Current model time" $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   foreach i (1 2 3 4 5 6)
      if ( $t1[$i] != $t2[$i] ) then
         set adjust_dry_mass = ".false."
         break   
      endif      
   end
endif

####COMMON ALWAYS CSH ENDS######

cat > $work/INPUT/MOM_override << OVERRIDE_EOF
#override USE_KPP = False
#override ENERGETICS_SFC_PBL = True
OVERRIDE_EOF
     ]]></csh>
   </input>
</experiment>

<experiment name="CM4_c96L32_am4g5r1_2000_sis2" inherit="cm4_sis2_compile">
    <description
communityProject="$(ProjectID)" 
communityModel="CM4_c96_am4p5_SIS2  $(MOM6_GIT_TAG)" 
communityModelID="CM4_c96_am4p5_SIS2"
communityExperimentName="$(name)">
    </description>
    <communityComment>
For more information please refer to the
&lt;a href="http://wiki.gfdl.noaa.gov/index.php/MDT_Coupled"&gt; Coupled Working Group Wiki.  &lt;/a&gt;
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_CPLD_START)"
      endTime="$(EXP_CPLD_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>

    <input>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1,1,1,0,0,0,
        calendar = 'NOLEAP'
        dt_atmos = 1800,
        dt_cpld  = 3600,
        use_lag_fluxes = .true.
        concurrent = .true.
        do_ocean = .true.
        ocean_npes = $ocean_npes
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <namelist name="flux_exchange_nml">
            nblocks=$atmos_nthreads
            debug_stocks = .FALSE.
            divert_stocks_report = .TRUE.
            do_area_weighted_flux = .FALSE.
      </namelist>
      <namelist name="fms_io_nml">
            fms_netcdf_restart=.true.
            threading_read='multi'
            max_files_r = 200
            max_files_w = 200
      </namelist>
      <namelist name="fms_nml">
            clock_grain='ROUTINE'
            clock_flags='NONE'
            domains_stack_size = 5000000
            stack_size =0
      </namelist>
      <namelist name="xgrid_nml">
        make_exchange_reproduce = .true.
        interp_method = 'second_order'
      </namelist>

      <namelist name="atmos_model_nml">
         nxblocks = $nxblocks
	 nyblocks = $nyblocks
      </namelist>
      <!--AWG Input datasets -->
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p5_common.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4g5_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4g5_c96L32.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p5_2000climo.nml"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data_lm3p2']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='L32_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96L32_initCond']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='diag_table_lm3p2_faero']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='field_table_am4p5_faero']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_coupled_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>
      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS2_data']/input/node())"/>

    </input>

    <runtime>
        <production simTime="$(PROD_SIMTIME)" units="years" npes="2560" runTime="12:00:00">
          <segment simTime="12" units="months" runTime="6:00:00"/>
        </production>
      <regression name="basic">
        <run days="10" npes="1584" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:20:00"/>
      </regression>

      <regression name="rts">
        <run days="5 5" npes="1584" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:20:00"/>
        <run days="10"  npes="3168" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="00:20:00"/>
     </regression>

      <regression name="restarts">
        <run days="5 5" npes="1584" overrideParams="xgrid_nml:make_exchange_reproduce=.true." runTimePerJob="01:20:00"/>
      </regression>

      <regression name="debug">
        <run days="1" npes="1584" runTimePerJob="02:00:00"/>
      </regression>

      <regression name="timing">
        <run months="1" npes="6400" runTimePerJob="01:00:00"/>
      </regression>

      <regression name="timingsL32">
        <run months="1" npes="2432" runTimePerJob="01:00:00"/>
        <run months="1" npes="2560" runTimePerJob="01:00:00"/>
      </regression>
     
      <regression name="timingL48">
        <run months="1" npes="3296" runTimePerJob="01:00:00"/>
      </regression>
     
      <regression name="timingsL48">
        <run months="1" npes="1376" runTimePerJob="01:00:00"/>
        <run months="1" npes="1454" runTimePerJob="01:00:00"/>
        <run months="1" npes="2620" runTimePerJob="01:00:00"/>
        <run months="1" npes="3584" runTimePerJob="01:00:00"/>
	<run months="1" npes="5279" runTimePerJob="01:00:00"/>
        <run months="1" npes="6975" runTimePerJob="01:00:00"/>
        <run months="1" npes="4704" runTimePerJob="01:00:00"/>
        <run months="1" npes="3296" runTimePerJob="01:00:00"/>
      </regression>

      <reference restart="$(REFERENCE)/archive/1x0m10d_1584pe/restart/00010111.tar"/>

    </runtime>

    <postProcess>
      <xi:include xpointer="xpointer(//experiment[@name='c96_climo_postprocess']/postProcess/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='OM4_postprocess']/postProcess/node())"/>
    </postProcess>

</experiment>


  <experiment name="faste2e" inherit="CM4_c96L32_am4g5r1_2000_sis2">
    <description
communityProject="GFDL-Niki.Zadeh" 
communityModel="CM4_c96L32_am4g5_2000_sis2_meke_dEddParameters_1_ELASTIC_KPP10_BT_2 re-post-processed $(FRE_VERSION)" 
communityModelID="CM4_c96L32_am4g5_2000_sis2_meke_dEddParameters_1_ELASTIC_KPP10_BT_2"
communityExperimentName="$(name)">
This  is an experiment to simulate the post-processing of any experiment given the history data on gfdl archive.

This is designed for the purposes of quicklly testing post-processing workflow for existing history data ( that would otherwise require too much time and compute resources to regenerate from scratch).

This instance was run with fre version $(FRE_VERSION) initiating on $(platform)

    </description>
    <communityComment>
The &lt;a href=""&gt; original experiment &lt;/a&gt; was run by Bill Hurlin on $(platform)

For more information on CM4 coupled models please refer to the
&lt;a href="http://wiki.gfdl.noaa.gov/index.php/MDT_Coupled"&gt; Coupled Working Group Wiki.  &lt;/a&gt;
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_CPLD_START)"
      endTime="$(EXP_CPLD_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
     <input>
      <!--get arbitrary small data files to avoid getting all the real huge data--> 
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/aerosol/am4_optical_table_20150325.dat</dataSource>
      </dataFile>
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/aerosol/am4_optical_table_20150325.dat</dataSource>
      </dataFile>

      <csh type="always">
        <![CDATA[
#NOT TO BE USED WITH REGULAR FRE RUNS!! ONLY FOR TESTING!!

cat > $work/additional_setup << link_hist_EOF
\rm -rf /archive/Niki.Zadeh/$(FRE_STEM)/$(name)/gfdl.ncrc2-intel-prod-openmp/history/\$firstDate.nc.tar
ln -s  /archive/Bill.Hurlin/$(FRE_STEM)/CM4_c96L32_am4g5_2000_sis2_meke_dEddParameters_1_ELASTIC_KPP10_BT_2/gfdl.ncrc2-intel-prod-openmp/history/\$firstDate.nc.tar /archive/Niki.Zadeh/$(FRE_STEM)/$(name)/gfdl.ncrc2-intel-prod-openmp/history/
link_hist_EOF

chmod +x $work/additional_setup
gcp $work/additional_setup gfdl:$(NB_ROOT)/mom6/


#Override the runCommand 
unalias runCommand
@ currentSegp1 = $currentSeg + 1
cat > $work/time_stamp.out << TIMESTAMP_EOF
   $currentSeg   1   1   0   0   0  Jan
   $currentSegp1 1   1   0   0   0  Jan
TIMESTAMP_EOF

alias runCommand 'touch dummy_history_${currentSeg}.nc;touch some_dummy_text.out;mkdir RESTART;touch RESTART/dummy_restart.res.nc;sleep 300'
       ]]>
      </csh>
     </input>
    <runtime>
      <production simTime="$(PROD_SIMTIME)" units="years" npes="32" runTime="01:00:00">
           <segment simTime="12" units="months" runTime="00:05:00"/>
       </production>
    </runtime>
 </experiment>
 


</experimentSuite>


