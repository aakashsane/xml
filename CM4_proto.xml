<?xml version="1.0"?>

<!-- MDT XML version 20140522 -->

<!-- GFDL Model Development Team (MDT) documentation: http://cobweb.gfdl.noaa.gov/~niz/mdt/ -->
<!-- GFDL MDT Atmosphere Working Group (AWG) documentation: http://cobweb.gfdl.noaa.gov/~cjg/awg/ -->

<!-- QUICK START GUIDE:

# Change YOURGROUPLETTER to your group, such as f, w, o...
      <project>gfdl_YOURGROUPLETTER</project>

# To check out codes and compile:
# for target option "-t openmp", the default is prod-openmp
module load fre/bronx-7
fremake -x CM4_proto.xml -p ncrc2.intel -t prod-openmp cm4p1_compile

# To run regression test (for the coupled experiment CM4_c96L48_am4a1r1_2000climo, year 2000 forcing): 
frerun -r basic -x CM4_proto.xml -p ncrc2.intel -t prod-openmp CM4_c96L48_am4a1r1_2000climo

# To run a complete coupled experiment (with automated database entry if MDBIswitch in "on"):
frerun -x CM4_proto.xml -p ncrc2.intel -t prod-openmp CM4_c96L48_am4a1r1_2000climo

# To run fredb after an experiment is finished to manually add it to the database:
fredb -x CM4_proto.xml -p gfdl.ncrc2-intel -t prod-openmp -n CM4_c96L48_am4a1r1_2000climo

# To check what is the input data of this experiment:
inputfiles -x CM4_proto.xml -p ncrc2.intel
-->

<experimentSuite rtsVersion="4" xmlns:xi="http://www.w3.org/2003/XInclude">

  <property name="RELEASE" value="tikal_201409"/>                <!-- CVS tag for source code -->
  <property name="MOM6_DATE" value="2014.08.29"/>                <!-- git tag date for MOM6 source code -->
  <property name="MOM6_GIT_TAG" value="dev/master/$(MOM6_DATE)"/>             <!-- git tag for MOM6 source code -->
  <property name="FRE_STEM"  value="$(RELEASE)_awgUpdates_mom6_$(MOM6_DATE)"/>   <!--  customize as needed -->
  <property name="FRE_VERSION" value="fre/bronx-7"/>             <!-- fre/bronx-7 not supported on Zeus; use fre/bronx-6 -->
  <property name="ANALYSIS_SWITCH" value="on"/>
  <property name="MDBIswitch" value="on"/>                       <!-- on/off switch for MDBI database -->
  <property name="ProjectID" value="MDT"/>                       <!-- database top level -->
  <property name="DEBUGLEVEL" value=""/>

  <property name="AWG_INPUT_HOME_GAEA" value="awg_include"/>
  <property name="AWG_INPUT_HOME_ZEUS" value="awg_include"/>
  <property name="AWG_INPUT_HOME_GFDL" value="/nbhome/$USER/$(FRE_STEM)/$(name)/mdt_xml/awg_include"/>

<!--
GFDL FAIR USE POLICY

GFDL recognizes the essential nature of collaboration in the scientific
enterprise, including the importance of novel application and analysis of our
models. In order to maximize mutual benefit from collaboration, the use of
experimental GFDL models** should be done in a manner that ensures that
individuals involved in model development receive proper credit for their
work; in order to minimize the potential for misapplication of experimental
models, collaborations should actively engage model developers. Publication of
results using experimental GFDL models should be done in consultation with
scientists that participated in the model development. Consultation with GFDL
model developers should occur before submission of publications based on
experimental GFDL models, and should include agreement on the appropriate level
of acknowledgment, co-authorship and participation by the model developers.
Since experimental models have not been thoroughly vetted, experimental GFDL
models and their output should be distributed only after consultation with the
developers of the model. After a GFDL model has been described in a
peer-reviewed publication it is no longer experimental, and results based on
the model should cite the publication(s) describing the model.
 
** "Experimental GFDL models" refers to models (e.g., a coupled climate model),
model components (e.g., parameterization schemes), model configurations (e.g.,
the specific arrangement and parameter settings of model components) arising
from model development efforts at GFDL, but whose formulation and configuration
have not yet been documented in the peer-reviewed literature, as well as outputs
from integrations with these models.
-->

<!--====================-->
<!--= AMIP EXPERIMENTS =-->
<!--====================-->

<!--
AMIP simulations are configured to start in 1980 with the first year being a 
spin-up year. Postprocessing and analysis are performed starting in 1981. The 
length of the simulation and analysis period can be controlled by changing 
properties below.
-->

  <!-- make sure to change current_date in coupler_nml accordingly -->
  <property name="EXP_AMIP_START" value="1980"/>
  <property name="EXP_AMIP_END"   value="2000"/>
  <property name="EXP_AMIP_LEN"   value="21"/>
  <property name="ANA_AMIP_START" value="1981"/>
  <property name="ANA_AMIP_END"   value="2000"/>
  <property name="ANA_AMIP_LEN"   value="20yr"/>
  <!-- Post-processing chunk length -->
  <!-- ANA_AMIP_LEN must be an integer multiple of PP_AMIP_CHUNK -->
  <property name="PP_AMIP_CHUNK" value="5yr"/>

<!--=====================================-->
<!--= RFP, CESS SENSITIVITY EXPERIMENTS =-->
<!--=====================================-->

<!--
Experiments to compute RFP (Radiative Flux Perturbation) and Cess sensitivity 
were originally configured by Larry Horowitz. Experiments are configured to 
start in year 0001, postprocessing and analysis are performed starting from 
the second year (0002). The length of the simulation and analysis period can 
be controlled by changing properties below.
-->

  <!-- make sure to change current_date in coupler_nml accordingly -->
  <property name="EXP_CLIMO_START" value="0001"/>
  <property name="EXP_CLIMO_END"   value="0030"/>
  <property name="EXP_CLIMO_LEN"   value="30"/>
  <property name="ANA_CLIMO_START" value="0001"/>
  <property name="ANA_CLIMO_END"   value="0010"/>
  <property name="ANA_CLIMO_LEN"   value="10yr"/>
  <property name="PP_CLIMO_CHUNK"  value="5yr"/>
  <property name="PP_CLIMO_CHUNK_B" value="20yr"/>
  <property name="PP_OCEAN_CHUNK"   value="5yr"/> 
  <property name="PP_OCEAN_CHUNK_B" value="20yr"/> 


<!--=========================================-->
<!--= Properties needed for OM4 EXPERIMENTS =-->
<!--=========================================-->
   <property name="PROD_SIMTIME_OM4"   value="5"/>
   <property name="PROD_RUNTIME_OM4"   value="16:00:00"/>
   <property name="PROD_SEGTIME_OM4"   value="03:15:00"/>
<!-- Reference release tag for existing files in the archives for answer comparison. Used in "REFERENCE" property. -->
   <property name="reference_tag"      value="tikal_201407_plus_3cjgUpdates_mom6_2014.07.23"/>
                              <!--reproduces "tikal_201403_mom6_2014.07.01_with_cjgUpdates"/-->
                              <!--reproduces "tikal_201407_plus_3cjgUpdates_mom6_2014.07.23"/-->


<!--=================-->
<!--= CHANGING NPES =-->
<!--=================-->

<!--
This xml includes a number of predefined options for the number of PEs.
Changing the number of PEs can be accomplished by simply 
modifying 'npes' and segment 'runTime' in the xml <production> block:

      <production simTime="$(EXP_AMIP_LEN)" units="years" npes="1728" runTime="16:00:00">
        <segment simTime="12" units="months" runTime="3:00:00"/>
      </production>

Choosing a particular PE number is a balancing act. The higher npes, 
the faster the model throughput, but also the lower the model efficiency
(i.e. the overall simulation will cost more in terms of core hours).

Available options for c96L48:

  +========+======================+======================+
  |npes    |  Suggested run time for 12 month segment    |
  |        |    am4a1r1/2         |    am4b1             |
  +========+======================+======================+
  |   432  |    09:00:00          |    09:00:00          |
  |   864  |    05:20:00          |    05:20:00          |
  |  1152  |    04:00:00          |    04:00:00          |
  | *1728* |    03:00:00          |    03:00:00          |
  |  2304  |    02:30:00          |    02:30:00          |
  |  3456  |    02:15:00          |    02:15:00          |
  +========+======================+======================+

Available options for c192L48:

  +========+======================+======================+
  |npes    |  Suggested run time for 12 month segment    |
  |        |    am4a1r1/2         |    am4b1             |
  +========+======================+======================+
  |  1152  |    16:00:00 (?)      |    16:00:00 (?)      |
  |  2304  |    09:00:00          |    09:00:00          |
  |  3456  |    07:00:00          |    07:00:00          |
  | *4608* |    05:20:00          |    06:00:00          |
  |  6912  |    04:00:00          |    05:00:00          |
  +========+======================+======================+

Note: default settings are *highlighted*. Suggested 
run time values may need to be adjusted for your specific
configuration.
      
-->

  <setup>

<!-- MDBI -->
    <fmsRelease>fmsversion</fmsRelease>
<!-- /MDBI -->

    <platform name="ncrc2.intel">
<!-- Please make sure to change "YOURGROUPLETTER" to your group, such as b, f, g, m, o... -->
      <project>gfdl_YOURGROUPLETTER</project>
      <directory stem="$(FRE_STEM)">
        <!--unswept locations--><!-- CPERM=/lustre/f1/unswept -->
	<root>$HOME/$(stem)</root>
	<exec>$CPERM/$USER/$(stem)/$(name)/$(platform)-$(target)/exec</exec>
	<state>$CPERM/$USER/$(stem)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/state</state>
 	<scripts>$CPERM/$USER/$(stem)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/scripts</scripts>
        <!--swept locations (including the staged archive location)-->
        <archive>$CTMP/$USER/$(stem)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/archive</archive>
        <stdout>$CTMP/$USER/$(stem)$(DEBUGLEVEL)/$(name)/$(platform)-$(target)/stdout</stdout>
        <work>$CTMP/$USER/work/$(stem)/$FRE_JOBID</work>
      </directory>
      <property name="F2003_FLAGS"       value=" -DINTERNAL_FILE_NML -g -traceback"/>
      <property name="AWG_INPUT_HOME"    value="$(AWG_INPUT_HOME_GAEA)"/>
      <property name="AWG_ARCHIVE_ROOT"  value="/lustre/f1/unswept/Chris.Golaz/archive/mdt"/>
      <property name="NB_ROOT"           value="/nbhome/$USER/$(FRE_STEM)/$(name)"/>
      <property name="CWG_HOME"          value="/lustre/f1/unswept/John.Krasting/cwg"/>
      <property name="REFERENCE"         value="/lustre/f1/unswept/Niki.Zadeh/$(reference_tag)/$(name)/$(platform)-$(target)"/>
      <property name="REFERENCE_awg"     value="/lustre/f1/unswept/Niki.Zadeh/awg/tikal_201403_answers/$(name)/$(platform)-$(target)"/>
      
      <csh><![CDATA[
        source $MODULESHOME/init/csh
 
        module use -a /ncrc/home2/fms/local/modulefiles
        module unload PrgEnv-pgi PrgEnv-pathscale PrgEnv-intel PrgEnv-gnu PrgEnv-cray
        module unload netcdf fre
        module load PrgEnv-intel/4.0.46
        module swap intel intel/12.0.5.220
        module load $(FRE_VERSION)
        module load git
 
        setenv KMP_STACKSIZE 512m
        setenv NC_BLKSZ 1M
        setenv F_UFMTENDIAN big
      ]]></csh>
    </platform>

    <platform name="ncrc2.default">
      <xi:include xpointer="xpointer(//setup/platform[@name='ncrc2.intel']/node())" />
    </platform>

    <platform name="nescc.intel">
      <project>gfdlport</project>
      <directory stem="$(FRE_STEM)">
        <root>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)</root>
        <src>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)/$(name)/src</src>
        <exec>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)/$(name)/$(platform)-$(target)/exec</exec>
        <scripts>$HOME/$(stem)/$(name)/$(platform)-$(target)/scripts</scripts>
        <stdout>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)/$(name)/$(platform)-$(target)/stdout</stdout>
        <state>$HOME/$(stem)/$(name)/$(platform)-$(target)/state</state>
        <work>/scratch2/portfolios/GFDL/gfdlscr/$USER/work/$FRE_JOBID</work>
        <ptmp>/scratch2/portfolios/GFDL/gfdlscr/$USER/ptmp</ptmp>
        <stmp>/scratch2/portfolios/GFDL/gfdlscr/$USER/stmp</stmp>
        <archive>/scratch2/portfolios/GFDL/gfdlscr/$USER/$(stem)/$(name)/$(platform)-$(target)</archive>
      </directory>
      <mkmfTemplate file="/home/Niki.Zadeh/fre/fre-commands/site/nescc/intel.mk"/>
      <property name="F2003_FLAGS"       value=" -DINTERNAL_FILE_NML"/>
      <property name="AWG_INPUT_HOME"    value="$(AWG_INPUT_HOME_ZEUS)"/>
      <property name="AWG_ARCHIVE_ROOT"  value="/scratch2/portfolios/GFDL/gfdlscr/John.Krasting/awg/mdt"/>
      <property name="NB_ROOT"           value="/nbhome/$USER/$(FRE_STEM)/$(name)"/>
      <property name="CWG_HOME"          value="/scratch2/portfolios/GFDL/gfdlscr/John.Krasting/cwg"/>
      <property name="REFERENCE"         value=""/>
      <property name="REFERENCE_awg"     value=""/>
      <csh><![CDATA[
        module use ~fms/local/modulefiles
        #module load intel/12-12.0.4.191 #need more up-to-date compiler for ulm
        module load intel/13.0.079
        module load netcdf/4.1.1-intel-12
        module load mpt/2.06
        module load $(FRE_VERSION)
        module load nco
        setenv MPICH_CPUMASK_DISPLAY
        setenv KMP_STACKSIZE 512m
        setenv NC_BLKSZ 1M
        setenv F_UFMTENDIAN big
        setenv SMA_SHMALLOC_FORCE_EQUAL off
        setenv MPI_BUFS_PER_PROC 512
        setenv MPI_BUFS_PER_HOST 512
      ]]></csh>
    </platform>

    <platform name="nescc.default">
      <xi:include xpointer="xpointer(//setup/platform[@name='nescc.intel']/node())" />
    </platform>

    <platform name="gfdl.default">
      <property name="NB_ROOT"           value="/nbhome/$USER/$(FRE_STEM)/$(name)"/>
      <directory stem="$(FRE_STEM)">
        <archive>$ARCHIVE/$(stem)/$(name)/$(platform)-$(target)</archive>
        <postProcess>$(archiveDir)/pp</postProcess>
        <analysis>$(NB_ROOT)</analysis><!--Do not change this! This is the directory under which  frepp looks for mom6 clone. It is the frepp $out_dir. -->
	<ptmp>/ptmp/$USER</ptmp>
      </directory>
      <property name="F2003_FLAGS"       value=" -DINTERNAL_FILE_NML"/>
      <property name="AWG_INPUT_HOME"    value="$(AWG_INPUT_HOME_GFDL)"/>
      <property name="AWG_ARCHIVE_ROOT"  value="/archive/cjg/mdt"/>
      <property name="CWG_HOME"          value="/archive/John.Krasting/cwg"/>
      <property name="REFERENCE"         value=""/>
      <property name="REFERENCE_awg"     value=""/>
      <csh><![CDATA[
        source $MODULESHOME/init/csh
        module use -a /home/fms/local/modulefiles
        module purge
        module load $(FRE_VERSION)
        module load fre-analysis
        module load git
           setenv FREVERSION $(FRE_VERSION)           
           setenv NBROOT $(NB_ROOT)
           mkdir -p $NBROOT
           cd $NBROOT
/home/Niki.Zadeh/bin/git_clone_mom6_fix_args.csh -b $(MOM6_GIT_TAG) -g noaa-gfdl-mom6.git

       ]]>
      </csh>
    </platform>

    <platform name="gfdl.ncrc2-default">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.default']/node())" />
    </platform>
    <platform name="gfdl.ncrc2-intel">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.default']/node())" />
    </platform>

    <platform name="gfdl.nescc-default">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.default']/node())" />
    </platform>
    <platform name="gfdl.nescc-intel">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.default']/node())" />
    </platform>

    <platform name="gfdl-ws.default">
      <xi:include xpointer="xpointer(//setup/platform[@name='gfdl.default']/node())" />
    </platform>

  </setup>

<!--===========-->
<!--= COMPILE =-->
<!--===========-->
  <!--The property MOM6_SRC should point to the mom6 src code that is checked out. It is needed by MOM6 to access its inpu data files-->
  <property name="MOM6_SRC"  value="$root/cm4p1_compile/src/mom6"/>  <!-- cm4p1_compile is the compile experiment name -->

  <experiment name="cm4p1_compile">
    <description>

Experiment to build executable.
* tikal_201403 code base
* MOM6 ocean code (updated to dev/master/2014.04.03)
* code updates from Rick Hemler to allow use of ncar v1.5 microphysics (tikal_ncar1p5_micro_rsh)
* code updates from Rick Hemler for update water path diagnostics (tikal_precip_paths_rsh)
* bug fixes from Will Cooke (vert_turbdiff_gnu_conv_wfc, tikal_ncar1p5_micro_rsh_wfc)
* code updates from Xianglei Huang to increase olr band diagnostics (tikal_rad_diag_xlh_cjg)
* code updates from Chris Golaz for new PBL depth diagnostics (tikal_pbl_depth_cjg)
* bug fix from Ming Zhao regarding entrainment rate (dpconv20140318_miz)
* updated topo_drag from Steve Garner (tikal_topo_drag_garner_cjg)
* bug fix from Zhi (tikal_bugfix_z1l)
* bug fix from Huan Guo for CLUBB and MG microphysics
* new TKE turbulence from Chris Golaz (tikal_tke_v20140611_cjg)
* new activation options from Chris Golaz (tikal_201403_act_options_cjg)
    </description>

    <component name="fms" paths="shared">
     <description domainName="infrastructure" communityName="FMS" communityVersion="$(RELEASE)" communityGrid=""/>
      <source>
        <codeBase version="$(RELEASE)"> shared </codeBase>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) -Duse_libMPI -Duse_netCDF </cppDefs>
      </compile>
    </component>

    <component name="atmos_phys" requires="fms" paths="atmos_param atmos_shared">
      <description domainName="" communityName="" communityVersion="$(RELEASE)" communityGrid=""/>
      <source>
        <codeBase version="$(RELEASE)"> atmos_shared atmos_param_am3 </codeBase>
        <csh>
#==For Ulm==
           cvs up -r tikal_201403_act_options_cjg atmos_param/strat_cloud/aerosol_cloud.F90 atmos_param/strat_cloud/strat_cloud.F90 atmos_param/strat_cloud/strat_cloud_utilities.F90 atmos_param/strat_cloud/strat_nml.h

#==For JPD Drag Tests==
           cvs up -r drag_min_jpd_20141030 atmos_param/monin_obukhov/monin_obukhov.F90
           cvs up -r drag_min_jpd_20141030 atmos_param/monin_obukhov/monin_obukhov_kernel.F90
	</csh>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) -DCLUBB</cppDefs>
      </compile>
    </component>

    <component name="atmos_dyn" requires="fms atmos_phys" paths="atmos_coupled atmos_cubed_sphere">
      <description domainName="CubedSphere" communityName="CubedSphere" communityVersion="$(RELEASE)" communityGrid=""/>
      <source>
        <codeBase version="$(RELEASE)">
          atmos_coupled cubed_sphere_coupled
        </codeBase>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) -DSPMD -DUSE_OCEAN_BGC -DOLD_PT_TO_T -DOLD_COS_SG</cppDefs>
      </compile>
    </component>

    <component name="ice_sis" requires="fms" paths="ice_sis ice_param">
      <description domainName="Sea Ice SIS" communityName="GFDL-SIS" communityVersion="$(RELEASE)" communityGrid="Tripolar"/>
      <source>
        <codeBase version="$(RELEASE)"> ice_sis ice_param </codeBase>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) -Duse_netCDF</cppDefs>
      </compile>
    </component>

    <component name="land_lad2" requires="fms" paths="land_lad2">
      <description domainName="LM3" communityName="land_lad2" communityVersion="$(RELEASE)" communityGrid=""/>
      <source>
        <codeBase version="$(RELEASE)"> land_lad2 </codeBase>
        <csh>
          mv land_lad2/land_model.F90 land_lad2/land_model.F90.ORIG
          cp /ncrc/home2/John.Krasting/updates/20141030/land_lad2/land_model.F90 land_lad2/land_model.F90
        </csh>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) -DUSE_LOG_DIAG_FIELD_INFO</cppDefs>

<!--The following csh block is needed for compiler pre-processors that are not ANSI-compliant, such as pathscale-->
<csh> <![CDATA[
cat >Makefile.cpp <<EOF
CPPDEFS =
FRETARGET = $(target)
ifneq (\$(findstring hdf5,\${FRETARGET}),)
else
  CPPDEFS += -Duse_LARGEFILE
endif
EOF
echo vpath %.F90 `find $cwd/land_lad2 -type d` >> Makefile.cpp
echo cpp_land/%.f90: %.F90 >> Makefile.cpp
/bin/echo -e '\tcpp ${CPPDEFS} -C -v -I shared/include -o $@ $<' >> Makefile.cpp
mkdir -p cpp_land
foreach foo ( `find land_lad2 -type f -name \*.F90` )
  make -f Makefile.cpp cpp_land/$foo:t:r.f90
end
find cpp_land -type f -name \*.f90 > pathnames_land_lad2
        ]]></csh>

      </compile>
    </component>

    <component name="mom6" requires="fms" paths="mom6/config_src/dynamic mom6/config_src/coupled_driver mom6/src/*/ mom6/src/*/*/">
      <description domainName="Ocean" communityName="GFDL-MOM6" communityVersion="$(MOM6_GIT_TAG)" communityGrid="Tripolar"/>
      <source versionControl="git" root="http://gitlab.gfdl.noaa.gov/github_mirror">
        <codeBase version="$(MOM6_GIT_TAG)"> noaa-gfdl-mom6.git </codeBase>
        <csh>
          mv noaa-gfdl-mom6 mom6
          set platform_domain = `perl -T -e "use Net::Domain(hostdomain) ; print hostdomain"`
          if ("${platform_domain}" == "zeus.fairmont.rdhpcs.noaa.gov") then
            pushd mom6/examples; rm -f .datasets
            ln -s /scratch2/portfolios/GFDL/gfdlscr/John.Krasting/pdata/gfdl_O/datasets/ .datasets
            popd
          endif
          test -e mom6/examples/.datasets
          if ($status != 0) then
            echo ""; echo "" ; echo "   WARNING:  .datasets link in MOM6 examples directory is invalid"; echo ""; echo ""
          endif
        </csh>
      </source>
      <compile>
        <cppDefs><![CDATA[ $(F2003_FLAGS) -D_FILE_VERSION="'"`git-version-string $<`"'" ]]></cppDefs>
        <makeOverrides>OPENMP=""</makeOverrides> <!-- openmp switch for MOM6 may cause crash -->
      </compile>
    </component>

<!--
    <component paths="ocean_shared" requires="fms" name="ocean_shared">
      <description domainName="Ocean Generic Tracers" communityName="GFDL-ocean-shared" communityVersion="$(RELEASE)" communityGrid="Tripolar"/>
      <source>
        <codeBase version="$(RELEASE)"> ocean_shared </codeBase>
      </source>
      <compile>
        <cppDefs>$(F2003_FLAGS) </cppDefs>
      </compile>
    </component>
-->

    <component name="coupler" paths="coupler" requires="fms atmos_dyn atmos_phys land_lad2 ice_sis mom6">
      <description domainName="FMS Coupler" communityName="coupler" communityVersion="$(RELEASE)" communityGrid=""/>  
      <source versionControl="git" root="http://gitlab.gfdl.noaa.gov/fms">
        <codeBase version="$(RELEASE)"> coupler.git </codeBase>
      </source>
      <compile>
        <cppDefs><![CDATA[$(F2003_FLAGS) -D_FILE_VERSION="'"`git-version-string $<`"'"]]></cppDefs>
      </compile>
    </component>

  </experiment>

<!--============================-->
<!--= TEMPLATES FOR INPUT DATA =-->
<!--============================-->

  <experiment name="common_data">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/common/sea_esf_aug2013.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/lm3/lm3_data_20130815.tar</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/aerosol_inputs.dec2009.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/RCP/cmip5_rcp45.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/tropchem_oct2011.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/megan2.1_input.cpio</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/historical/emissions.1x1.1859_2020.tar</dataSource>
      </dataFile>
      <dataFile label="fieldTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/field_table/field_table_am4p1</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/aerosol/gas_conc_3D48L_am3p9.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/anthro_so2.1859_2010.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/emissions/emissions.simple.so2.1x1.1859_2020.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/emis_fuel_aircraft.1859_2010.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/emissions/emissions.aircraft.aero.1x1.1859_2020.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/liteChem/input/emissions/so2_0.25_volcanoes.nc</dataSource>
      </dataFile>

      <diagTable>
$name
$baseDate

      </diagTable>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_atmos</dataSource>
      </dataFile>
      <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/diag_table/diag_table_land</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="amip_data">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/sst/hadisst.186912-201401.tar</dataSource>
      </dataFile>
      <dataFile label="dataTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/data_table/data_table_amip</dataSource>
      </dataFile>
      <dataFile label="dataTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/data_table/data_table_co2</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="climo_data">
    <input>
      <dataFile label="input" target="INPUT/hadisst_sst.data.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/sst.climo.1981-2000.data.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/hadisst_ice.data.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/cm3/ipcc_ar5/input/common/ice.climo.1981-2000.data.nc</dataSource>
      </dataFile>
      <!-- Repeat data_table_amip but not data_table_co2 -->
      <dataFile label="dataTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_INPUT_HOME)/data_table/data_table_amip</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="c96_data">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/lm3/19810101.static_veg.remapped_to_c96_OM4_025.v20140626.tar</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/lm3/c96_OM4_025_hydrography_v20140620.tar</dataSource>
      </dataFile>
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/ic/awg_C96L48_LM3_OM4_025_grid_19810101.remapped.v20140626.tar</dataSource>
      </dataFile>
      <dataFile label="gridSpec" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/grid/c96_OM4_025_grid_v20140620.tar</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="c96_data_1deg">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/19810101.static_veg.remapped_to_C96_CM4i.v20140730.tar</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/CM4i_hydrography_20140729.tar</dataSource>
      </dataFile>
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/IC/CM4i_C96L48_LM3_OM4_1deg_grid_19810101.remapped.v20140730-2.tar</dataSource>
      </dataFile>
      <dataFile label="gridSpec" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/CM4i_mosaic_20140729.tar</dataSource>
      </dataFile>
    </input>
  </experiment>


  <experiment name="c96_atmos_domain_decomp">
<!--
c96 means 96x96 grid points per face
fv_layout=X,Y means a domain decomposition of iec=96/X , jec=96/Y per face.
E.g.  fv_layout="3,24" gives:
  X-AXIS =   32  32  32
  Y-AXIS =    4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4   4
E.g. physics_window = "32,2" gives num_phys_windows = (32/32) * (4/2) =2

MUST HAVE  X/winx and Y/winy integers
AND
MUST HAVE  num_phys_windows .GE. numthreads


-->    
    <input>
      <csh><![CDATA[
# Possible domain decompositions recommended by Rusty Benson.
set do_ocean = "false"
if ( "$npes" == "432" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "3,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"
  set domains_stack_size = "2097152"
#npes= 432  main_loop= 2450.045358  ATM= 2448.129781  OCN= 0.000000000000000E+00  SYPD= 2.89846
#num_phys_windows=1

else if ( "$npes" == "3072" ) then
  set atmos_npes = "768"
  set atmos_nthreads = "4"
  set physics_window = "6,3"
  set fv_layout    =   "8,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "128,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "128,6";   set ocn_io_layout =  "1,3"

else if ( "$npes" == "864" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set physics_window = "32,2"
  set fv_layout    =   "3,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"
  set domains_stack_size = "2097152"
#npes= 864  main_loop= 1335.244251  ATM= 1333.887666  OCN= 0.000000000000000E+00  SYPD= 5.31841
#num_phys_windows=2
else if ( "$npes" == "1728" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set physics_window = "16,2"
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,4"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set domains_stack_size = "2097152"
#npes= 1728  main_loop= 756.565145  ATM= 755.718138  OCN= 0.000000000000000E+00  SYPD= 9.38633
#num_phys_windows=2
else if ( "$npes" == "2304" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set physics_window = "8,3"
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8";  set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8";  set ice_io_layout   =  "1,4"
  set domains_stack_size = "2097152"
#npes= 2304  main_loop= 602.370626  ATM= 601.427946  OCN= 0.000000000000000E+00  SYPD= 11.789
#num_phys_windows=2

else if ( "$npes" == "4608" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set physics_window = "8,1"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set domains_stack_size = "2097152"
#npes= 4608  main_loop= 432.950591  ATM= 431.919848  OCN= 0.000000000000000E+00  SYPD= 16.4023

else if ( "$npes" == "3456" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "2"
  set physics_window = "8,2"
  set fv_layout    =   "12,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,24";   set land_io_layout  =  "1,3"
  set ocean_layout =   "144,12";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,12";  set ice_io_layout   =  "1,3"
  set domains_stack_size = "2097152"
#npes= 3456  main_loop= 469.061346  ATM= 468.106034  OCN= 0.000000000000000E+00 SYPD= 15.1395

else if ( "$npes" == "3456_8th" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "8"
  set physics_window = "8,2"
  set fv_layout    =   "12,6";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,6";   set land_io_layout  =  "1,3"
  set ocean_layout =   "144,3";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,3";  set ice_io_layout   =  "1,3"
  set domains_stack_size = "2097152"
#npes= 3456  main_loop= 558.512655  ATM= 557.310730  OCN= 0.000000000000000E+00  SYPD= 12.7148
#npes= 3456  main_loop= 557.427791  ATM= 556.135122  OCN= 0.000000000000000E+00  SYPD= 12.7395
#npes= 3456  main_loop= 563.640785  ATM= 562.404289  OCN= 0.000000000000000E+00  SYPD= 12.5991
#num_phys_windows=8
else if ( "$npes" == "6912" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "8"
  set physics_window = "8,1"
  set fv_layout    =   "12,12";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,12";   set land_io_layout  =  "1,3"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set domains_stack_size = "2097152"
#npes= 6912  main_loop= 352.382340  ATM= 351.453542  OCN= 0.000000000000000E+00  SYPD= 20.1525
#num_phys_windows=8
else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in xml."
  if ( $echoOn ) set echo
  exit 1
endif

      ]]></csh>
      
    </input>
  </experiment>


  <experiment name="common_csh_blocks">
    <input>
      <csh><![CDATA[

# runCommand:
set platform_domain = `perl -T -e "use Net::Domain(hostdomain) ; print hostdomain"`
if ("${platform_domain}" == "ncrc.gov") then
  if ( $do_ocean == "true" ) then
    alias runCommand "aprun -d $atmos_nthreads -n $atmos_npes ./$executable:t : -n $ocean_npes -d 1 ./$executable:t"
   else
    alias runCommand "aprun -d $atmos_nthreads -n $atmos_npes ./$executable:t"
  endif
else if ("${platform_domain}" == "zeus.fairmont.rdhpcs.noaa.gov") then
  if ( $do_ocean == "true" ) then
    alias runCommand "mpiexec_mpt -np $atmos_npes -v omplace -nt $atmos_nthreads ./$executable:t : -np $ocean_npes -v omplace -nt 1 ./$executable:t"
   else
     alias runCommand "mpiexec_mpt -np $atmos_npes -v omplace -nt $atmos_nthreads ./$executable:t"
  endif
else
  echo "FATAL: Invalid platform ... unsure how to structure mpirun command"
  exit 53
endif

# Copy AWG ascii input files to GFDL (waiting for FRE to do this for us)
if ( $?flagOutputXferOn && $?flagOutputPostProcessOn ) then
  module switch gcp/2.2 gcp/2.1
  set xmldirlocal = `dirname $rtsxml`
  set xmldirRemote = `echo $xmldirlocal | sed -r "$patternSedHome;$patternSedCTMP;$patternSedCPERM;$patternSedFS;$patternSedLTFS"`
  gcp --batch -cd -r --sync $xmldirlocal/awg_include gfdl:$(AWG_INPUT_HOME_GFDL)/..
  gcp --batch -cd -r --sync $xmldirlocal/awg_include gfdl:$xmldirRemote/
  module switch gcp/2.1 gcp/2.2
endif

# create dummy MOM6 parameter file for do_ocean=.false.
touch $work/INPUT/MOM_input
touch $work/INPUT/MOM_override
ln -s $work/INPUT/topog.nc $work/INPUT/ocean_topog.nc 

      ]]></csh>

      <csh type="always"><![CDATA[
####COMMON ALWAYS CSH BEGINS######
# MOM6 restart switch
if ( $ireload == 1 ) then
 if ( $irun == 1 ) then
  set restart_flag = 'n'
 else
  set restart_flag = 'r'
 endif
else
  set restart_flag = 'r'
endif

# adjustment of dry mass first time only
set adjust_dry_mass = ".true."
if (-e $work/INPUT/coupler.res) then
   set t1 = (`grep "Model start time"   $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   set t2 = (`grep "Current model time" $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   foreach i (1 2 3 4 5 6)
      if ( $t1[$i] != $t2[$i] ) then
         set adjust_dry_mass = ".false."
         break   
      endif      
   end
endif

cat > $work/INPUT/MOM_override << OVERRIDE_EOF
#override RESTORE_SALINITY = False
#override ADJUST_NET_FRESH_WATER_TO_ZERO = False
OVERRIDE_EOF

####COMMON ALWAYS CSH ENDS######

      ]]></csh>
      
     </input>
  </experiment>
 
  <experiment name="c192_data">
    <input>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/lm3/19810101.static_veg.remapped_to_C192_OM4_025.v20140714.tar</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/lm3/c192_OM4_025_hydrography_v20140708.tar </dataSource>
      </dataFile>
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/ic/awg_C192L48_LM3_OM4_025_grid_19810101.remapped.v20140714.tar</dataSource>
      </dataFile>
      <dataFile label="gridSpec" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(AWG_ARCHIVE_ROOT)/awg/input/grid/c192_OM4_025_grid_v20140708.tar</dataSource>
      </dataFile>
    </input>
  </experiment>

  <experiment name="c192_atmos_domain_decomp">
    <input>
      <csh><![CDATA[
# Possible domain decomposition for c192 atmosphere only experiments (numbers from Rusty Benson).
set domains_stack_size = "3097152"
set do_ocean = "false"
if ( "$npes" == "864" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,6"; set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"
#npes= 864  main_loop= 6319.062812  ATM= 6317.148637  OCN= 0.000000000000000E+00  SYPD= 1.1238

else if ( "$npes" == "1152" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "8,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,24";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
#npes= 1152  main_loop= 4833.482869  ATM= 4831.334360  OCN= 0.000000000000000E+00  SYPD= 1.4692

else if ( "$npes" == "2304" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set physics_window = "24,2"
  set fv_layout    =   "8,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,24";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
#npes= 2304  main_loop= 2490.004335  ATM= 2488.745754  OCN= 0.000000000000000E+00  SYPD= 2.85195

else if ( "$npes" == "3456" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "2"
  set physics_window = "8,8"
  set fv_layout    =   "12,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,24";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,12"; set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,12"; set ice_io_layout   =  "1,3"

else if ( "$npes" == "3456_4th" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "4"
  set physics_window = "32,1"
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ocean_layout =   "144,6"; set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"
#npes= 3456  main_loop= 1869.711378  ATM= 1868.383645  OCN= 0.000000000000000E+00  SYPD= 3.79811

else if ( "$npes" == "4608_1" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "2"
  set physics_window = "8,6"
  set fv_layout    =   "12,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,32"; set land_io_layout  =  "1,4"
  set ocean_layout =   "144,16"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"

else if ( "$npes" == "4608_4th" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set physics_window = "16,3"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ocean_layout =   "144,8"; set ocean_io_layout =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
#npes= 4608  main_loop= 1500.457654  ATM= 1498.723635  OCN= 0.000000000000000E+00  SYPD= 4.7328

else if ( "$npes" == "6144" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set physics_window = "12,3"
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"

else if ( "$npes" == "6912" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "4"
  set physics_window = "8,4"
  set fv_layout    =   "12,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,24";   set land_io_layout  =  "1,3"
  set ocean_layout =   "144,12";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,12";  set ice_io_layout   =  "1,3"
  set domains_stack_size = "2097152"

else if ( "$npes" == "6912_8th" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "8"
  set physics_window = "8,4"
  set fv_layout    =   "12,12";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,12";   set land_io_layout  =  "1,3"
  set ocean_layout =   "144,6";  set ocean_io_layout =  "1,3"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set domains_stack_size = "2097152"
#npes= 6912  main_loop= 1211.133097  ATM= 1209.857789  OCN= 0.000000000000000E+00  SYPD= 5.86341

else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in this xml."
  if ( $echoOn ) set echo
  exit 1
endif
      ]]></csh>

    </input>
  </experiment>

  <experiment name="c96_coupled_domain_decomp">
    <input>
      <csh><![CDATA[
# Coupled configurations
  set do_ocean = "true"
  set domains_stack_size = "2097152"

if ( "$npes" == "720" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "0,0";   set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "288"

#npes= 720  main_loop= 3324.007522  ATM= 891.693204  OCN= 3314.492429  SYPD= 0.712129

else if ( "$npes" == "3840" ) then
  set atmos_npes = "768"
  set atmos_nthreads = "4"
  set physics_window = "6,3"
  set fv_layout    =   "8,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "128,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "128,6";   set ocn_io_layout   =  "1,3"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "768"

else if ( "$npes" == "1376" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.242.32x36"
  set ocean_npes = "910"

else if ( "$npes" == "1584" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "1152"

else if ( "$npes" == "1472" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "36,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.274.36x36"
  set ocean_npes = "1022"

else if ( "$npes" == "1600" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,45"; set ocn_io_layout   =  "1,5"; set ocn_mask_table = "mask_table.315.32x45"
  set ocean_npes = "1125"

#else if ( "$npes" == "894" ) then
#  set atmos_npes = "432"
#  set atmos_nthreads = "2"
#  set physics_window = "32,2"
#  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
#  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
#  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
#  set ocn_layout   =   "6,5";   set ocn_io_layout   =  "1,5"; set ocn_mask_table = "MOM_mask_table"
#  set ocean_npes = "30"

else if ( "$npes" == "894" ) then
  set atmos_npes = "288"
  set atmos_nthreads = "3"
  set physics_window = "16,4"
  set fv_layout    =   "2,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "2,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "6,5";   set ocn_io_layout   =  "1,5"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "30"

# CM4i setting for Zeus provided by Rusty Benson
else if ( "$npes" == "900" ) then
  set atmos_npes = 864
  set atmos_nthreads = 1
  set physics_window = "8,2"
  set fv_layout    = "12,12";   set fv_io_layout    = "1,4"
  set land_layout  = "12,12";   set land_io_layout  = "1,4"
  set ice_layout   = "144,6";   set ice_io_layout   = "1,6"
  set ocn_layout   = "6,6";     set ocn_io_layout   = "1,6"; set ocn_mask_table = "MOM_mask_table"  #360x210
  set ocean_npes = 36

else if ( "$npes" == "924" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set physics_window = "32,2"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "10,6";  set ocn_io_layout   =  "1,6"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "60"

#else if ( "$npes" == "1182" ) then
#  set atmos_npes = "576"
#  set atmos_nthreads = "2"
#  set physics_window = "24,2"
#  set fv_layout    =   "4,24";  set fv_io_layout    =  "1,4"
#  set land_layout  =   "4,24";  set land_io_layout  =  "1,4"
#  set ice_layout   =   "192,3"; set ice_io_layout   =  "1,3"
#  set ocn_layout   =   "6,5";   set ocn_io_layout   =  "1,5"; set ocn_mask_table = "MOM_mask_table"
#  set ocean_npes = "30"

#else if ( "$npes" == "1182" ) then
#  set atmos_npes = "288"
#  set atmos_nthreads = "4"
#  set physics_window = "48,1"
#  set fv_layout    =   "2,24";  set fv_io_layout    =  "1,4"
#  set land_layout  =   "2,24";  set land_io_layout  =  "1,4"
#  set ice_layout   =   "96,3";  set ice_io_layout   =  "1,3"
#  set ocn_layout   =   "6,5";   set ocn_io_layout   =  "1,5"; set ocn_mask_table = "MOM_mask_table"
#  set ocean_npes = "30"

else if ( "$npes" == "1200" ) then
   set atmos_npes = 1152
   set atmos_nthreads = 1
   set physics_window = "8,2"
   set fv_layout    = "12,16";   set fv_io_layout    = "1,4"
   set land_layout  = "12,16";   set land_io_layout  = "1,4"
   set ice_layout   = "144,8";   set ice_io_layout  = "1,4"
   set ocn_layout   = "8,6";     set ocn_io_layout    = "1,6"; set ocn_mask_table = "MOM_mask_table"  #360x210
   set ocean_npes = 48

else if ( "$npes" == "1440" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set physics_window = "32,2"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "0,0";   set ocn_io_layout   =  "1,1"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "576"

#npes= 1440  main_loop= 1714.841968  ATM= 509.483819  OCN= 1698.589424  SYPD= 1.38037

else if ( "$npes" == "2620" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set physics_window = "32,2"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.548.32x72"
  set ocean_npes = "1756"

else if ("$npes" == "1878" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set physics_window = "16,2"
  set fv_layout    =   "6,24";   set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";   set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "15,10";  set ocn_io_layout   =  "1,10"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "150"

else if ( "$npes" == "3168" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set physics_window = "32,2"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2304"

#npes= 3168  main_loop= 556.145360  ATM= 504.227122  OCN= 528.297102  SYPD= 4.2563
#npes= 3168  main_loop= 556.754100  ATM= 503.647652  OCN= 528.220859  SYPD= 4.25165

else if ( "$npes" == "3456" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set physics_window = "12,4"
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2304"

#npes= 3456  main_loop= 576.297966  ATM= 411.944604  OCN= 547.548220  SYPD= 4.10746
#npes= 3456  main_loop= 539.972313  ATM= 394.137114  OCN= 526.619508  SYPD= 4.38379

else if ( "$npes" == "3456_2" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set physics_window = "32,2"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "36,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2592"

#npes= 3456  main_loop= 524.846268  ATM= 505.679503  OCN= 474.904650  SYPD= 4.51013

else if ( "$npes" == "3296" ) then
  set atmos_npes = "432"
  set atmos_nthreads = "2"
  set physics_window = "32,2"
  set fv_layout    =   "3,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "3,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,3"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set ocean_npes   = "2432"

#npes= 3296  main_loop= 511.343895  ATM= 507.349218  OCN= 391.545661  SYPD= 4.62922
#npes= 3296  main_loop= 593.167007  ATM= 532.334115  OCN= 451.776504  SYPD= 3.99065 ?
#npes= 3296  main_loop= 506.862653  ATM= 503.128218  OCN= 391.497827  SYPD= 4.67015

else if ( "$npes" == "3584" ) then
  set atmos_npes = "576"
  set atmos_nthreads = "2"
  set physics_window = "12,4"
  set fv_layout    =   "8,12";  set fv_io_layout    =  "1,4"
  set land_layout  =   "8,12";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,4"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set ocean_npes   = "2432"

#npes= 3584  main_loop= 423.286286  ATM= 399.471799  OCN= 391.183390  SYPD= 5.59225
#npes= 3584  main_loop= 419.922637  ATM= 395.322781  OCN= 391.138917  SYPD= 5.63705

else if ( "$npes" == "5279" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "2"
  set physics_window = "8,4"
  set fv_layout    =   "12,12"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,12"; set land_io_layout  =  "2,4"
  set ice_layout   =   "72,12"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "90,54"; set ocn_io_layout   =  "2,6"; set ocn_mask_table = "mask_table.1309.90x54"
  set ocean_npes   = "3551"

#npes= 5279  main_loop= 313.143484  ATM= 295.694495  OCN= 290.264955  SYPD= 7.55923

else if ( "$npes" == "6975" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set physics_window = "8,3"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "2,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "2,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "2,4"
  set ocn_layout   =   "90,72"; set ocn_io_layout   =  "2,4"; set ocn_mask_table = "mask_table.1809.90x72"
  set ocean_npes   = "4671"

#npes= 6975  main_loop= 252.023227  ATM= 238.648825  OCN= 231.217848  SYPD= 9.39248

else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in this xml."
  if ( $echoOn ) set echo
  exit 1
endif

cat > $work/INPUT/MOM_layout << LAYOUT_EOF
LAYOUT = $ocn_layout
#override IO_LAYOUT = $ocn_io_layout
MASKTABLE = $ocn_mask_table
LAYOUT_EOF
      ]]></csh>

    </input>
  </experiment>


  <experiment name="c192_coupled_domain_decomp">
    <input>
      <csh><![CDATA[
# Coupled configurations
set do_ocean = "true"
set domains_stack_size = "3097152"
if ( "$npes" == "1152" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "24,12"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "288"

else if ( "$npes" == "1119" ) then
  set atmos_npes = "864"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "6,24";  set fv_io_layout    =  "1,4"
  set land_layout  =   "6,24";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,6"; set ice_io_layout   =  "1,3"
  set ocn_layout   =   "16,18"; set ocn_io_layout   =  "4,2"; set ocn_mask_table = "mask_table.33.16x18"
  set ocean_npes = "255"

else if ( "$npes" == "1728" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "0,0"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "576"

else if ( "$npes" == "1632" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "1"
  set physics_window = "0,0"
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,18"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "mask_table.96.32x18"
  set ocean_npes = "480"

else if ( "$npes" == "3456" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set physics_window = "16,3"
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "0,0"; set ocn_io_layout   =  "1,1"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes = "1152"

else if ( "$npes" == "3210" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "2"
  set physics_window = "16,3"
  set fv_layout    =   "12,16";  set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16";  set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,36"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.246.32x36"
  set ocean_npes = "906"

else if ( "$npes" == "6912" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set physics_window = "16,3"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "2304"

else if ( "$npes" == "13824" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set physics_window = "8,3"
  set fv_layout    =   "24,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "24,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set ocean_npes = "4608"

else if ( "$npes" == "6912" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set physics_window = "16,3"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes   = "2304"
#SYPD= 4.27491  npes= 6912  main_loop= 553.724798  ATM= 523.916859  OCN= 515.782269
else if ( "$npes" == "7040" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set physics_window = "16,3"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set do_ocean = "true"
  set ocean_npes   = "2432"

else if ( "$npes" == "7008" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set physics_window = "16,3"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "75,32"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes   = "2400"

else if ( "$npes" == "7848" ) then
  set atmos_npes = "1152"
  set atmos_nthreads = "4"
  set physics_window = "16,3"
  set fv_layout    =   "12,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "12,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,8"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes   = "3240"

else if ( "$npes" == "15696" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set physics_window = "8,3"
  set fv_layout    =   "24,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "24,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "90,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes   = "6480"

else if ( "$npes" == "8169" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set physics_window = "12,3"
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,45"; set ocn_io_layout   =  "1,5"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes   = "2025"

else if ( "$npes" == "8448" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set physics_window = "12,3"
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "32,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "MOM_mask_table"
  set do_ocean = "true"
  set ocean_npes   = "2304"

else if ( "$npes" == "8576" ) then
  set atmos_npes = "1536"
  set atmos_nthreads = "4"
  set physics_window = "12,3"
  set fv_layout    =   "8,32"; set fv_io_layout    =  "1,4"
  set land_layout  =   "8,32"; set land_io_layout  =  "1,4"
  set ice_layout   =   "128,12"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set do_ocean = "true"
  set ocean_npes   = "2432"
else if ( "$npes" == "9344" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "4"
  set physics_window = "8,4"
  set fv_layout    =   "12,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,24";   set land_io_layout  =  "1,3"
  set ice_layout   =   "144,12";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set do_ocean = "true"
  set ocean_npes   = "2432"
#SYPD= 5.71746  npes= 9344  main_loop= 414.016546  ATM= 392.145506  OCN= 381.589754

else if ( "$npes" == "12595" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set physics_window = "8,3"
  set fv_layout    =   "24,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "24,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1229.64x72"
  set ocean_npes = "3379"
#npes= 12595  main_loop= 349.973723  ATM= 345.592016  OCN= 292.770137  SYPD= 6.76372

else if ( "$npes" == "9344" ) then
  set atmos_npes = "1728"
  set atmos_nthreads = "4"
  set physics_window = "8,4"
  set fv_layout    =   "12,24";   set fv_io_layout    =  "1,3"
  set land_layout  =   "12,24";   set land_io_layout  =  "1,3"
  set ice_layout   =   "144,12";  set ice_io_layout   =  "1,3"
  set ocn_layout   =   "45,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.808.45x72"
  set do_ocean = "true"
  set ocean_npes   = "2432"
#SYPD= 5.71746  npes= 9344  main_loop= 414.016546  ATM= 392.145506  OCN= 381.589754

else if ( "$npes" == "12595" ) then
  set atmos_npes = "2304"
  set atmos_nthreads = "4"
  set physics_window = "8,3"
  set fv_layout    =   "24,16"; set fv_io_layout    =  "1,4"
  set land_layout  =   "24,16"; set land_io_layout  =  "1,4"
  set ice_layout   =   "144,16"; set ice_io_layout   =  "1,4"
  set ocn_layout   =   "64,72"; set ocn_io_layout   =  "1,4"; set ocn_mask_table = "mask_table.1229.64x72"
  set ocean_npes = "3379"
#npes= 12595  main_loop= 349.973723  ATM= 345.592016  OCN= 292.770137  SYPD= 6.76372

else
  if ( $echoOn ) unset echo
  echo "*ERROR*: npes == '$npes' is not supported in this xml."
  if ( $echoOn ) set echo
  exit 1
endif

cat > $work/INPUT/MOM_layout << LAYOUT_EOF
LAYOUT = $ocn_layout
#override IO_LAYOUT = $ocn_io_layout
MASKTABLE = $ocn_mask_table
LAYOUT_EOF

      ]]></csh>


      </input>
  </experiment>


<!--================================-->
<!--= TEMPLATES FOR POSTPROCESSING =-->
<!--================================-->

  <experiment name="c96_amip_postprocess">
    <postProcess>

      <component type="atmos" zInterp="era40" start="$(ANA_AMIP_START)" source="atmos_month" cubicToLatLon="180,288">
        <timeSeries freq="3hr" source="atmos_8xdaily" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmos8xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
<!-- MDBI, this switch must be on to trigger "fredb" automatically -->
          <analysis switch="$(MDBIswitch)" cumulative="no" script="$FRE_CURATOR_HOME/share/bin/database_ingestor.csh"/>
<!-- /MDBI -->
        </timeSeries>
        <timeSeries freq="6hr" source="atmos_4xdaily" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmos4xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="atmos_daily" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmosDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmosMonthTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)">
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.atmos.csh"/>
	</timeAverage>  
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.atmos.csh"/>
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmosMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
        <timeAverage source="annual" interval="$(PP_AMIP_CHUNK)" calcInterval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="annual" interval="$(ANA_AMIP_LEN)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmosAnnualAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_level" start="$(ANA_AMIP_START)" source="atmos_month" cubicToLatLon="180,288">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)"/>
        <timeSeries freq="annual" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmosLevelAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmosLevelMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_month_aer" start="$(ANA_AMIP_START)" source="atmos_month_aer" cubicToLatLon="180,288" interpMethod="conserve_order1">
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmosMonthAerAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_diurnal" start="$(ANA_AMIP_START)" source="atmos_diurnal" cubicToLatLon="180,288">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
      </component>

      <component type="atmos_scalar" start="$(ANA_AMIP_START)" source="atmos_scalar">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)"/>
      </component>

<!-- FULL CHEMISTRY -->
      <component type="tracer_level" start="$(ANA_AMIP_START)" source="atmos_tracer" cubicToLatLon="180,288" interpMethod="conserve_order1">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)"/>
        <timeSeries freq="annual" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/tracerAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/tracerMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

<!-- LAND -->
      <component type="land" start="$(ANA_AMIP_START)" source="land_month" cubicToLatLon="180,288" interpMethod="conserve_order1">
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_AMIP_CHUNK)"/>
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/landMonthTS/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/landMonthAve/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeAverage>
      </component>

      <component type="land_cubic" start="$(ANA_AMIP_START)" source="land_month" cubicToLatLon="none">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)" >
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/landMonthTSNative/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/landDailyTSNative/*)">
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
      </component>

    </postProcess>
  </experiment>

  <experiment name="c96_climo_postprocess">
    <postProcess>

      <component type="atmos" zInterp="era40" start="$(ANA_CLIMO_START)" source="atmos_month" cubicToLatLon="180,288">
        <timeSeries freq="3hr" source="atmos_8xdaily" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmos8xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
<!-- MDBI, this switch must be on to trigger "fredb" automatically -->
          <analysis switch="$(MDBIswitch)" cumulative="no" script="$FRE_CURATOR_HOME/share/bin/database_ingestor.csh"/>
<!-- /MDBI -->
        </timeSeries>
        <timeSeries freq="6hr" source="atmos_4xdaily" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmos4xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="atmos_daily" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmosDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="monthly" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmosMonthTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CLIMO_CHUNK)">
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.atmos.csh"/>
	</timeAverage>
        <timeAverage source="monthly" interval="$(PP_CLIMO_CHUNK_B)">
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.atmos.csh"/>
	</timeAverage>	
        <timeAverage source="monthly" interval="$(ANA_CLIMO_LEN)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmosMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
        <timeAverage source="annual" interval="$(PP_CLIMO_CHUNK)"   calcInterval="$(PP_CLIMO_CHUNK)"/>
        <timeAverage source="annual" interval="$(PP_CLIMO_CHUNK_B)" calcInterval="$(PP_CLIMO_CHUNK_B)"/>
        <timeAverage source="annual" interval="$(ANA_CLIMO_LEN)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmosAnnualAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_level" start="$(ANA_CLIMO_START)" source="atmos_month" cubicToLatLon="180,288">
        <timeSeries freq="monthly" chunkLength="$(PP_CLIMO_CHUNK)"/>
        <timeSeries freq="annual" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmosLevelAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CLIMO_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_CLIMO_LEN)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmosLevelMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_month_aer" start="$(ANA_CLIMO_START)" source="atmos_month_aer" cubicToLatLon="180,288" interpMethod="conserve_order1">
        <timeAverage source="monthly" interval="$(PP_CLIMO_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_CLIMO_LEN)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmosMonthAerAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_diurnal" start="$(ANA_CLIMO_START)" source="atmos_diurnal" cubicToLatLon="180,288">
        <timeSeries freq="monthly" chunkLength="$(PP_CLIMO_CHUNK)"/>
        <timeAverage source="monthly" interval="$(PP_CLIMO_CHUNK)"/>
      </component>

      <component type="atmos_scalar" start="$(ANA_CLIMO_START)" source="atmos_scalar">
        <timeSeries freq="monthly" chunkLength="$(PP_CLIMO_CHUNK)"/>
      </component>

<!-- FULL CHEMISTRY -->
      <component type="tracer_level" start="$(ANA_CLIMO_START)" source="atmos_tracer" cubicToLatLon="180,288" interpMethod="conserve_order1">
        <timeSeries freq="monthly" chunkLength="$(PP_CLIMO_CHUNK)"/>
        <timeSeries freq="annual" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/tracerAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CLIMO_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_CLIMO_LEN)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/tracerMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

<!-- LAND -->
      <component type="land" start="$(ANA_CLIMO_START)" source="land_month" cubicToLatLon="180,288" interpMethod="conserve_order1">
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_CLIMO_CHUNK)"/>
        <timeSeries freq="monthly" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/landMonthTS/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeAverage source="annual" interval="$(PP_CLIMO_CHUNK)"/>
        <timeAverage source="annual" interval="$(PP_CLIMO_CHUNK_B)"/>
        <timeAverage source="monthly" interval="$(PP_CLIMO_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_CLIMO_LEN)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/landMonthAve/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeAverage>
      </component>

      <component type="land_cubic" start="$(ANA_CLIMO_START)" source="land_month" cubicToLatLon="none">
        <timeSeries freq="monthly" chunkLength="$(PP_CLIMO_CHUNK)" >
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/landMonthTSNative/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/landDailyTSNative/*)">
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
      </component>

    </postProcess>
  </experiment>

  <experiment name="c192_amip_postprocess">
    <postProcess>

      <component type="atmos" zInterp="era40" start="$(ANA_AMIP_START)" source="atmos_month" cubicToLatLon="360,576">
        <timeSeries freq="3hr" source="atmos_8xdaily" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmos8xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
<!-- MDBI, this switch must be on to trigger "fredb" automatically -->
          <analysis switch="$(MDBIswitch)" cumulative="no" script="$FRE_CURATOR_HOME/share/bin/database_ingestor.csh"/>
<!-- /MDBI -->
        </timeSeries>
        <timeSeries freq="6hr" source="atmos_4xdaily" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmos4xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="atmos_daily" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmosDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmosMonthTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)">
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.atmos.csh"/>
	</timeAverage>
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.atmos.csh"/>
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmosMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
        <timeAverage source="annual" interval="$(PP_AMIP_CHUNK)" calcInterval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="annual" interval="$(ANA_AMIP_LEN)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmosAnnualAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_level" start="$(ANA_AMIP_START)" source="atmos_month" cubicToLatLon="360,576">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)"/>
        <timeSeries freq="annual" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmosLevelAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)">
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.atmos.csh"/>
	</timeAverage>
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.atmos.csh"/>
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmosLevelMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_month_aer" start="$(ANA_AMIP_START)" source="atmos_month_aer" cubicToLatLon="360,576" interpMethod="conserve_order1">
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/atmosMonthAerAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_diurnal" start="$(ANA_AMIP_START)" source="atmos_diurnal" cubicToLatLon="360,576">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
      </component>

      <component type="atmos_scalar" start="$(ANA_AMIP_START)" source="atmos_scalar">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)"/>
      </component>

<!-- FULL CHEMISTRY -->
      <component type="tracer_level" start="$(ANA_AMIP_START)" source="atmos_tracer" cubicToLatLon="360,576" interpMethod="conserve_order1">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)"/>
        <timeSeries freq="annual" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/tracerAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/tracerMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

<!-- LAND -->
      <component type="land" start="$(ANA_AMIP_START)" source="land_month" cubicToLatLon="360,576" interpMethod="conserve_order1">
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_AMIP_CHUNK)"/>
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/landMonthTS/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_AMIP_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_AMIP_LEN)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/landMonthAve/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeAverage>
      </component>

      <component type="land_cubic" start="$(ANA_AMIP_START)" source="land_month" cubicToLatLon="none">
        <timeSeries freq="monthly" chunkLength="$(PP_AMIP_CHUNK)" >
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/landMonthTSNative/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_AMIP_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_amip.xml" xpointer="xpointer(*/landDailyTSNative/*)">
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
      </component>

    </postProcess>
  </experiment>

  <experiment name="c192_climo_postprocess">
    <postProcess>

      <component type="atmos" zInterp="era40" start="$(ANA_CLIMO_START)" source="atmos_month" cubicToLatLon="360,576">
        <timeSeries freq="3hr" source="atmos_8xdaily" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmos8xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
<!-- MDBI, this switch must be on to trigger "fredb" automatically -->
          <analysis switch="$(MDBIswitch)" cumulative="no" script="$FRE_CURATOR_HOME/share/bin/database_ingestor.csh"/>
<!-- /MDBI -->
        </timeSeries>
        <timeSeries freq="6hr" source="atmos_4xdaily" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmos4xDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="atmos_daily" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmosDailyTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeSeries freq="monthly" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmosMonthTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CLIMO_CHUNK)">
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.atmos.csh"/>
	</timeAverage> 
        <timeAverage source="monthly" interval="$(PP_CLIMO_CHUNK_B)">
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.atmos.csh"/>
	</timeAverage> 
        <timeAverage source="monthly" interval="$(ANA_CLIMO_LEN)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmosMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
        <timeAverage source="annual" interval="$(PP_CLIMO_CHUNK)" calcInterval="$(PP_CLIMO_CHUNK)"/>
        <timeAverage source="annual" interval="$(ANA_CLIMO_LEN)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmosAnnualAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_level" start="$(ANA_CLIMO_START)" source="atmos_month" cubicToLatLon="360,576">
        <timeSeries freq="monthly" chunkLength="$(PP_CLIMO_CHUNK)"/>
        <timeSeries freq="annual" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmosLevelAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CLIMO_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_CLIMO_LEN)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmosLevelMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_month_aer" start="$(ANA_CLIMO_START)" source="atmos_month_aer" cubicToLatLon="360,576" interpMethod="conserve_order1">
        <timeAverage source="monthly" interval="$(PP_CLIMO_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_CLIMO_LEN)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/atmosMonthAerAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

      <component type="atmos_diurnal" start="$(ANA_CLIMO_START)" source="atmos_diurnal" cubicToLatLon="360,576">
        <timeSeries freq="monthly" chunkLength="$(PP_CLIMO_CHUNK)"/>
        <timeAverage source="monthly" interval="$(PP_CLIMO_CHUNK)"/>
      </component>

      <component type="atmos_scalar" start="$(ANA_CLIMO_START)" source="atmos_scalar">
        <timeSeries freq="monthly" chunkLength="$(PP_CLIMO_CHUNK)"/>
      </component>

<!-- FULL CHEMISTRY -->
      <component type="tracer_level" start="$(ANA_CLIMO_START)" source="atmos_tracer" cubicToLatLon="360,576" interpMethod="conserve_order1">
        <timeSeries freq="monthly" chunkLength="$(PP_CLIMO_CHUNK)"/>
        <timeSeries freq="annual" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/tracerAnnualTS/*)">
            <xi:fallback/>
          </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CLIMO_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_CLIMO_LEN)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/tracerMonthAve/*)">
            <xi:fallback/>
          </xi:include>
        </timeAverage>
      </component>

<!-- LAND -->
      <component type="land" start="$(ANA_CLIMO_START)" source="land_month" cubicToLatLon="360,576" interpMethod="conserve_order1">
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_CLIMO_CHUNK)"/>
        <timeSeries freq="monthly" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/landMonthTS/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeAverage source="monthly" interval="$(PP_CLIMO_CHUNK)"/>
        <timeAverage source="monthly" interval="$(ANA_CLIMO_LEN)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/landMonthAve/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeAverage>
      </component>

      <component type="land_cubic" start="$(ANA_CLIMO_START)" source="land_month" cubicToLatLon="none">
        <timeSeries freq="monthly" chunkLength="$(PP_CLIMO_CHUNK)" >
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/landMonthTSNative/*)" >
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
        <timeSeries freq="daily" source="land_daily" chunkLength="$(PP_CLIMO_CHUNK)">
          <xi:include href="./awg_include/analysis/analysis_climo.xml" xpointer="xpointer(*/landDailyTSNative/*)">
            <xi:fallback/>
	  </xi:include>
        </timeSeries>
      </component>

    </postProcess>
  </experiment>



<!--====================-->
<!--= AMIP EXPERIMENTS =-->
<!--====================-->

  <experiment name="c96L48_am4a1r1" inherit="cm4p1_compile">

<!-- MDBI -->
    <description
communityProject="$(ProjectID)" 
communityModel="am4a1" 
communityModelID="am4a1"
communityExperimentName="$(name)" 
communityExperimentID="$(name)" >
<!-- /MDBI -->

AM4 prototype configuration "am4a1r1" from MDT Atmosphere Working Group.

c96 horizontal grid with approximately 100km resolution and 48 vertical levels.
Convection based on "double-plume" from Ming Zhao.
Configuration derived from "c96L48_am4a1", except
- updated input data sets compatible with revised ocean grid
- slight retuning of the atmosphere for energy balance
  based on Ming Zhao's 'c96L48_am4a1_2000climo_retune3'
  (beta_rad = 0.45 instead of 0.27).

For more information about AWG configurations, refer to
http://cobweb.gfdl.noaa.gov/~cjg/awg

    </description>

<!-- MDBI -->
    <realization r="1" i="1" p="1"/>
    <communityComment>
Experiment name = $(name)
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_AMIP_START)"
      endTime="$(EXP_AMIP_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

    <input>
      <!-- Namelist -->
      <namelist file="$(AWG_INPUT_HOME)/nml/ocean.nml"/>       
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_common.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_c96.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_amip.nml"/>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1980,1,1,0,0,0,
        calendar = 'julian'
        dt_atmos = 1200,
        dt_cpld  = 7200,
        use_lag_fluxes = .true.
        concurrent = .false.
        do_ocean = .false.
        ocean_npes = 0
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <!-- Input datasets -->
      <xi:include xpointer="xpointer(//experiment[@name='common_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='amip_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_atmos_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>

    </input>

    <runtime>
      <production simTime="$(EXP_AMIP_LEN)" units="years" npes="1728" runTime="16:00:00">
        <segment simTime="12" units="months" runTime="3:00:00"/>
      </production>
      <regression name="basic">
        <run days="8"   npes="432"  runTimePerJob="02:30:00"/>
      </regression>
      <regression name="rts">
        <run days="4 4"  npes="432"  runTimePerJob="02:30:00"/>
        <run days="8"    npes="864"  runTimePerJob="02:30:00"/>
      </regression>

      <regression name="restarts">
        <run days="4 4" npes="432"  runTimePerJob="02:30:00"/>
      </regression>
      
      <regression name="timing2">
        <run months="1" npes="3072"  runTimePerJob="02:00:00"/>
      </regression>

      <regression name="timing">
        <run months="1" npes="432"  runTimePerJob="02:00:00"/>
        <run months="1" npes="864"  runTimePerJob="01:00:00"/>
        <run months="1" npes="1728" runTimePerJob="00:45:00"/>
        <run months="1" npes="2304" runTimePerJob="00:30:00"/>
        <run months="1" npes="3456" runTimePerJob="00:30:00"/>
        <run months="1" npes="4608"  runTimePerJob="00:30:00"/>
        <run months="1" npes="6912"  runTimePerJob="00:30:00"/>
      </regression>

      <reference restart="$(REFERENCE)/archive/1x0m8d_432pe/restart/19800109.tar"/>
      <reference restart="$(REFERENCE_awg)/1x0m8d_432pe/restart/19800109.tar"/>
      <reference restart="$(REFERENCE_awg)/1x0m10d_432pe/restart/19800111.tar"/>

    </runtime>

    <postProcess>
      <xi:include xpointer="xpointer(//experiment[@name='c96_amip_postprocess']/postProcess/node())"/>
    </postProcess>

  </experiment>

  <experiment name="c96L48_am4a2r1" inherit="c96L48_am4a1r1">

<!-- MDBI -->
    <description
communityProject="$(ProjectID)" 
communityModel="am4a2" 
communityModelID="am4a2"
communityExperimentName="$(name)" 
communityExperimentID="$(name)" >
<!-- /MDBI -->

AM4 prototype configuration "am4a2r1" from MDT Atmosphere Working Group.
Very similar on "c96L48_am4a2c" but:
- bug fix to enable rk_act_only_if_ql_gt_qmin = .true. with total activation
- updated input data sets compatible with revised ocean grid

For more information about AWG configurations, refer to
http://cobweb.gfdl.noaa.gov/~cjg/awg

    </description>

<!-- MDBI -->
    <realization r="1" i="1" p="1"/>
    <communityComment>
Experiment name = $(name)
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_AMIP_START)"
      endTime="$(EXP_AMIP_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

   <input> 
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_c96.nml"/>
   </input> 

  </experiment>

  <experiment name="c96L48_am4b2r1" inherit="c96L48_am4a1r1">

<!-- MDBI -->
    <description
communityProject="$(ProjectID)" 
communityModel="am4b2" 
communityModelID="am4b2"
communityExperimentName="$(name)" 
communityExperimentID="$(name)" >
<!-- /MDBI -->

AM4 prototype hybrid configuration "am4b2r1" from MDT Atmosphere Working Group.

c96 horizontal grid with approximately 100km resolution and 48 vertical levels.
Convection based on hybrid "alternate closure" from Leo Donner

For more information about AWG configurations, refer to
http://cobweb.gfdl.noaa.gov/~cjg/awg

    </description>

<!-- MDBI -->
    <realization r="1" i="1" p="1"/>
    <communityComment>
Experiment name = $(name)
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_AMIP_START)"
      endTime="$(EXP_AMIP_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

    <input>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4b2r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4b2r1_c96.nml"/>
    </input>

  </experiment>

  <experiment name="c192L48_am4a1r1" inherit="cm4p1_compile">

<!-- MDBI -->
    <description
communityProject="$(ProjectID)" 
communityModel="am4a1" 
communityModelID="am4a1"
communityExperimentName="$(name)" 
communityExperimentID="$(name)" >
<!-- /MDBI -->

AM4 prototype configuration "am4a1r1" from MDT Atmosphere Working Group.

c192 horizontal grid with approximately 50km resolution and 48 vertical levels.
Convection based on "double-plume" from Ming Zhao.
Configuration based from "c192L48_am4a1", except
- updated input data sets compatible with revised ocean grid

For more information about AWG configurations, refer to
http://cobweb.gfdl.noaa.gov/~cjg/awg

    </description>

<!-- MDBI -->
    <realization r="1" i="1" p="1"/>
    <communityComment>
Experiment name = $(name)
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_AMIP_START)"
      endTime="$(EXP_AMIP_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

    <input>
      <!-- Namelist -->
      <namelist file="$(AWG_INPUT_HOME)/nml/ocean.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_common.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_c192.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_amip.nml"/>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1980,1,1,0,0,0,
        calendar = 'julian'
        dt_atmos = 1200,
        dt_cpld  = 7200,
        use_lag_fluxes = .true.
        concurrent = .false.
        do_ocean = .false.
        ocean_npes=0
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <!--AMIP Input datasets -->
      <xi:include xpointer="xpointer(//experiment[@name='common_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='amip_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192_atmos_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>
    </input>

    <runtime>
      <production simTime="$(EXP_AMIP_LEN)" units="years" npes="4608" runTime="16:00:00">
        <segment simTime="12" units="months" runTime="5:20:00"/>
      </production>
      <regression name="basic">
        <run days="8" npes="864" runTimePerJob="01:00:00"/>
      </regression>
      <regression name="rts">
        <run days="4 4" npes="864" runTimePerJob="01:00:00"/>
        <run days="8" npes="1152" runTimePerJob="01:00:00"/>
      </regression>

      <regression name="restarts">
        <run days="4 4" npes="864" runTimePerJob="01:00:00"/>
      </regression>
      <regression name="timing">
        <run months="1"   npes="864"  runTimePerJob="02:30:00"/> 
        <run months="1"   npes="1152" runTimePerJob="02:00:00"/> 
        <run months="1"   npes="2304" runTimePerJob="01:30:00"/>
        <run months="1"   npes="3456" runTimePerJob="01:00:00"/>
        <run months="1"   npes="4608" runTimePerJob="01:00:00"/>
        <run months="1"   npes="6144" runTimePerJob="00:30:00"/>
        <run months="1"   npes="6912" runTimePerJob="01:00:00"/>
      </regression>
      <regression name="timing2">
        <run months="1"   npes="4608" runTimePerJob="00:30:00"/>
      </regression>

      <reference restart="$(REFERENCE)/archive/1x0m8d_864pe/restart/19800109.tar"/>
      <reference restart="$(REFERENCE_awg)/1x0m8d_864pe/restart/19800109.tar"/>
      <reference restart="$(REFERENCE_awg)/1x0m10d_864pe/restart/19800111.tar"/>
   </runtime>

    <postProcess>
      <xi:include xpointer="xpointer(//experiment[@name='c192_amip_postprocess']/postProcess/node())"/>
    </postProcess>

  </experiment>


  <experiment name="c192L48_am4a2r1" inherit="c192L48_am4a1r1">

<!-- MDBI -->
    <description
communityProject="$(ProjectID)" 
communityModel="am4a2" 
communityModelID="am4a2"
communityExperimentName="$(name)" 
communityExperimentID="$(name)" >
<!-- /MDBI -->

AM4 prototype configuration "am4a2r1" from MDT Atmosphere Working Group.
Very similar on "c192L48_am4a2c" but:
- bug fix to enable rk_act_only_if_ql_gt_qmin = .true. with total activation
- updated input data sets compatible with revised ocean grid

For more information about AWG configurations, refer to
http://cobweb.gfdl.noaa.gov/~cjg/awg

    </description>

<!-- MDBI -->
    <realization r="1" i="1" p="1"/>
    <communityComment>
Experiment name = $(name)
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_AMIP_START)"
      endTime="$(EXP_AMIP_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

    <input> 
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_c192.nml"/>
   </input> 

  </experiment>

<!--==========================================-->
<!--= CLIMO EXPERIMENTS with do_ocean=.false.=-->
<!--==========================================-->
 <experiment name="c96L48_am4b2r1_2000climo" inherit="c96L48_am4a1r1_2000climo">
    <description
communityProject="$(ProjectID)" 
communityModel="am4b2" 
communityModelID="am4b2"
communityExperimentName="$(name)" 
communityExperimentID="$(name)" >

AM4 prototype hybrid configuration "am4b2r1" from MDT Atmosphere Working Group.

c96 horizontal grid with approximately 100km resolution and 48 vertical levels.
Convection based on hybrid "alternate closure" from Leo Donner

For more information about AWG configurations, refer to
http://cobweb.gfdl.noaa.gov/~cjg/awg

configuration with present-day climatological SSTs, present-day GHGs and aerosols.

    </description>
   <input> 
      <namelist file="$(AWG_INPUT_HOME)/nml/am4b2r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4b2r1_c96.nml"/>
   </input> 
 </experiment>

 <experiment name="c96L48_am4a2r1_2000climo" inherit="c96L48_am4a1r1_2000climo">
   <input> 
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_c96.nml"/>
   </input> 
 </experiment>

 <experiment name="c96L48_am4a1r1_2000climo" inherit="cm4p1_compile">

<!-- MDBI -->
    <description
communityProject="$(ProjectID)" 
communityModel="am4a1" 
communityModelID="am4a1"
communityExperimentName="$(name)" 
communityExperimentID="$(name)" >
<!-- /MDBI -->

Same model as c96L48_am4a1r1, but
configuration with present-day climatological SSTs, present-day GHGs and aerosols.

    </description>

<!-- MDBI -->
    <realization r="1" i="1" p="1"/>
    <communityComment>
Experiment name = $(name)
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_CLIMO_START)"
      endTime="$(EXP_CLIMO_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

    <input>
      <!-- Namelist -->
      <namelist file="$(AWG_INPUT_HOME)/nml/ocean.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_common.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_c96.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_2000climo.nml"/>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1,1,1,0,0,0,
        calendar = 'noleap'
        dt_atmos = 1200,
        dt_cpld  = 7200,
        use_lag_fluxes = .true.
        concurrent = .false.
        do_ocean = .false.
        ocean_npes = 0
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <!-- Input datasets -->
      <xi:include xpointer="xpointer(//experiment[@name='common_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='climo_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_atmos_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>
    </input>

    <runtime>
      <production simTime="$(EXP_CLIMO_LEN)" units="years" npes="1728" runTime="16:00:00">
        <segment simTime="12" units="months" runTime="3:00:00"/>
      </production>
      <regression name="basic">
        <run days="10"   npes="432"  runTimePerJob="02:30:00"/>
      </regression>
      <regression name="rts">
        <run days="5 5"  npes="432"  runTimePerJob="02:30:00"/>
      </regression>
      <regression name="restarts">
        <run days="5 5" npes="432"  runTimePerJob="02:30:00"/>
      </regression>
      <regression name="timing">
        <run months="1" npes="432"  runTimePerJob="02:00:00"/>
        <run months="1" npes="864"  runTimePerJob="01:00:00"/>
        <run months="1" npes="1728" runTimePerJob="00:45:00"/>
        <run months="1" npes="2304" runTimePerJob="00:30:00"/>
        <run months="1" npes="3456" runTimePerJob="00:30:00"/>
      </regression>
      <reference restart="$(REFERENCE)/archive/1x0m10d_432pe/restart/00010111.tar"/>
      <reference restart="$(REFERENCE_awg)/1x0m10d_432pe/restart/00010111.tar"/>
      <reference restart="$(REFERENCE_awg)/1x0m8d_432pe/restart/00010109.tar"/>
    </runtime>

    <postProcess>
      <xi:include xpointer="xpointer(//experiment[@name='c96_climo_postprocess']/postProcess/node())"/>
    </postProcess>

  </experiment>

 
  <experiment name="c192L48_am4a1r1_2000climo" inherit="cm4p1_compile">

<!-- MDBI -->
    <description
communityProject="$(ProjectID)" 
communityModel="am4a1" 
communityModelID="am4a1"
communityExperimentName="$(name)" 
communityExperimentID="$(name)" >
<!-- /MDBI -->

Same model as c192L48_am4a1r1, but
configuration with present-day climatological SSTs, present-day GHGs and aerosols.

    </description>

<!-- MDBI -->
    <realization r="1" i="1" p="1"/>
    <communityComment>
Experiment name = $(name)
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_CLIMO_START)"
      endTime="$(EXP_CLIMO_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

    <input>
      <!-- Namelist -->
      <namelist file="$(AWG_INPUT_HOME)/nml/ocean.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_common.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_c192.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_2000climo.nml"/>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1,1,1,0,0,0,
        calendar = 'noleap'
        dt_atmos = 1200,
        dt_cpld  = 7200,
        use_lag_fluxes = .true.
        concurrent = .false.
        do_ocean = .false.
        ocean_npes = 0
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <!-- Input datasets -->
      <xi:include xpointer="xpointer(//experiment[@name='common_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='climo_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192_atmos_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>
    </input>

    <runtime>
      <production simTime="$(EXP_CLIMO_LEN)" units="years" npes="4608" runTime="16:00:00">
        <segment simTime="12" units="months" runTime="5:20:00"/>
      </production>
      <regression name="basic">
        <run days="8"   npes="864" runTimePerJob="01:00:00"/>
      </regression>
      <regression name="rts">
        <run days="4 4"   npes="864" runTimePerJob="01:00:00"/>
        <run days="8"   npes="1152" runTimePerJob="01:00:00"/>
      </regression>
      
      <regression name="restarts">
        <run days="4 4" npes="864" runTimePerJob="01:00:00"/>
      </regression>
      <regression name="timing">
        <run months="1"   npes="864"  runTimePerJob="02:30:00"/> 
        <run months="1"   npes="1152" runTimePerJob="02:00:00"/> 
        <run months="1"   npes="2304" runTimePerJob="01:30:00"/>
        <run months="1"   npes="3456" runTimePerJob="01:00:00"/>
        <run months="1"   npes="4608" runTimePerJob="01:00:00"/>
        <run months="1"   npes="6912" runTimePerJob="01:00:00"/>
      </regression>

      <reference restart="$(REFERENCE)/archive/1x0m8d_864pe/restart/00010109.tar"/>     
      <reference restart="$(REFERENCE_awg)/1x0m8d_864pe/restart/00010109.tar"/>
      <reference restart="$(REFERENCE_awg)/1x0m10d_864pe/restart/00010111.tar"/>
    </runtime>

    <postProcess>
      <xi:include xpointer="xpointer(//experiment[@name='c192_climo_postprocess']/postProcess/node())"/>
    </postProcess>

  </experiment>

  <experiment name="c192L48_am4a2r1_2000climo" inherit="c192L48_am4a1r1_2000climo">
   <input> 
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_c192.nml"/>
   </input> 
  </experiment>



<!--=======================-->
<!--= CM4 EXPERIMENTS     =-->
<!--=======================-->

<experiment name="CM4_c96L48_am4b2r1_2000climo" inherit="CM4_c96L48_am4a1r1_2000climo">
   <input> 
      <namelist file="$(AWG_INPUT_HOME)/nml/am4b2r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4b2r1_c96.nml"/>
   </input> 
 </experiment>

<experiment name="CM4_c96L48_am4a2r1_2000climo" inherit="CM4_c96L48_am4a1r1_2000climo">
   <input> 
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_c96.nml"/>
   </input> 
 </experiment>

 <experiment name="CM4_c96L48_am4a1r1_2000climo" inherit="cm4p1_compile">

<!-- MDBI -->
    <description
communityProject="$(ProjectID)" 
communityModel="CM4_c96L48_am4a1r1_SIS  $(MOM6_GIT_TAG)" 
communityModelID="CM4_c96L48_am4a1r1_SIS"
communityExperimentName="$(name)">
<!-- /MDBI -->

    </description>
<!-- MDBI -->
    <communityComment>
      Experiment name = $(name)
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_CLIMO_START)"
      endTime="$(EXP_CLIMO_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

    <input>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1,1,1,0,0,0,
        calendar = 'NOLEAP'
        dt_atmos = 1200,
        dt_cpld  = 3600,
        use_lag_fluxes = .true.
        concurrent = .true.
        do_ocean = .true.
        ocean_npes = $ocean_npes
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <namelist name="flux_exchange_nml">
            debug_stocks = .FALSE.
            divert_stocks_report = .TRUE.
            do_area_weighted_flux = .FALSE.
      </namelist>
      <namelist name="fms_io_nml">
            fms_netcdf_restart=.true.
            threading_read='multi'
            max_files_r = 200
            max_files_w = 200
      </namelist>
      <namelist name="fms_nml">
            clock_grain='ROUTINE'
            clock_flags='NONE'
            domains_stack_size = 5000000
            stack_size =0
      </namelist>
      <namelist name="xgrid_nml">
        make_exchange_reproduce = .true.
        interp_method = 'second_order'
      </namelist>

      <!--AWG Input datasets -->
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_common.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_c96.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_2000climo.nml"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_coupled_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>

      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data']/input/node())"/>
    </input>

    <runtime>
      <production simTime="$(EXP_CLIMO_LEN)" units="years" npes="3584" runTime="12:00:00">
        <segment simTime="12" units="months" runTime="12:00:00"/>
      </production>
      <regression name="basic">
        <run days="10" npes="1584" runTimePerJob="01:20:00"/><!---->
      </regression>

      <regression name="rts"> <!--fits on t1-->
        <run days="5 5" npes="1584" runTimePerJob="01:20:00"/><!---->
        <run days="10" npes="3168" runTimePerJob="00:20:00"/><!---->
     </regression>

      <regression name="restarts">
        <run days="5 5" npes="1584" runTimePerJob="01:20:00"/><!---->
      </regression>


      <regression name="timing">
        <run days="10" npes="5279" runTimePerJob="00:20:00"/><!---->
        <run days="10" npes="1376" runTimePerJob="00:20:00"/><!---->
        <run days="10" npes="2620" runTimePerJob="00:20:00"/><!---->
        <run days="10" npes="1600" runTimePerJob="00:20:00"/><!---->
      </regression>

      <regression name="timing2">
        <run days="10" npes="1472" runTimePerJob="00:20:00"/><!---->
      </regression>

      <regression name="bigrts">
        <run days="10" npes="3168" runTimePerJob="00:20:00"/><!---->
        <run days="10" npes="3296" runTimePerJob="00:20:00"/><!---->
        <run days="10" npes="3456" runTimePerJob="00:20:00"/><!---->
        <run days="10" npes="3584" runTimePerJob="00:20:00"/><!---->
        <run days="10" npes="6975" runTimePerJob="00:20:00"/><!---->

      </regression>

      <reference restart="$(REFERENCE)/archive/1x0m10d_1440pe/restart/00010111.tar"/>

    </runtime>

    <postProcess>
      <xi:include xpointer="xpointer(//experiment[@name='c96_climo_postprocess']/postProcess/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='OM4_postprocess']/postProcess/node())"/>
    </postProcess>

  </experiment>


 <experiment name="CM4_c192L48_am4a2r1_2000climo" inherit="CM4_c192L48_am4a1r1_2000climo">
   <input> 
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_c192.nml"/>
   </input> 
 </experiment>

 
 <experiment name="CM4_c192L48_am4a1r1_2000climo" inherit="cm4p1_compile"> 

<!-- MDBI -->
    <description
communityProject="$(ProjectID)" 
communityModel="CM4_AM4a1_SIS  $(MOM6_GIT_TAG)" 
communityModelID="CM4_AM4a1_SIS"
communityExperimentName="$(name)" 
communityExperimentID="$(name)" >
<!-- /MDBI -->

Same model as c192L48_am4a1r1, but
configuration with present-day climatological SSTs, present-day GHGs and aerosols.

    </description>
<!-- MDBI -->
    <realization r="1" i="1" p="1"/>
    <communityComment>
      Experiment name = $(name)
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_CLIMO_START)"
      endTime="$(EXP_CLIMO_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

    <input>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1,1,1,0,0,0,
        calendar = 'NOLEAP'
        dt_atmos = 1200,
        dt_cpld  = 3600,
        use_lag_fluxes = .true.
        concurrent = .true.
        do_ocean = .true.
        ocean_npes = $ocean_npes
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <namelist name="flux_exchange_nml">
            debug_stocks = .FALSE.
            divert_stocks_report = .TRUE.
            do_area_weighted_flux = .FALSE.
      </namelist>
      <namelist name="fms_io_nml">
            fms_netcdf_restart=.true.
            threading_read='multi'
            max_files_r = 200
            max_files_w = 200
      </namelist>
      <namelist name="fms_nml">
            clock_grain='ROUTINE'
            clock_flags='NONE'
            domains_stack_size = 5000000
            stack_size =0
      </namelist>
      <namelist name="xgrid_nml">
        make_exchange_reproduce = .true.
        interp_method = 'second_order'
      </namelist>

      <!--AWG Input datasets -->
      <!-- Namelist -->
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_common.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_c192.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_2000climo.nml"/>

      <xi:include xpointer="xpointer(//experiment[@name='common_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c192_coupled_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>

      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data']/input/node())"/>
    </input>

    <runtime>
      <production simTime="$(EXP_CLIMO_LEN)" units="years" npes="7040" runTime="12:00:00">
        <segment simTime="12" units="months" runTime="12:00:00"/>
      </production>
      <regression name="basic">
        <run days="10" npes="1728" runTimePerJob="01:20:00"/><!--npes= 1728  main_loop= 1788.911409  ATM= 1633.894547  OCN= 1701.778858  SYPD= 1.32322-->
      </regression>

      <regression name="rts"> <!--fits on t1-->
        <run days="5 5" npes="1728" runTimePerJob="01:20:00"/><!--npes= 1728  main_loop= 1788.911409  ATM= 1633.894547  OCN= 1701.778858  SYPD= 1.32322-->
	<run days="10" npes="3456" runTimePerJob="00:30:00"/>
      </regression>

      <regression name="restarts">
        <run days="5 5" npes="1728" runTimePerJob="01:20:00"/>
      </regression>

      <regression name="bigrts">
        <run days="10" npes="3456" runTimePerJob="00:30:00"/><!--npes= 3456  main_loop= 961.055729  ATM= 861.276609  OCN= 930.596231  SYPD= 2.46304-->
        <run days="10" npes="7040" runTimePerJob="00:30:00"/><!--npes= 7040  main_loop= 18846.426343  ATM= 18575.064638  OCN= 15403.657272  SYPD= 4.52162-->
        <run days="10" npes="8576" runTimePerJob="00:30:00"/><!--npes= 8576  main_loop= 479.941982  ATM= 465.252784  OCN= 398.818169  SYPD= 4.9321-->
        <run days="10" npes="8169" runTimePerJob="00:30:00"/><!--npes= 8169  main_loop= 624.676531  ATM= 459.766339  OCN= 592.720540  SYPD= 3.78936-->
        <run days="10" npes="7848" runTimePerJob="00:30:00"/><!--npes= 7848  main_loop= 532.500004  ATM= 529.401630  OCN= 397.083122  SYPD= 4.4453-->
        <run days="10" npes="7008" runTimePerJob="00:30:00"/><!--npes= 7008  main_loop= 555.280044  ATM= 524.772877  OCN= 521.962257  SYPD= 4.26294-->
	<run days="10" npes="6912" runTimePerJob="00:20:00"/>	
      </regression>

      <regression name="timing2">
	<run days="10" npes="1119" runTimePerJob="01:30:00"/>	
	<run days="10" npes="1632" runTimePerJob="01:30:00"/>	
      </regression>

      <reference restart="$(REFERENCE)/archive/1x0m10d_1728pe/restart/00010111.tar"/>

    </runtime>

    <postProcess>
      <xi:include xpointer="xpointer(//experiment[@name='c192_climo_postprocess']/postProcess/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='OM4_postprocess']/postProcess/node())"/>
    </postProcess>

  </experiment>


<!--================================-->
<!--= OCEAN-ICE DATA (0.25 degree) =-->
<!--================================-->
  <experiment name="OM4_data">
    <input>
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/MOM_input
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/layer_coord.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/seawifs_1998-2006_smoothed_2X.v20140616.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/tidal_amplitude.v20140616.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/MOM_channels_global_025
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/vgrid_75_2m.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/WOA05_pottemp_salt.nc 
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/mask_table.808.45x72
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/mask_table.1053.90x45
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/mask_table.1809.90x72
     </dataFile>
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/mask_table.1309.90x54     
     </dataFile>
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/mask_table.96.32x18     
     </dataFile>
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/mask_table.242.32x36     
     </dataFile>
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/mask_table.274.36x36     
     </dataFile>
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/mask_table.548.32x72     
     </dataFile>
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/mask_table.33.16x18     
     </dataFile>
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/mask_table.315.32x45    
     </dataFile>
     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/diag_table.MOM6</dataSource>
        <dataSource site="nescc">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/diag_table.MOM6</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/examples/ocean_SIS/OM4_025/diag_table.MOM6</dataSource>
     </dataFile>

     <namelist name="MOM_input_nml" >
         output_directory = './',
         input_filename = '$restart_flag'
         restart_input_dir = 'INPUT/',
         restart_output_dir = 'RESTART/',
         parameter_filename = 'INPUT/MOM_input','INPUT/MOM_layout','INPUT/MOM_override'
     </namelist>
      <namelist name="ice_albedo_nml">
            t_range = 10.
      </namelist>
      <namelist name="monin_obukhov_nml">
	stable_option = 2,
        rich_crit = 1.0,
        zeta_trans = 0.5
      </namelist>
 
     </input>

  </experiment>


<!--================================-->
<!--= OCEAN-ICE DATA (1 degree) =-->
<!--================================-->
  <experiment name="OM4_data_1deg">
    <input>
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/MOM_input
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/INPUT/seawifs_1998-2006_GOLD_smoothed_2X.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/INPUT/tideamp.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        $(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/INPUT/temp_restore.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        $(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/INPUT/salt_restore.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        $(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/INPUT/Vertical_coordinate.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/INPUT/WOA05_pottemp_salt.nc 
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        $(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/INPUT/sst_ice_clim.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        $(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/INPUT/OM3_zgrid.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        $(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/INPUT/cfc.bc.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        $(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/INPUT/gustiness_qscat.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        $(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/INPUT/sgs_h2.nc
     </dataFile>      
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        $(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/INPUT/geothermal_heating_cm2g.nc
     </dataFile>
     <!--  Was present in the ESM2G XML ... is it necessary?  Does not appear that we are using Max's Scheme  
     <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        $(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/INPUT/Lee_wave_TKE.nc
     </dataFile>
     -->      
     <!-- CM2G63L diagtable includes diagnostics for all components; we need a slim-downed list
     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_SRC)/examples/coupled_AM2_SIS/CM2G63L/diag_table</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/examples/coupled_AM2_SIS/CM2G63L/diag_table</dataSource>
     </dataFile> 
     -->
     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/diag_table.MOM6</dataSource>
        <dataSource site="nescc">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/diag_table.MOM6</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/examples/ocean_SIS/OM4_025/diag_table.MOM6</dataSource>
     </dataFile>

     <!--Diag Table Additions to Match ESM2G-->
     <diagTable>
"ocean_month_snap",     1,  "months", 1, "days", "time",
"ocean_annual_z",       1,  "years", 1, "days", "time",

"ocean_model","h","h","ocean_month_snap","all",.false.,"none",2
"ocean_model","e","e","ocean_month_snap","all",.false.,"none",2
"ocean_model", "temp_int","temp_int","ocean_month_snap","all",.false.,"none",2
"ocean_model", "salt_int","salt_int","ocean_month_snap","all",.false.,"none",2
"ocean_model", "col_mass","col_mass","ocean_month_snap","all",.false.,"none",2
"ocean_model", "mass_wt","mass_wt","ocean_month_snap","all",.false.,"none",2
"ocean_model", "col_height","col_height","ocean_month_snap","all",.false.,"none",2

"ocean_model","temp_z","temp","ocean_annual_z","all",.true.,"none",2
"ocean_model","salt_z","salt","ocean_annual_z","all",.true.,"none",2
"ocean_model","age_z","age","ocean_annual_z","all",.true.,"none",2
"ocean_model","uh_z" ,"uh" ,"ocean_annual_z","all",.true.,"none",2
"ocean_model","vh_z" ,"vh" ,"ocean_annual_z","all",.true.,"none",2
     </diagTable>

     <namelist name="MOM_input_nml" >
         output_directory = './',
         input_filename = '$restart_flag'
         restart_input_dir = 'INPUT/',
         restart_output_dir = 'RESTART/',
         parameter_filename = 'INPUT/MOM_input','INPUT/MOM_layout','INPUT/MOM_override'
     </namelist>
      <namelist name="ice_albedo_nml">
            t_range = 10.
      </namelist>
      <namelist name="monin_obukhov_nml">
	stable_option = 2,
        rich_crit = 1.0,
        zeta_trans = 0.5
      </namelist>
 
     </input>

  </experiment>


  <experiment name="SIS_data">
    <input>
     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/diag_table.SIS</dataSource>
        <dataSource site="nescc">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/diag_table.SIS</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/examples/ocean_SIS/OM4_025/diag_table.SIS</dataSource>
     </dataFile>

     <dataFile label="input" target="INPUT/ice_model.res.nc" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/.datasets/OM4_025/INPUT/ice_model.res.v20140620.nc
     </dataFile> 

     <namelist name="ice_model_nml">
           layout = $ice_layout
           io_layout = $ice_io_layout
           nsteps_dyn=144
           nsteps_adv=2
           num_part = 6
           wd_turn = 0.0
           spec_ice=.false.
           ice_bulk_salin = 0.0
           alb_sno = 0.85                    ! keep CM2 setting
           alb_ice = 0.65                    ! keep CM2 setting
           t_range_melt = 1.0                ! NOTE: CM2 uses 1.0
           heat_rough_ice = 5.0e-4
           cm2_bugs = .false.
           do_icebergs = .true.
           add_diurnal_sw = .false.
           do_ice_limit=.false.
           max_ice_limit=4.0
           channel_viscosity=0.e5
           h_lo_lim = 1.e-10
      </namelist>
      <namelist name="icebergs_nml">
        really_debug=.FALSE.
        debug=.FALSE.
        verbose=.FALSE.
        verbose_hrs=7200
        use_operator_splitting=.TRUE.
        bergy_bit_erosion_fraction=0.0
        sicn_shift=0.1
        parallel_reprod=.TRUE.
        traj_sample_hrs=0
        add_weight_to_ocean=.false.
      </namelist>

      <namelist name="ocean_albedo_nml">
            ocean_albedo_option = 5
      </namelist>
      <namelist name="ocean_rough_nml">
            rough_scheme = 'beljaars'
      </namelist>
     </input>
  </experiment>

  <experiment name="SIS_data_1deg">
    <input>
     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource site="ncrc">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/diag_table.SIS</dataSource>
        <dataSource site="nescc">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/diag_table.SIS</dataSource>
        <dataSource site="gfdl">$(NB_ROOT)/mom6/examples/ocean_SIS/OM4_025/diag_table.SIS</dataSource>
     </dataFile>

     <!--
     <dataFile label="input" target="INPUT/ice_model.res.nc" chksum="" size="" timestamp="">
       $(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/.datasets/OM4_025/INPUT/ice_model.res.v20140620.nc
     </dataFile> 
     -->
     <namelist name="ice_model_nml">
           layout = $ice_layout
           io_layout = $ice_io_layout
           nsteps_dyn=144
           nsteps_adv=2
           num_part = 6
           wd_turn = 0.0
           spec_ice=.false.
           ice_bulk_salin = 0.0
           alb_sno = 0.85                    ! keep CM2 setting
           alb_ice = 0.65                    ! keep CM2 setting
           t_range_melt = 1.0                ! NOTE: CM2 uses 1.0
           heat_rough_ice = 5.0e-4
           cm2_bugs = .false.
           do_icebergs = .true.
           add_diurnal_sw = .false.
           do_ice_limit=.false.
           max_ice_limit=4.0
           channel_viscosity=0.e5
           h_lo_lim = 1.e-10
      </namelist>
      <namelist name="icebergs_nml">
        really_debug=.FALSE.
        debug=.FALSE.
        verbose=.FALSE.
        verbose_hrs=7200
        use_operator_splitting=.TRUE.
        bergy_bit_erosion_fraction=0.0
        sicn_shift=0.1
        parallel_reprod=.TRUE.
        traj_sample_hrs=0
        add_weight_to_ocean=.false.
      </namelist>

      <namelist name="ocean_albedo_nml">
            ocean_albedo_option = 5
      </namelist>
      <namelist name="ocean_rough_nml">
            rough_scheme = 'beljaars'
      </namelist>
     </input>
  </experiment>

  <!--CORE forcing and salt restore data and data_table-->
  <experiment name="OM4_CORE_data">
    <input>
      <dataFile label="dataTable" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/data_table</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/ncar_precip.clim.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/ncar_rad.clim.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/q_10_mod.clim.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/runoff.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/salt_restore.v20140616.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/slp.clim.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/t_10_mod.clim.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/u_10_mod.clim.nc</dataSource>
      </dataFile>      
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
         <dataSource platform="$(platform)">$(MOM6_SRC)/examples/ocean_SIS/OM4_025/INPUT/v_10_mod.clim.nc</dataSource>
      </dataFile>

     </input>
  </experiment>

<!--=======================-->
<!--= CM4i EXPERIMENTS    =-->
<!--=======================-->

 <experiment name="CM4i_c96L48_am4a1r1_2000climo" inherit="cm4p1_compile">

<!-- MDBI -->
    <description
communityProject="$(ProjectID)" 
communityModel="CM4i_c96L48_am4a1r1_SIS  $(MOM6_GIT_TAG)" 
communityModelID="CM4i_c96L48_am4a1r1_SIS"
communityExperimentName="$(name)">
<!-- /MDBI -->

    </description>
<!-- MDBI -->
    <communityComment>
      Experiment name = $(name)
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_CLIMO_START)"
      endTime="$(EXP_CLIMO_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

    <input>
      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1,1,1,0,0,0,
        calendar = 'NOLEAP'
        dt_atmos = 1200,
        dt_cpld  = 3600,
        use_lag_fluxes = .true.
        concurrent = .true.
        do_ocean = .true.
        ocean_npes = $ocean_npes
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <namelist name="flux_exchange_nml">
            debug_stocks = .FALSE.
            divert_stocks_report = .TRUE.
            do_area_weighted_flux = .FALSE.
      </namelist>
      <namelist name="fms_io_nml">
            fms_netcdf_restart=.true.
            threading_read='multi'
            max_files_r = 200
            max_files_w = 200
      </namelist>
      <namelist name="fms_nml">
            clock_grain='ROUTINE'
            clock_flags='NONE'
            domains_stack_size = 5000000
            stack_size =0
      </namelist>
      <namelist name="xgrid_nml">
        make_exchange_reproduce = .false.
        interp_method = 'second_order'
      </namelist>

      <!--AWG Input datasets -->
      <!-- Namelist -->
      <namelist name="entrain_nml">
        convect_shutoff = .true.,
        apply_entrain = .true.,
        parcel_buoy   = 0.25,
        parcel_option = 2,
        beta_rad      = 0.45,
        Ashear        = 25.0, 
        radperturb    = 0.10, 
        critjump      = 0.10,
      </namelist>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_common.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_c96.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_2000climo.nml"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data_1deg']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_coupled_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>

      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data_1deg']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data_1deg']/input/node())"/>

      <csh type="always"><![CDATA[
####COMMON ALWAYS CSH BEGINS######
# MOM6 restart switch
if ( $ireload == 1 ) then
 if ( $irun == 1 ) then
  set restart_flag = 'n'
 else
  set restart_flag = 'r'
 endif
else
  set restart_flag = 'r'
endif

# adjustment of dry mass first time only
set adjust_dry_mass = ".true."
if (-e $work/INPUT/coupler.res) then
   set t1 = (`grep "Model start time"   $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   set t2 = (`grep "Current model time" $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   foreach i (1 2 3 4 5 6)
      if ( $t1[$i] != $t2[$i] ) then
         set adjust_dry_mass = ".false."
         break   
      endif      
   end
endif

cat > $work/INPUT/MOM_override << OVERRIDE_EOF
#override RESTORE_SALINITY = False
#override ADJUST_NET_FRESH_WATER_TO_ZERO = False
#override ENERGYSAVEDAYS = 73.0
#override USE_OCMIP2_CFC = False

OVERRIDE_EOF

####COMMON ALWAYS CSH ENDS######

      ]]></csh>


    </input>

    <runtime>
      <production simTime="$(EXP_CLIMO_LEN)" units="years" npes="900" runTime="12:00:00">
        <segment simTime="12" units="months" runTime="03:00:00"/>
      </production>
      <regression name="basic">
        <run days="10" npes="900" runTimePerJob="01:20:00"/><!---->
      </regression>

      <regression name="rts"> 
        <run days="5 5" npes="900" runTimePerJob="01:20:00"/><!---->
      </regression>

      <regression name="restarts">
        <run days="5 5" npes="900" runTimePerJob="01:20:00"/><!---->
      </regression>

      <reference restart="$(REFERENCE)/archive/1x0m10d_900pe/restart/00010111.tar"/>

    </runtime>

    <postProcess>
      <xi:include xpointer="xpointer(//experiment[@name='c96_climo_postprocess']/postProcess/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='OM4_postprocess']/postProcess/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='OM4i_postprocess']/postProcess/node())"/>
    </postProcess>

  </experiment>


<experiment name="CM4i_c96L48_am4a2r1_2000climo" inherit="CM4i_c96L48_am4a1r1_2000climo">
   <input> 
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_c96.nml"/>
   </input> 
</experiment>

<experiment name="CM4i_c96L48_am4a2r1_drag_min_mom_2000climo" inherit="CM4i_c96L48_am4a2r1_2000climo">
   <input>
     <namelist name="monin_obukhov_nml">
        stable_option = 2,
        rich_crit = 1.0,
        zeta_trans = 0.5,
        drag_min_mom = 1.e-03
     </namelist>
      <xi:include xpointer="xpointer(//experiment[@name='common_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data_1deg']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_coupled_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>

      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data_1deg']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data_1deg']/input/node())"/>

      <csh type="always"><![CDATA[
####COMMON ALWAYS CSH BEGINS######
# MOM6 restart switch
if ( $ireload == 1 ) then
 if ( $irun == 1 ) then
  set restart_flag = 'n'
 else
  set restart_flag = 'r'
 endif
else
  set restart_flag = 'r'
endif

# adjustment of dry mass first time only
set adjust_dry_mass = ".true."
if (-e $work/INPUT/coupler.res) then
   set t1 = (`grep "Model start time"   $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   set t2 = (`grep "Current model time" $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   foreach i (1 2 3 4 5 6)
      if ( $t1[$i] != $t2[$i] ) then
         set adjust_dry_mass = ".false."
         break   
      endif      
   end
endif

cat >> $work/INPUT/MOM_override << OVERRIDE_EOF
#override RESTORE_SALINITY = False
#override ADJUST_NET_FRESH_WATER_TO_ZERO = False
#override ENERGYSAVEDAYS = 73.0
#override USE_OCMIP2_CFC = False

OVERRIDE_EOF

####COMMON ALWAYS CSH ENDS######

      ]]></csh>


     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
       <dataSource platform="$(platform)">cwg_include/diag_table/diag_table_drag</dataSource>
     </dataFile>
   </input> 
</experiment>

<experiment name="CM4i_c96L48_am4a2r1_coast_rough_2000climo" inherit="CM4i_c96L48_am4a2r1_2000climo">
   <input>
     <namelist name="land_model_nml">
        layout   = $land_layout,
        io_layout = $land_io_layout,
        tau_snow_T_adj = 604800,
        prohibit_negative_canopy_water=.false.,
        use_coast_rough = .true.,
        use_coast_topo_rough = .false.
      </namelist>
      <xi:include xpointer="xpointer(//experiment[@name='common_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data_1deg']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_coupled_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>

      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data_1deg']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data_1deg']/input/node())"/>

      <csh type="always"><![CDATA[
####COMMON ALWAYS CSH BEGINS######
# MOM6 restart switch
if ( $ireload == 1 ) then
 if ( $irun == 1 ) then
  set restart_flag = 'n'
 else
  set restart_flag = 'r'
 endif
else
  set restart_flag = 'r'
endif

# adjustment of dry mass first time only
set adjust_dry_mass = ".true."
if (-e $work/INPUT/coupler.res) then
   set t1 = (`grep "Model start time"   $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   set t2 = (`grep "Current model time" $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   foreach i (1 2 3 4 5 6)
      if ( $t1[$i] != $t2[$i] ) then
         set adjust_dry_mass = ".false."
         break   
      endif      
   end
endif

cat >> $work/INPUT/MOM_override << OVERRIDE_EOF
#override RESTORE_SALINITY = False
#override ADJUST_NET_FRESH_WATER_TO_ZERO = False
#override ENERGYSAVEDAYS = 73.0
#override USE_OCMIP2_CFC = False

OVERRIDE_EOF

####COMMON ALWAYS CSH ENDS######

      ]]></csh>


     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
       <dataSource platform="$(platform)">cwg_include/diag_table/diag_table_drag</dataSource>
     </dataFile>
   </input> 
</experiment>

<experiment name="CM4i_c96L48_am4a2r1_drag_min_mom_coast_rough_2000climo" inherit="CM4i_c96L48_am4a2r1_2000climo">
   <input> 
     <namelist name="monin_obukhov_nml">
        stable_option = 2,
        rich_crit = 1.0,
        zeta_trans = 0.5,
        drag_min_mom = 1.e-03
     </namelist> 
     <namelist name="land_model_nml">
        layout   = $land_layout,
        io_layout = $land_io_layout,
        tau_snow_T_adj = 604800,
        prohibit_negative_canopy_water=.false.,
        use_coast_rough = .true.,
        use_coast_topo_rough = .false.
      </namelist>
      <xi:include xpointer="xpointer(//experiment[@name='common_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data_1deg']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_coupled_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>

      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data_1deg']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data_1deg']/input/node())"/>

      <csh type="always"><![CDATA[
####COMMON ALWAYS CSH BEGINS######
# MOM6 restart switch
if ( $ireload == 1 ) then
 if ( $irun == 1 ) then
  set restart_flag = 'n'
 else
  set restart_flag = 'r'
 endif
else
  set restart_flag = 'r'
endif

# adjustment of dry mass first time only
set adjust_dry_mass = ".true."
if (-e $work/INPUT/coupler.res) then
   set t1 = (`grep "Model start time"   $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   set t2 = (`grep "Current model time" $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   foreach i (1 2 3 4 5 6)
      if ( $t1[$i] != $t2[$i] ) then
         set adjust_dry_mass = ".false."
         break   
      endif      
   end
endif

cat >> $work/INPUT/MOM_override << OVERRIDE_EOF
#override RESTORE_SALINITY = False
#override ADJUST_NET_FRESH_WATER_TO_ZERO = False
#override ENERGYSAVEDAYS = 73.0
#override USE_OCMIP2_CFC = False

OVERRIDE_EOF

####COMMON ALWAYS CSH ENDS######

      ]]></csh>


     <dataFile label="diagTable" target="INPUT/" chksum="" size="" timestamp="">
       <dataSource platform="$(platform)">cwg_include/diag_table/diag_table_drag</dataSource>
     </dataFile>
   </input> 
</experiment>

<experiment name="CM4i_c96L48_am4a2r1_1860forc" inherit="CM4i_c96L48_am4a1r1_1860forc">
   <input> 
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a2r1_c96.nml"/>
   </input> 
</experiment>

 <experiment name="CM4i_c96L48_am4a1r1_1860forc" inherit="cm4p1_compile">

<!-- MDBI -->
    <description
communityProject="$(ProjectID)" 
communityModel="CM4i_c96L48_am4a1r1_SIS  $(MOM6_GIT_TAG)" 
communityModelID="CM4i_c96L48_am4a1r1_SIS"
communityExperimentName="$(name)">
<!-- /MDBI -->

This configuration is for a CM4i preindustrial simulation.  It uses the 
C96 48 Level Atmosphere (am4a1), LM3. SIS1, and a 1-degree MOM6 ocean 
configured in isopyncal mode.  This experiment inherits most of the 
settings used in the CM4i_c192L48_am4a1r1_2000climo experiment.  The 
changes include:

Atmosphere:
 - Background volcanic forcing
     * Time-mean (1860-2005) volcanic aerosol property files
 - Changed values to 1860 in the following namelists:
     * carbon_aerosol_nml
     * ozone_nml
     * radiation_driver_nml
     * radiative_gases_nml
     * simple_sulfate_nml
 - New ozone climatology file using CM3-predicted ozone
 - Updated solar constant
     * Time mean from 1856 to 1866
     * Value is 1360.8658 W m-2

Land:
 - Switched from static to potential vegetation on land
     * Updated land initial conditions from Sergey Malyshev
     * Updated static_veg_nml and vegn_nml
 - CO2 tracer for atmosphere and land (not used for radiation)
     * Allows vegetation to feel diurnal cycle of CO2
     * Added dataTable entry for tracer restoring value
     * Added atmos_co2_nml 

Ocean:
 - Turned off ocean CFC tracers

    </description>
<!-- MDBI -->
    <communityComment>
      Experiment name = $(name)
    </communityComment>
    <scenario 
      communityForcing="N/A"
      startTime="$(EXP_CLIMO_START)"
      endTime="$(EXP_CLIMO_END)" 
      parentExperimentID="N/A" 
      parentExperimentRIP="N/A" 
      branch_time="0.0">
    </scenario>
<!-- /MDBI -->

    <input>

      <dataTable>
# restoring co2 and radiation co2 data overrides set to 286e-6 
"ATM" , "co2_dvmr_restore", "",     "", .false.,  286.0e-06
      </dataTable>

      <namelist name="coupler_nml">
        months = $months,
        days   = $days,
        current_date = 1,1,1,0,0,0,
        calendar = 'NOLEAP'
        dt_atmos = 1200,
        dt_cpld  = 3600,
        use_lag_fluxes = .true.
        concurrent = .true.
        do_ocean = .true.
        ocean_npes = $ocean_npes
        atmos_npes = $atmos_npes
        atmos_nthreads = $atmos_nthreads
      </namelist>
      <namelist name="flux_exchange_nml">
            debug_stocks = .FALSE.
            divert_stocks_report = .TRUE.
            do_area_weighted_flux = .FALSE.
      </namelist>
      <namelist name="fms_io_nml">
            fms_netcdf_restart=.true.
            threading_read='multi'
            max_files_r = 200
            max_files_w = 200
      </namelist>
      <namelist name="fms_nml">
            clock_grain='ROUTINE'
            clock_flags='NONE'
            domains_stack_size = 5000000
            stack_size =0
      </namelist>
      <namelist name="xgrid_nml">
        make_exchange_reproduce = .false.
        interp_method = 'second_order'
      </namelist>

      <!--AWG Input datasets -->
      <!-- Namelist -->
      <namelist name="entrain_nml">
        convect_shutoff = .true.,
        apply_entrain = .true.,
        parcel_buoy   = 0.25,
        parcel_option = 2,
        beta_rad      = 0.45,
        Ashear        = 25.0, 
        radperturb    = 0.10, 
        critjump      = 0.10,
      </namelist>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_common.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_physics.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4a1r1_c96.nml"/>
      <namelist file="$(AWG_INPUT_HOME)/nml/am4p1_2000climo.nml"/>

      <namelist name="aerosolrad_package_nml">
    force_to_repro_quebec = .true.
    using_im_bcsul = .true.
    volcanic_dataset_entry = 1,1,1,0,0,
    using_volcanic_lw_files = .true.,
    lw_ext_filename = "extlw_data.nc"
    lw_ext_root = "extlw"
    lw_asy_filename = "             "
    lw_asy_root = "     "
    lw_ssa_filename = "             "
    lw_ssa_root = "     "
    using_volcanic_sw_files = .true.,
    sw_ext_filename = "extsw_data.nc"
    sw_ext_root = "extsw"
    sw_ssa_filename = "omgsw_data.nc"
    sw_ssa_root = "omgsw"
    sw_asy_filename = "asmsw_data.nc"
    sw_asy_root = "asmsw"
    do_lwaerosol = .true.,
    do_swaerosol = .true.,
    aerosol_data_set = "Ginoux_Reddy"
    optical_filename = "Ginoux_Reddy_2013",
    sulfate_indices = 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,35,35,35,35,35,40,40,40,40,40,45,45,45,45,45,
                      50,50,50,50,50,55,55,55,55,55,60,60,60,60,60,65,
                      65,65,65,65,70,70,70,70,70,75,75,75,75,75,80,80,
                      80,80,82,82,84,84,86,86,88,88,90,91,92,93,94,95,
                      96,97,97,97,97, 
    omphilic_indices = 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,35,35,35,35,35,40,40,40,40,40,45,45,45,45,45,
                      50,50,50,50,50,55,55,55,55,55,60,60,60,60,60,65,
                      65,65,65,65,70,70,70,70,70,75,75,75,75,75,80,80,
                      80,80,82,82,84,84,86,86,88,88,90,91,92,93,94,95,
                      96,97,97,97,97, 
    bcphilic_indices = 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,35,35,35,35,35,40,40,40,40,40,45,45,45,45,45,
                      50,50,50,50,50,55,55,55,55,55,60,60,60,60,60,65,
                      65,65,65,65,70,70,70,70,70,75,75,75,75,75,80,80,
                      80,80,82,82,84,84,86,86,88,88,90,91,92,93,94,95,
                      96,97,97,97,97, 
    seasalt1_indices = 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,35,35,35,35,35,40,40,40,40,40,45,45,45,45,45,
                      50,50,50,50,50,55,55,55,55,55,60,60,60,60,60,65,
                      65,65,65,65,70,70,70,70,70,75,75,75,75,75,80,80,
                      80,80,82,82,84,84,86,86,88,88,90,91,92,93,94,95,
                      96,97,97,97,97, 
    seasalt2_indices = 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,35,35,35,35,35,40,40,40,40,40,45,45,45,45,45,
                      50,50,50,50,50,55,55,55,55,55,60,60,60,60,60,65,
                      65,65,65,65,70,70,70,70,70,75,75,75,75,75,80,80,
                      80,80,82,82,84,84,86,86,88,88,90,91,92,93,94,95,
                      96,97,97,97,97, 
    seasalt3_indices = 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,35,35,35,35,35,40,40,40,40,40,45,45,45,45,45,
                      50,50,50,50,50,55,55,55,55,55,60,60,60,60,60,65,
                      65,65,65,65,70,70,70,70,70,75,75,75,75,75,80,80,
                      80,80,82,82,84,84,86,86,88,88,90,91,92,93,94,95,
                      96,97,97,97,97, 
    seasalt4_indices = 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,35,35,35,35,35,40,40,40,40,40,45,45,45,45,45,
                      50,50,50,50,50,55,55,55,55,55,60,60,60,60,60,65,
                      65,65,65,65,70,70,70,70,70,75,75,75,75,75,80,80,
                      80,80,82,82,84,84,86,86,88,88,90,91,92,93,94,95,
                      96,97,97,97,97, 
    seasalt5_indices = 30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,
                      30,35,35,35,35,35,40,40,40,40,40,45,45,45,45,45,
                      50,50,50,50,50,55,55,55,55,55,60,60,60,60,60,65,
                      65,65,65,65,70,70,70,70,70,75,75,75,75,75,80,80,
                      80,80,82,82,84,84,86,86,88,88,90,91,92,93,94,95,
                      96,97,97,97,97, 
    aerosol_optical_names = "sulfate_30%_100%","sulfate_35%_100%","sulfate_40%_100%","sulfate_45%_100%","sulfate_50%_100%",
"sulfate_55%_100%","sulfate_60%_100%","sulfate_65%_100%","sulfate_70%_100%","sulfate_75%_100%",
"sulfate_80%_100%","sulfate_82%_100%","sulfate_84%_100%","sulfate_86%_100%","sulfate_88%_100%",
"sulfate_90%_100%","sulfate_91%_100%","sulfate_92%_100%","sulfate_93%_100%","sulfate_94%_100%",
"sulfate_95%_100%","sulfate_96%_100%","sulfate_97%_100%","sulfate_98%_100%","sulfate_99%_100%",
"sulfate_100%_100%","sulfate_30%_98%","sulfate_35%_98%","sulfate_40%_98%","sulfate_45%_98%",
"sulfate_50%_98%","sulfate_55%_98%","sulfate_60%_98%","sulfate_65%_98%","sulfate_70%_98%",
"sulfate_75%_98%","sulfate_80%_98%","sulfate_82%_98%","sulfate_84%_98%","sulfate_86%_98%",
"sulfate_88%_98%","sulfate_90%_98%","sulfate_91%_98%","sulfate_92%_98%","sulfate_93%_98%",
"sulfate_94%_98%","sulfate_95%_98%","sulfate_96%_98%","sulfate_97%_98%","sulfate_98%_98%",
"sulfate_99%_98%","sulfate_100%_98%","sulfate_30%_96%","sulfate_35%_96%","sulfate_40%_96%",
"sulfate_45%_96%","sulfate_50%_96%","sulfate_55%_96%","sulfate_60%_96%","sulfate_65%_96%",
"sulfate_70%_96%","sulfate_75%_96%","sulfate_80%_96%","sulfate_82%_96%","sulfate_84%_96%",
"sulfate_86%_96%","sulfate_88%_96%","sulfate_90%_96%","sulfate_91%_96%","sulfate_92%_96%",
"sulfate_93%_96%","sulfate_94%_96%","sulfate_95%_96%","sulfate_96%_96%","sulfate_97%_96%",
"sulfate_98%_96%","sulfate_99%_96%","sulfate_100%_96%","sulfate_30%_94%","sulfate_35%_94%",
"sulfate_40%_94%","sulfate_45%_94%","sulfate_50%_94%","sulfate_55%_94%","sulfate_60%_94%",
"sulfate_65%_94%","sulfate_70%_94%","sulfate_75%_94%","sulfate_80%_94%","sulfate_82%_94%",
"sulfate_84%_94%","sulfate_86%_94%","sulfate_88%_94%","sulfate_90%_94%","sulfate_91%_94%",
"sulfate_92%_94%","sulfate_93%_94%","sulfate_94%_94%","sulfate_95%_94%","sulfate_96%_94%",
"sulfate_97%_94%","sulfate_98%_94%","sulfate_99%_94%","sulfate_100%_94%","sulfate_30%_92%",
"sulfate_35%_92%","sulfate_40%_92%","sulfate_45%_92%","sulfate_50%_92%","sulfate_55%_92%",
"sulfate_60%_92%","sulfate_65%_92%","sulfate_70%_92%","sulfate_75%_92%","sulfate_80%_92%",
"sulfate_82%_92%","sulfate_84%_92%","sulfate_86%_92%","sulfate_88%_92%","sulfate_90%_92%",
"sulfate_91%_92%","sulfate_92%_92%","sulfate_93%_92%","sulfate_94%_92%","sulfate_95%_92%",
"sulfate_96%_92%","sulfate_97%_92%","sulfate_98%_92%","sulfate_99%_92%","sulfate_100%_92%",
"sulfate_30%_90%","sulfate_35%_90%","sulfate_40%_90%","sulfate_45%_90%","sulfate_50%_90%",
"sulfate_55%_90%","sulfate_60%_90%","sulfate_65%_90%","sulfate_70%_90%","sulfate_75%_90%",
"sulfate_80%_90%","sulfate_82%_90%","sulfate_84%_90%","sulfate_86%_90%","sulfate_88%_90%",
"sulfate_90%_90%","sulfate_91%_90%","sulfate_92%_90%","sulfate_93%_90%","sulfate_94%_90%",
"sulfate_95%_90%","sulfate_96%_90%","sulfate_97%_90%","sulfate_98%_90%","sulfate_99%_90%",
"sulfate_100%_90%","sulfate_30%_88%","sulfate_35%_88%","sulfate_40%_88%","sulfate_45%_88%",
"sulfate_50%_88%","sulfate_55%_88%","sulfate_60%_88%","sulfate_65%_88%","sulfate_70%_88%",
"sulfate_75%_88%","sulfate_80%_88%","sulfate_82%_88%","sulfate_84%_88%","sulfate_86%_88%",
"sulfate_88%_88%","sulfate_90%_88%","sulfate_91%_88%","sulfate_92%_88%","sulfate_93%_88%",
"sulfate_94%_88%","sulfate_95%_88%","sulfate_96%_88%","sulfate_97%_88%","sulfate_98%_88%",
"sulfate_99%_88%","sulfate_100%_88%","sulfate_30%_86%","sulfate_35%_86%","sulfate_40%_86%",
"sulfate_45%_86%","sulfate_50%_86%","sulfate_55%_86%","sulfate_60%_86%","sulfate_65%_86%",
"sulfate_70%_86%","sulfate_75%_86%","sulfate_80%_86%","sulfate_82%_86%","sulfate_84%_86%",
"sulfate_86%_86%","sulfate_88%_86%","sulfate_90%_86%","sulfate_91%_86%","sulfate_92%_86%",
"sulfate_93%_86%","sulfate_94%_86%","sulfate_95%_86%","sulfate_96%_86%","sulfate_97%_86%",
"sulfate_98%_86%","sulfate_99%_86%","sulfate_100%_86%","sulfate_30%_84%","sulfate_35%_84%",
"sulfate_40%_84%","sulfate_45%_84%","sulfate_50%_84%","sulfate_55%_84%","sulfate_60%_84%",
"sulfate_65%_84%","sulfate_70%_84%","sulfate_75%_84%","sulfate_80%_84%","sulfate_82%_84%",
"sulfate_84%_84%","sulfate_86%_84%","sulfate_88%_84%","sulfate_90%_84%","sulfate_91%_84%",
"sulfate_92%_84%","sulfate_93%_84%","sulfate_94%_84%","sulfate_95%_84%","sulfate_96%_84%",
"sulfate_97%_84%","sulfate_98%_84%","sulfate_99%_84%","sulfate_100%_84%","sulfate_30%_82%",
"sulfate_35%_82%","sulfate_40%_82%","sulfate_45%_82%","sulfate_50%_82%","sulfate_55%_82%",
"sulfate_60%_82%","sulfate_65%_82%","sulfate_70%_82%","sulfate_75%_82%","sulfate_80%_82%",
"sulfate_82%_82%","sulfate_84%_82%","sulfate_86%_82%","sulfate_88%_82%","sulfate_90%_82%",
"sulfate_91%_82%","sulfate_92%_82%","sulfate_93%_82%","sulfate_94%_82%","sulfate_95%_82%",
"sulfate_96%_82%","sulfate_97%_82%","sulfate_98%_82%","sulfate_99%_82%","sulfate_100%_82%",
"sulfate_30%_80%","sulfate_35%_80%","sulfate_40%_80%","sulfate_45%_80%","sulfate_50%_80%",
"sulfate_55%_80%","sulfate_60%_80%","sulfate_65%_80%","sulfate_70%_80%","sulfate_75%_80%",
"sulfate_80%_80%","sulfate_82%_80%","sulfate_84%_80%","sulfate_86%_80%","sulfate_88%_80%",
"sulfate_90%_80%","sulfate_91%_80%","sulfate_92%_80%","sulfate_93%_80%","sulfate_94%_80%",
"sulfate_95%_80%","sulfate_96%_80%","sulfate_97%_80%","sulfate_98%_80%","sulfate_99%_80%",
"sulfate_100%_80%","sulfate_30%_75%","sulfate_35%_75%","sulfate_40%_75%","sulfate_45%_75%",
"sulfate_50%_75%","sulfate_55%_75%","sulfate_60%_75%","sulfate_65%_75%","sulfate_70%_75%",
"sulfate_75%_75%","sulfate_80%_75%","sulfate_82%_75%","sulfate_84%_75%","sulfate_86%_75%",
"sulfate_88%_75%","sulfate_90%_75%","sulfate_91%_75%","sulfate_92%_75%","sulfate_93%_75%",
"sulfate_94%_75%","sulfate_95%_75%","sulfate_96%_75%","sulfate_97%_75%","sulfate_98%_75%",
"sulfate_99%_75%","sulfate_100%_75%","sulfate_30%_70%","sulfate_35%_70%","sulfate_40%_70%",
"sulfate_45%_70%","sulfate_50%_70%","sulfate_55%_70%","sulfate_60%_70%","sulfate_65%_70%",
"sulfate_70%_70%","sulfate_75%_70%","sulfate_80%_70%","sulfate_82%_70%","sulfate_84%_70%",
"sulfate_86%_70%","sulfate_88%_70%","sulfate_90%_70%","sulfate_91%_70%","sulfate_92%_70%",
"sulfate_93%_70%","sulfate_94%_70%","sulfate_95%_70%","sulfate_96%_70%","sulfate_97%_70%",
"sulfate_98%_70%","sulfate_99%_70%","sulfate_100%_70%","sulfate_30%_65%","sulfate_35%_65%",
"sulfate_40%_65%","sulfate_45%_65%","sulfate_50%_65%","sulfate_55%_65%","sulfate_60%_65%",
"sulfate_65%_65%","sulfate_70%_65%","sulfate_75%_65%","sulfate_80%_65%","sulfate_82%_65%",
"sulfate_84%_65%","sulfate_86%_65%","sulfate_88%_65%","sulfate_90%_65%","sulfate_91%_65%",
"sulfate_92%_65%","sulfate_93%_65%","sulfate_94%_65%","sulfate_95%_65%","sulfate_96%_65%",
"sulfate_97%_65%","sulfate_98%_65%","sulfate_99%_65%","sulfate_100%_65%","sulfate_30%_60%",
"sulfate_35%_60%","sulfate_40%_60%","sulfate_45%_60%","sulfate_50%_60%","sulfate_55%_60%",
"sulfate_60%_60%","sulfate_65%_60%","sulfate_70%_60%","sulfate_75%_60%","sulfate_80%_60%",
"sulfate_82%_60%","sulfate_84%_60%","sulfate_86%_60%","sulfate_88%_60%","sulfate_90%_60%",
"sulfate_91%_60%","sulfate_92%_60%","sulfate_93%_60%","sulfate_94%_60%","sulfate_95%_60%",
"sulfate_96%_60%","sulfate_97%_60%","sulfate_98%_60%","sulfate_99%_60%","sulfate_100%_60%",
"sulfate_30%_55%","sulfate_35%_55%","sulfate_40%_55%","sulfate_45%_55%","sulfate_50%_55%",
"sulfate_55%_55%","sulfate_60%_55%","sulfate_65%_55%","sulfate_70%_55%","sulfate_75%_55%",
"sulfate_80%_55%","sulfate_82%_55%","sulfate_84%_55%","sulfate_86%_55%","sulfate_88%_55%",
"sulfate_90%_55%","sulfate_91%_55%","sulfate_92%_55%","sulfate_93%_55%","sulfate_94%_55%",
"sulfate_95%_55%","sulfate_96%_55%","sulfate_97%_55%","sulfate_98%_55%","sulfate_99%_55%",
"sulfate_100%_55%","sulfate_30%_50%","sulfate_35%_50%","sulfate_40%_50%","sulfate_45%_50%",
"sulfate_50%_50%","sulfate_55%_50%","sulfate_60%_50%","sulfate_65%_50%","sulfate_70%_50%",
"sulfate_75%_50%","sulfate_80%_50%","sulfate_82%_50%","sulfate_84%_50%","sulfate_86%_50%",
"sulfate_88%_50%","sulfate_90%_50%","sulfate_91%_50%","sulfate_92%_50%","sulfate_93%_50%",
"sulfate_94%_50%","sulfate_95%_50%","sulfate_96%_50%","sulfate_97%_50%","sulfate_98%_50%",
"sulfate_99%_50%","sulfate_100%_50%","sulfate_30%_45%","sulfate_35%_45%","sulfate_40%_45%",
"sulfate_45%_45%","sulfate_50%_45%","sulfate_55%_45%","sulfate_60%_45%","sulfate_65%_45%",
"sulfate_70%_45%","sulfate_75%_45%","sulfate_80%_45%","sulfate_82%_45%","sulfate_84%_45%",
"sulfate_86%_45%","sulfate_88%_45%","sulfate_90%_45%","sulfate_91%_45%","sulfate_92%_45%",
"sulfate_93%_45%","sulfate_94%_45%","sulfate_95%_45%","sulfate_96%_45%","sulfate_97%_45%",
"sulfate_98%_45%","sulfate_99%_45%","sulfate_100%_45%","sulfate_30%_40%","sulfate_35%_40%",
"sulfate_40%_40%","sulfate_45%_40%","sulfate_50%_40%","sulfate_55%_40%","sulfate_60%_40%",
"sulfate_65%_40%","sulfate_70%_40%","sulfate_75%_40%","sulfate_80%_40%","sulfate_82%_40%",
"sulfate_84%_40%","sulfate_86%_40%","sulfate_88%_40%","sulfate_90%_40%","sulfate_91%_40%",
"sulfate_92%_40%","sulfate_93%_40%","sulfate_94%_40%","sulfate_95%_40%","sulfate_96%_40%",
"sulfate_97%_40%","sulfate_98%_40%","sulfate_99%_40%","sulfate_100%_40%","sulfate_30%_35%",
"sulfate_35%_35%","sulfate_40%_35%","sulfate_45%_35%","sulfate_50%_35%","sulfate_55%_35%",
"sulfate_60%_35%","sulfate_65%_35%","sulfate_70%_35%","sulfate_75%_35%","sulfate_80%_35%",
"sulfate_82%_35%","sulfate_84%_35%","sulfate_86%_35%","sulfate_88%_35%","sulfate_90%_35%",
"sulfate_91%_35%","sulfate_92%_35%","sulfate_93%_35%","sulfate_94%_35%","sulfate_95%_35%",
"sulfate_96%_35%","sulfate_97%_35%","sulfate_98%_35%","sulfate_99%_35%","sulfate_100%_35%",
"sulfate_30%_30%","sulfate_35%_30%","sulfate_40%_30%","sulfate_45%_30%","sulfate_50%_30%",
"sulfate_55%_30%","sulfate_60%_30%","sulfate_65%_30%","sulfate_70%_30%","sulfate_75%_30%",
"sulfate_80%_30%","sulfate_82%_30%","sulfate_84%_30%","sulfate_86%_30%","sulfate_88%_30%",
"sulfate_90%_30%","sulfate_91%_30%","sulfate_92%_30%","sulfate_93%_30%","sulfate_94%_30%",
"sulfate_95%_30%","sulfate_96%_30%","sulfate_97%_30%","sulfate_98%_30%","sulfate_99%_30%",
"sulfate_100%_30%","sulfate_30%_25%","sulfate_35%_25%","sulfate_40%_25%","sulfate_45%_25%",
"sulfate_50%_25%","sulfate_55%_25%","sulfate_60%_25%","sulfate_65%_25%","sulfate_70%_25%",
"sulfate_75%_25%","sulfate_80%_25%","sulfate_82%_25%","sulfate_84%_25%","sulfate_86%_25%",
"sulfate_88%_25%","sulfate_90%_25%","sulfate_91%_25%","sulfate_92%_25%","sulfate_93%_25%",
"sulfate_94%_25%","sulfate_95%_25%","sulfate_96%_25%","sulfate_97%_25%","sulfate_98%_25%",
"sulfate_99%_25%","sulfate_100%_25%","sulfate_30%_20%","sulfate_35%_20%","sulfate_40%_20%",
"sulfate_45%_20%","sulfate_50%_20%","sulfate_55%_20%","sulfate_60%_20%","sulfate_65%_20%",
"sulfate_70%_20%","sulfate_75%_20%","sulfate_80%_20%","sulfate_82%_20%","sulfate_84%_20%",
"sulfate_86%_20%","sulfate_88%_20%","sulfate_90%_20%","sulfate_91%_20%","sulfate_92%_20%",
"sulfate_93%_20%","sulfate_94%_20%","sulfate_95%_20%","sulfate_96%_20%","sulfate_97%_20%",
"sulfate_98%_20%","sulfate_99%_20%","sulfate_100%_20%","sulfate_30%_15%","sulfate_35%_15%",
"sulfate_40%_15%","sulfate_45%_15%","sulfate_50%_15%","sulfate_55%_15%","sulfate_60%_15%",
"sulfate_65%_15%","sulfate_70%_15%","sulfate_75%_15%","sulfate_80%_15%","sulfate_82%_15%",
"sulfate_84%_15%","sulfate_86%_15%","sulfate_88%_15%","sulfate_90%_15%","sulfate_91%_15%",
"sulfate_92%_15%","sulfate_93%_15%","sulfate_94%_15%","sulfate_95%_15%","sulfate_96%_15%",
"sulfate_97%_15%","sulfate_98%_15%","sulfate_99%_15%","sulfate_100%_15%","sulfate_30%_10%",
"sulfate_35%_10%","sulfate_40%_10%","sulfate_45%_10%","sulfate_50%_10%","sulfate_55%_10%",
"sulfate_60%_10%","sulfate_65%_10%","sulfate_70%_10%","sulfate_75%_10%","sulfate_80%_10%",
"sulfate_82%_10%","sulfate_84%_10%","sulfate_86%_10%","sulfate_88%_10%","sulfate_90%_10%",
"sulfate_91%_10%","sulfate_92%_10%","sulfate_93%_10%","sulfate_94%_10%","sulfate_95%_10%",
"sulfate_96%_10%","sulfate_97%_10%","sulfate_98%_10%","sulfate_99%_10%","sulfate_100%_10%",
"sulfate_30%_5%","sulfate_35%_5%","sulfate_40%_5%","sulfate_45%_5%","sulfate_50%_5%",
"sulfate_55%_5%","sulfate_60%_5%","sulfate_65%_5%","sulfate_70%_5%","sulfate_75%_5%",
"sulfate_80%_5%","sulfate_82%_5%","sulfate_84%_5%","sulfate_86%_5%","sulfate_88%_5%",
"sulfate_90%_5%","sulfate_91%_5%","sulfate_92%_5%","sulfate_93%_5%","sulfate_94%_5%",
"sulfate_95%_5%","sulfate_96%_5%","sulfate_97%_5%","sulfate_98%_5%","sulfate_99%_5%",
"sulfate_100%_5%","sulfate_30%_0%","sulfate_35%_0%","sulfate_40%_0%","sulfate_45%_0%",
"sulfate_50%_0%","sulfate_55%_0%","sulfate_60%_0%","sulfate_65%_0%","sulfate_70%_0%",
"sulfate_75%_0%","sulfate_80%_0%","sulfate_82%_0%","sulfate_84%_0%","sulfate_86%_0%",
"sulfate_88%_0%","sulfate_90%_0%","sulfate_91%_0%","sulfate_92%_0%","sulfate_93%_0%",
"sulfate_94%_0%","sulfate_95%_0%","sulfate_96%_0%","sulfate_97%_0%","sulfate_98%_0%",
"sulfate_99%_0%","sulfate_100%_0%",
                            "organic_carbon","soot",
                            "sea_salt",    "dust_0.1",    "dust_0.2",    "dust_0.4",
                            "dust_0.8",    "dust_1.0",    "dust_2.0",    "dust_4.0",
                            "dust_8.0",
                            "dust1",       "dust2",         "dust3",        "dust4",
                            "dust5",       "bcphobic",      "omphobic",     "bcdry"
                            "omphilic_30%", "omphilic_35%", "omphilic_40%", "omphilic_45%",
                            "omphilic_50%", "omphilic_55%", "omphilic_60%", "omphilic_65%",
                            "omphilic_70%", "omphilic_75%", "omphilic_80%", "omphilic_82%",
                            "omphilic_84%", "omphilic_86%", "omphilic_88%", "omphilic_90%",
                            "omphilic_91%", "omphilic_92%", "omphilic_93%", "omphilic_94%",
                            "omphilic_95%", "omphilic_96%", "omphilic_97%", "omphilic_98%",
                            "omphilic_99%",
                            "seasalt1_30%", "seasalt1_35%", "seasalt1_40%", "seasalt1_45%",
                            "seasalt1_50%", "seasalt1_55%", "seasalt1_60%", "seasalt1_65%",
                            "seasalt1_70%", "seasalt1_75%", "seasalt1_80%", "seasalt1_82%",
                            "seasalt1_84%", "seasalt1_86%", "seasalt1_88%", "seasalt1_90%",
                            "seasalt1_91%", "seasalt1_92%", "seasalt1_93%", "seasalt1_94%",
                            "seasalt1_95%", "seasalt1_96%", "seasalt1_97%", "seasalt1_98%",
                            "seasalt1_99%",
                            "seasalt2_30%", "seasalt2_35%", "seasalt2_40%", "seasalt2_45%",
                            "seasalt2_50%", "seasalt2_55%", "seasalt2_60%", "seasalt2_65%",
                            "seasalt2_70%", "seasalt2_75%", "seasalt2_80%", "seasalt2_82%",
                            "seasalt2_84%", "seasalt2_86%", "seasalt2_88%", "seasalt2_90%",
                            "seasalt2_91%", "seasalt2_92%", "seasalt2_93%", "seasalt2_94%",
                            "seasalt2_95%", "seasalt2_96%", "seasalt2_97%", "seasalt2_98%",
                            "seasalt2_99%",
                            "seasalt3_30%", "seasalt3_35%", "seasalt3_40%", "seasalt3_45%",
                            "seasalt3_50%", "seasalt3_55%", "seasalt3_60%", "seasalt3_65%",
                            "seasalt3_70%", "seasalt3_75%", "seasalt3_80%", "seasalt3_82%",
                            "seasalt3_84%", "seasalt3_86%", "seasalt3_88%", "seasalt3_90%",
                            "seasalt3_91%", "seasalt3_92%", "seasalt3_93%", "seasalt3_94%",
                            "seasalt3_95%", "seasalt3_96%", "seasalt3_97%", "seasalt3_98%",
                            "seasalt3_99%",
                            "seasalt4_30%", "seasalt4_35%", "seasalt4_40%", "seasalt4_45%",
                            "seasalt4_50%", "seasalt4_55%", "seasalt4_60%", "seasalt4_65%",
                            "seasalt4_70%", "seasalt4_75%", "seasalt4_80%", "seasalt4_82%",
                            "seasalt4_84%", "seasalt4_86%", "seasalt4_88%", "seasalt4_90%",
                            "seasalt4_91%", "seasalt4_92%", "seasalt4_93%", "seasalt4_94%",
                            "seasalt4_95%", "seasalt4_96%", "seasalt4_97%", "seasalt4_98%",
                            "seasalt4_99%",
                            "seasalt5_30%", "seasalt5_35%", "seasalt5_40%", "seasalt5_45%",
                            "seasalt5_50%", "seasalt5_55%", "seasalt5_60%", "seasalt5_65%",
                            "seasalt5_70%", "seasalt5_75%", "seasalt5_80%", "seasalt5_82%",
                            "seasalt5_84%", "seasalt5_86%", "seasalt5_88%", "seasalt5_90%",
                            "seasalt5_91%", "seasalt5_92%", "seasalt5_93%", "seasalt5_94%",
                            "seasalt5_95%", "seasalt5_96%", "seasalt5_97%", "seasalt5_98%",
                            "seasalt5_99%"
      </namelist>

      <namelist name="atmos_co2_nml">
        do_co2_restore = .true.               
        restore_tscale = 3.1536e7,
        restore_klimit = 24
        co2_radiation_override = .false.
        do_co2_emissions = .false.
      </namelist>

      <namelist name="carbon_aerosol_nml">
        bcff_source = 'gocart_2007',
          bcff_input_name(1)='anthro',
          bcff_filename='emissions.bc.1x1.1859_2020.nc',
          bcff_time_dependency_type='fixed_year',bcff_dataset_entry=1860,1,1,0,0,
        omff_source = 'gocart_2007',
          omff_input_name(1)='anthro',
          omff_filename='emissions.om.1x1.1859_2020.nc',
          omff_time_dependency_type='fixed_year',omff_dataset_entry=1860,1,1,0,0,
        omsh_source = 'gocart_2007',
          omsh_input_name(1)='ship',
          omsh_filename='emissions.om.1x1.1859_2020.nc',
          omsh_time_dependency_type='fixed_year',omsh_dataset_entry=1860,1,1,0,0,
        bcsh_source = 'gocart_2007',
          bcsh_input_name(1)='ship',
          bcsh_filename='emissions.bc.1x1.1859_2020.nc',
          bcsh_time_dependency_type='fixed_year',bcsh_dataset_entry=1860,1,1,0,0,
        bcav_source = 'do_aircraft'
          bcav_input_name(1)='fuel',
          bcav_filename='emissions.aircraft.aero.1x1.1859_2020.nc',
          bcav_time_dependency_type='fixed_year',bcav_dataset_entry=1860,1,1,0,0,
        bcbb_source = 'AEROCOM',
          bcbb_filename='emissions.bc.1x1.1859_2020.nc',
          bcbb_input_name(1)='bb_l1'
          bcbb_input_name(2)='bb_l2'
          bcbb_input_name(3)='bb_l3'
          bcbb_input_name(4)='bb_l4'
          bcbb_input_name(5)='bb_l5'
          bcbb_input_name(6)='bb_l6'
          bcbb_time_dependency_type='fixed_year',bcbb_dataset_entry=1860,1,1,0,0,
        ombb_source = 'AEROCOM',
          ombb_filename='emissions.om.1x1.1859_2020.nc',
          ombb_input_name(1)='bb_l1'
          ombb_input_name(2)='bb_l2'
          ombb_input_name(3)='bb_l3'
          ombb_input_name(4)='bb_l4'
          ombb_input_name(5)='bb_l5'
          ombb_input_name(6)='bb_l6'
          ombb_time_dependency_type='fixed_year',ombb_dataset_entry=1860,1,1,0,0,
        omna_source = 'gunther',
          omna_filename='oc8_natural_emission.nc'
          omna_input_name='omemisnat'
        omss_source = 'ODowd'
          omss_coef = 0.05
      </namelist>
     
      <namelist name="ozone_nml">  <!-- -Expecting seasonal cycle of CM3 ozone-->
        basic_ozone_type = 'fixed_year' ,
        ozone_dataset_entry = 1860,1,1,0,0,
        data_name = "ozone",
        filename = "o3.climatology.nc"
        do_coupled_stratozone=.false.
      </namelist>

      <namelist name="radiation_driver_nml">
        rad_time_step= 10800,
        time_varying_solar_constant = .false.,
        solar_dataset_entry = 1860,1,1,0,0,
        rad_package = 'sea_esf',
        do_clear_sky_pass=.true.,
        calc_hemi_integrals = .false.,
        renormalize_sw_fluxes=.true.,
        all_step_diagnostics = .true.,
        zenith_spec = 'diurnally_varying',
        using_restart_file = .false.
      </namelist>
      
      <namelist name="radiative_gases_nml">
        verbose = 3
        gas_printout_freq = 240

        time_varying_co2 = .false.,
        co2_variation_type = 'linear',
        co2_dataset_entry = 1860,1,1,0,0,
        co2_specification_type = 'time_series',
        co2_floor = 100.0E-06,
        co2_ceiling = 1600.0E-06,
        co2_data_source = 'input'

        time_varying_ch4 = .false.,
        ch4_variation_type = 'linear'
        ch4_dataset_entry = 1860,1,1,0,0,
        ch4_specification_type = 'time_series'
        ch4_data_source = 'input'

        time_varying_n2o = .false.,
        n2o_variation_type = 'linear'
        n2o_dataset_entry = 1860,1,1,0,0,
        n2o_specification_type = 'time_series'
        n2o_data_source = 'input'

        time_varying_f11 = .false.,
        f11_variation_type = 'linear'
        f11_dataset_entry = 1860,1,1,0,0,
        f11_specification_type = 'time_series'
        f11_data_source = 'input'

        time_varying_f12 = .false.,
        f12_variation_type = 'linear'
        f12_dataset_entry = 1860,1,1,0,0,
        f12_specification_type = 'time_series'
        f12_data_source = 'input'

        time_varying_f113 = .false.,
        f113_variation_type = 'linear'
        f113_dataset_entry = 1860,1,1,0,0,
        f113_specification_type = 'time_series'
        f113_data_source = 'input'

        time_varying_f22 = .false.,
        f22_variation_type = 'linear'
        f22_dataset_entry = 1860,1,1,0,0,
        f22_specification_type = 'time_series'
        f22_data_source = 'input'
      </namelist>

      <namelist name="simple_sulfate_nml">
        gas_conc_filename='gas_conc_3D48L_am3p9.nc'
        gas_conc_time_dependency_type='constant'
        cont_volc_source='do_cont_volc'
        expl_volc_source='do_expl_volc'
          aerocom_emission_filename='so2_0.25_volcanoes.nc'
        aircraft_source='do_aircraft',
          aircraft_filename='emis_fuel_aircraft.1859_2010.nc',
          aircraft_emission_name(1)='fuel'
          so2_aircraft_EI=0.001
          aircraft_time_dependency_type='fixed_year',aircraft_dataset_entry=1860,1,1,0,0,
        anthro_source='do_anthro',
          anthro_emission_name(1)='so2ff',
          anthro_emission_name(2)='so4ff',
          anthro_filename='anthro_so2.1859_2010.nc',
          anthro_time_dependency_type='fixed_year',anthro_dataset_entry=1860,1,1,0,0,
        biobur_source='do_biobur',
          biobur_emission_name(1)='so2bb',
          biobur_emission_name(2)='so4bb',
          biobur_filename='anthro_so2.1859_2010.nc',
          biobur_time_dependency_type='fixed_year',biobur_dataset_entry=1860,1,1,0,0,
      </namelist>

      <namelist name="static_veg_nml">
        use_static_veg = .false.
        write_static_veg = .false.
        timeline   = 'loop'
        start_loop = 1, 1, 1, 0, 0, 0
        end_loop   = 1, 1, 1, 0, 0, 0
        fill_land_mask = .TRUE.
        input_file = ''
      </namelist>

      <namelist name="vegn_nml">
        init_Tv = 288.0
        rad_to_use = 'two-stream'
        photosynthesis_to_use = 'leuning'
        snow_rad_to_use = 'paint-leaves'
        co2_to_use_for_photosynthesis ='interactive'
        co2_for_photosynthesis = 286.0e-6
      </namelist>

      <!-- Define initial condition here first.  Otherwise, the entry is c96_data_1deg will be read first -->
      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/IC/CM4i_c96L48_am4a1r1_1860forc_00010101_20140818.tar</dataSource>
      </dataFile>

      <xi:include xpointer="xpointer(//experiment[@name='common_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data_1deg']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_coupled_domain_decomp']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>

      <!-- Time Mean Volcanic Aerosol Forcing:  From Larry Horowitz -->
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/volcano/mean_hist/asmsw_data.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/volcano/mean_hist/extlw_data.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/volcano/mean_hist/extsw_data.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/volcano/mean_hist/omgsw_data.nc</dataSource>
      </dataFile>

      <!-- Ozone Climatology File From CM3 -->
      <dataFile label="input" target="INPUT/o3.climatology.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/ozone/CM3_mean_o3_climatology_accmip_1860.nc</dataSource>
      </dataFile>

      <!-- Mean Solar Cycle 1856 to 1866:  From Dan Schwarzkopf and Larry Horowitz -->
      <dataFile label="input" target="INPUT/lean_solar_spectral_data.dat" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/solar/CMIP5_1856_1866avg_monthly_data_b18_TIM</dataSource>
      </dataFile>

      <!-- FRE prepends to the dataTable block.  Since sphum has to the first
           tracer, the cleanest option available at the moment is to use a 
           CSH block to append the CO2 tracer entries to the end of the field table.
           This is not ideal for the long term. -->

      <csh type="always"><![CDATA[
grep "ADDITIONAL 1860 DIAGNOSTICS" $work/diag_table

if ( "$status" == "1") then
cat >> $work/diag_table << DIAGTABLE_EOF
#ADDITIONAL 1860 DIAGNOSTICS
"atmos_level",                 1,  "months", 1, "days", "time",
"atmos_co2",                  "pwt",                "pwt",                "atmos_level", "all", .true.,  "none", 2
"atmos_co2_restoring",        "co2_restore",        "co2_restore",        "atmos_level", "all", .true.,  "none", 2
"dynamics",                   "area",               "area",               "atmos_level", "all", .false., "none", 2
"dynamics",                   "co2",                "co2",                "atmos_level", "all", .true.,  "none", 2
"dynamics",                   "co2_dvmr",           "co2_dvmr",           "atmos_level", "all", .true.,  "none", 2
"flux",                       "co2_atm",            "co2_atm",            "atmos_level", "all", .true.,  "none", 2
"flux",                       "co2_surf",           "co2_surf",           "atmos_level", "all", .true.,  "none", 2
"flux",                       "co2_flux",           "co2_flux",           "atmos_level", "all", .true.,  "none", 2
"flux",                       "co2_mol_flux",       "co2_mol_flux",       "atmos_level", "all", .true.,  "none", 2
"flux",                       "co2_atm_dvmr",       "co2_atm_dvmr",       "atmos_level", "all", .true.,  "none", 2
"flux",                       "co2_surf_dvmr",      "co2_surf_dvmr",      "atmos_level", "all", .true.,  "none", 2
DIAGTABLE_EOF

endif
      ]]></csh>

      <csh type="always"><![CDATA[
####COMMON ALWAYS CSH BEGINS######
# MOM6 restart switch
if ( $ireload == 1 ) then
 if ( $irun == 1 ) then
  set restart_flag = 'n'
 else
  set restart_flag = 'r'
 endif
else
  set restart_flag = 'r'
endif

# adjustment of dry mass first time only
set adjust_dry_mass = ".true."
if (-e $work/INPUT/coupler.res) then
   set t1 = (`grep "Model start time"   $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   set t2 = (`grep "Current model time" $work/INPUT/coupler.res | awk '{print $1,$2,$3,$4,$5,$6}'`)
   foreach i (1 2 3 4 5 6)
      if ( $t1[$i] != $t2[$i] ) then
         set adjust_dry_mass = ".false."
         break   
      endif      
   end
endif

cat > $work/INPUT/MOM_override << OVERRIDE_EOF
#override RESTORE_SALINITY = False
#override ADJUST_NET_FRESH_WATER_TO_ZERO = False
#override ENERGYSAVEDAYS = 73.0
#override USE_OCMIP2_CFC = False

OVERRIDE_EOF

####COMMON ALWAYS CSH ENDS######

grep "ADDITIONAL 1860 TRACERS" $work/field_table
if ( "$status" == "1") then

cat >> $work/field_table << FIELDTABLE_EOF
# ADDITIONAL 1860 TRACERS
# CO2 tracer
## Note: atm transport and land model expect moist mmr. 
##       set co2 units: kg/kg  (mass mixing ratio) for both atm and lnd field table entries.
##       convert atm IC field table entry from dry vmr value to **dry** mmr
## Note: for atm cold start from constant co2 value, instead of using field table to initialize co2,
##       create atmos_tracers.res.nc with co2 moist mmr values
##
 "TRACER", "atmos_mod",    "co2"
           "longname",     "carbon dioxide"
           "units",        "kg/kg"
           "convection",   "all"
           "profile_type","fixed","surface_value = 434.5626E-06"/
#
 "TRACER", "land_mod",     "co2"
           "longname",     "carbon dioxide"
           "units",        "kg/kg" /
FIELDTABLE_EOF

endif

      ]]></csh>

      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data_1deg']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data_1deg']/input/node())"/>

    </input>

    <runtime>
      <production simTime="$(EXP_CLIMO_LEN)" units="years" npes="1878" runTime="12:00:00">
        <segment simTime="12" units="months" runTime="03:00:00"/>
      </production>
      <regression name="basic">
        <run days="10" npes="900" runTimePerJob="01:20:00"/><!---->
      </regression>

      <regression name="rts"> <!--fits on t1-->
        <run days="5 5" npes="900" runTimePerJob="01:20:00"/><!---->
      </regression>

      <regression name="restarts">
        <run days="5 5" npes="900" runTimePerJob="01:20:00"/><!---->
      </regression>

      <reference restart="$(REFERENCE)/archive/1x0m10d_900pe/restart/00010111.tar"/>

    </runtime>

    <postProcess>
      <xi:include xpointer="xpointer(//experiment[@name='c96_climo_postprocess']/postProcess/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='OM4_postprocess']/postProcess/node())"/>
    </postProcess>

  </experiment>


<experiment name="CM4i_c96L48_am4a1r1_1pct-co2-2X" inherit="CM4i_c96L48_am4a1r1_1860forc">

  <input>

      <dataTable>
"ATM" , "co2_dvmr_restore", "CO2",     "INPUT/co2_data.nc", .false.,  1.0e-06
"ATM" , "co2_dvmr_rad",     "CO2",     "INPUT/co2_data.nc", .false.,  1.0e-06
      </dataTable>

      <namelist name="atmos_co2_nml">
       do_co2_restore = .true.               
       restore_tscale = 3.1536e7,
       restore_klimit = 24
       co2_radiation_override = .true.
       do_co2_emissions = .false.
      </namelist>

      <namelist name="icebergs_nml">
        really_debug=.FALSE.
        debug=.FALSE.
        verbose=.FALSE.
        verbose_hrs=7200
        use_operator_splitting=.TRUE.
        bergy_bit_erosion_fraction=0.0
        sicn_shift=0.1
        parallel_reprod=.TRUE.
        traj_sample_hrs=0
        add_weight_to_ocean=.false.
        vel_lim = 1.e4
        accel_lim = 1.e4
      </namelist>

      <namelist name="radiation_driver_nml">
        rad_time_step= 10800,
        time_varying_solar_constant = .false.,
        solar_dataset_entry = 1860,1,1,0,0,
        rad_package = 'sea_esf',
        do_clear_sky_pass=.true.,
        calc_hemi_integrals = .false.,
        renormalize_sw_fluxes=.true.,
        all_step_diagnostics = .true.,
        zenith_spec = 'diurnally_varying',
        use_co2_tracer_field = .true.,
        using_restart_file = .false.
      </namelist>

      <namelist name="radiative_gases_nml">
        verbose = 3
        gas_printout_freq = 240

        time_varying_co2 = .false.,
        co2_variation_type = 'linear',
        co2_dataset_entry = 1860,1,1,0,0,
        co2_specification_type = 'base_and_trend',
        co2_floor = 100.0E-06,
        co2_ceiling = 1600.0E-06,
        co2_data_source = 'predicted'

        time_varying_ch4 = .false.,
        ch4_variation_type = 'linear'
        ch4_dataset_entry = 1860,1,1,0,0,
        ch4_specification_type = 'time_series'
        ch4_data_source = 'input'

        time_varying_n2o = .false.,
        n2o_variation_type = 'linear'
        n2o_dataset_entry = 1860,1,1,0,0,
        n2o_specification_type = 'time_series'
        n2o_data_source = 'input'

        time_varying_f11 = .false.,
        f11_variation_type = 'linear'
        f11_dataset_entry = 1860,1,1,0,0,
        f11_specification_type = 'time_series'
        f11_data_source = 'input'

        time_varying_f12 = .false.,
        f12_variation_type = 'linear'
        f12_dataset_entry = 1860,1,1,0,0,
        f12_specification_type = 'time_series'
        f12_data_source = 'input'

        time_varying_f113 = .false.,
        f113_variation_type = 'linear'
        f113_dataset_entry = 1860,1,1,0,0,
        f113_specification_type = 'time_series'
        f113_data_source = 'input'

        time_varying_f22 = .false.,
        f22_variation_type = 'linear'
        f22_dataset_entry = 1860,1,1,0,0,
        f22_specification_type = 'time_series'
        f22_data_source = 'input'
      </namelist>

      <dataFile label="initCond" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">/lustre/f1/unswept/John.Krasting/cwg/IC/CM4i_c96L48_am4a1r1_1pct-co2-2X_00010101_20141021.tar</dataSource>
      </dataFile>

      <xi:include xpointer="xpointer(//experiment[@name='common_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_data_1deg']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='c96_coupled_domain_decomp']/input/node())"/>

      <!-- Time Mean Volcanic Aerosol Forcing:  From Larry Horowitz -->
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/volcano/mean_hist/asmsw_data.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/volcano/mean_hist/extlw_data.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/volcano/mean_hist/extsw_data.nc</dataSource>
      </dataFile>
      <dataFile label="input" target="INPUT/" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/volcano/mean_hist/omgsw_data.nc</dataSource>
      </dataFile>

      <!-- Ozone Climatology File From CM3 -->
      <dataFile label="input" target="INPUT/o3.climatology.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/ozone/CM3_mean_o3_climatology_accmip_1860.nc</dataSource>
      </dataFile>

      <!-- Mean Solar Cycle 1856 to 1866:  From Dan Schwarzkopf and Larry Horowitz -->
      <dataFile label="input" target="INPUT/lean_solar_spectral_data.dat" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">$(CWG_HOME)/input/solar/CMIP5_1856_1866avg_monthly_data_b18_TIM</dataSource>
      </dataFile>

      <dataFile label="input" target="INPUT/co2_data.nc" chksum="" size="" timestamp="">
        <dataSource platform="$(platform)">/lustre/f1/pdata/esm/ipcc_ar5/datasets/forcings/co2_data.1PctTo2X.nc</dataSource>
      </dataFile>

      <csh type="always"><![CDATA[
grep "ADDITIONAL 1860 DIAGNOSTICS" $work/diag_table

if ( "$status" == "1") then
cat >> $work/diag_table << DIAGTABLE_EOF
#ADDITIONAL 1860 DIAGNOSTICS
"atmos_level",                 1,  "months", 1, "days", "time",
"atmos_co2",                  "pwt",                "pwt",                "atmos_level", "all", .true.,  "none", 2
"atmos_co2_restoring",        "co2_restore",        "co2_restore",        "atmos_level", "all", .true.,  "none", 2
"dynamics",                   "area",               "area",               "atmos_level", "all", .false., "none", 2
"dynamics",                   "co2",                "co2",                "atmos_level", "all", .true.,  "none", 2
"dynamics",                   "co2_dvmr",           "co2_dvmr",           "atmos_level", "all", .true.,  "none", 2
"flux",                       "co2_atm",            "co2_atm",            "atmos_level", "all", .true.,  "none", 2
"flux",                       "co2_surf",           "co2_surf",           "atmos_level", "all", .true.,  "none", 2
"flux",                       "co2_flux",           "co2_flux",           "atmos_level", "all", .true.,  "none", 2
"flux",                       "co2_mol_flux",       "co2_mol_flux",       "atmos_level", "all", .true.,  "none", 2
"flux",                       "co2_atm_dvmr",       "co2_atm_dvmr",       "atmos_level", "all", .true.,  "none", 2
"flux",                       "co2_surf_dvmr",      "co2_surf_dvmr",      "atmos_level", "all", .true.,  "none", 2
DIAGTABLE_EOF

endif
      ]]></csh>

      <csh type="always"><![CDATA[
grep "ADDITIONAL 1860 TRACERS" $work/field_table
if ( "$status" == "1") then

cat >> $work/field_table << FIELDTABLE_EOF
# ADDITIONAL 1860 TRACERS
# CO2 tracer
## Note: atm transport and land model expect moist mmr. 
##       set co2 units: kg/kg  (mass mixing ratio) for both atm and lnd field table entries.
##       convert atm IC field table entry from dry vmr value to **dry** mmr
## Note: for atm cold start from constant co2 value, instead of using field table to initialize co2,
##       create atmos_tracers.res.nc with co2 moist mmr values
##
 "TRACER", "atmos_mod",    "co2"
           "longname",     "carbon dioxide"
           "units",        "kg/kg"
           "convection",   "all"
           "profile_type","fixed","surface_value = 434.5626E-06"/
#
 "TRACER", "land_mod",     "co2"
           "longname",     "carbon dioxide"
           "units",        "kg/kg" /
FIELDTABLE_EOF

endif
      ]]></csh>

      <!--MOM6 Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='OM4_data_1deg']/input/node())"/>
      <!--SIS Input datasets-->
      <xi:include xpointer="xpointer(//experiment[@name='SIS_data']/input/node())"/>
      <xi:include xpointer="xpointer(//experiment[@name='common_csh_blocks']/input/node())"/>

      <csh type="always"><![CDATA[
cat >> $work/INPUT/MOM_override << OVERRIDE_EOF
#override ENERGYSAVEDAYS = 73.0
#override USE_OCMIP2_CFC = False
OVERRIDE_EOF
      ]]></csh>

      <csh type="always"><![CDATA[
set restart_flag = 'r' 
      ]]></csh>

  </input>
</experiment> 
 
  <!-- OCEAN  and ICE post-processing-->
  <experiment name="OM4i_postprocess">
    <postProcess>
      <component type="ocean_snap"      start="$(ANA_CLIMO_START)" source="ocean_month_snap">
        <timeSeries freq="monthly" chunkLength="$(PP_OCEAN_CHUNK)"/>
        <timeSeries freq="monthly" chunkLength="$(PP_OCEAN_CHUNK_B)"/>
        <timeSeries freq="annual"  chunkLength="$(PP_OCEAN_CHUNK)"/>
        <timeSeries freq="annual"  chunkLength="$(PP_OCEAN_CHUNK_B)"/>
      </component>
      <component type="ocean_annual_z"  start="$(ANA_CLIMO_START)" source="ocean_annual_z">
        <timeSeries freq="annual" chunkLength="$(PP_OCEAN_CHUNK)"/>
        <timeSeries freq="annual" chunkLength="$(PP_OCEAN_CHUNK_B)"/>
        <timeAverage source="annual" interval="$(PP_OCEAN_CHUNK)" />
        <timeAverage source="annual" interval="$(PP_OCEAN_CHUNK_B)" />
      </component>
      <component type="ocean_z"         start="$(ANA_CLIMO_START)" source="ocean_month_z">
        <timeSeries freq="monthly" chunkLength="$(PP_OCEAN_CHUNK)" source="ocean_month_z"/>
        <timeSeries freq="annual"  chunkLength="$(PP_OCEAN_CHUNK)" source="ocean_month_z"/>
      </component>

      <component type="ocean_scalar_month" start="$(ANA_CLIMO_START)" source="ocean_scalar_month">
        <timeSeries freq="monthly" chunkLength="$(PP_OCEAN_CHUNK)"   />
        <timeSeries freq="monthly" chunkLength="$(PP_OCEAN_CHUNK_B)" />
      </component>

      <component type="ocean_scalar_annual" start="$(ANA_CLIMO_START)" source="ocean_scalar_annual">
        <timeSeries freq="annual" chunkLength="$(PP_OCEAN_CHUNK)"   />
        <timeSeries freq="annual" chunkLength="$(PP_OCEAN_CHUNK_B)" />
      </component>

    </postProcess>
  </experiment> 

      
  <experiment name="OM4_postprocess">
    <postProcess>
        <csh><![CDATA[
	 #Take care of iceberg restarts and trajectories
         cd $work/RESTART
         ncrcat icebergs.res.nc.* icebergs.res.nc
         rm -f icebergs.res.nc.*
         cd $work
         ncrcat iceberg_trajectories.nc.* iceberg_trajectories.nc
         rm -f iceberg_trajectories.nc.* 
         #Save the last line of timestats without the first (step number) column as a signature of MOM6 answers
         tail -1 timestats | cut -c8- > RESTART/$enddate.timestats.res
         #Save the whole timestats under ascii/
         mv timestats $enddate.timestats
         mv timestats.nc $enddate.timestats.nc

         #Make a directory to trick FRE to pick up and archive in ascii
         mkdir extra.results

         mv *velocity_truncations CPU_stats MOM_parameter_doc* extra.results/

         ]]></csh>
      <!--REFINE DIAG SCRIPT -->
      <!--refineDiag_data_stager.csh calculates global averages of basic quantities and stores them in a sqlit database file-->
      <!--By default a refineDiag script causes the annual history files to be unpacked and saved in /ptmp/$USER-->
      <refineDiag script="$(NB_ROOT)/mom6/tools/analysis/refineDiag_data_stager.csh"/>

      <component type="ocean_monthly"   start="$(ANA_CLIMO_START)" source="ocean_month">
        <timeSeries freq="monthly" chunkLength="$(PP_OCEAN_CHUNK)" source="ocean_month">
          <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(NB_ROOT)/mom6/examples/ocean_SIS/OM4_025/ocn_monthly.frepp"/>
        </timeSeries>

        <timeAverage source="monthly" interval="$(PP_OCEAN_CHUNK)" >
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.ocean.csh"/>
	</timeAverage>
        <timeAverage source="monthly" interval="$(PP_OCEAN_CHUNK_B)" >
	  <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="/home/fms/local/opt/fre-analysis/test/eem/code/pcmdi_metrics/frepp.pcmdi_metrics.ocean.csh"/>
	</timeAverage>
      </component>

      <component type="ocean_annual"    start="$(ANA_CLIMO_START)"  source="ocean_annual">
        <timeAverage source="annual"  interval="$(PP_OCEAN_CHUNK_B)"/>
        <timeAverage source="annual"  interval="$(PP_OCEAN_CHUNK)">
          <analysis switch="$(ANALYSIS_SWITCH)" cumulative="no" script="$(NB_ROOT)/mom6/examples/ocean_SIS/OM4_025/ocn_annual.frepp"/>
        </timeAverage>
      </component>

      <component type="ice"  start="$(ANA_CLIMO_START)"  source="ice_month">
        <timeSeries freq="monthly" chunkLength="$(PP_OCEAN_CHUNK)"  source="ice_month">
	   <analysis switch="$(ANALYSIS_SWITCH)" startYear="$(ANA_CLIMO_START)" script="$(NB_ROOT)/mom6/tools/analysis/Krasting-SeaIce.csh"/>
	</timeSeries>   
        <timeAverage source="annual"  interval="$(PP_OCEAN_CHUNK)"/>
        <timeAverage source="annual"  interval="$(PP_OCEAN_CHUNK_B)"/>
      </component>
      
      <!--The following mdbi_logger component is a trial to make the db ingestor run when the yearly data arrives
          in order to update the "Monitoring" section of the DB.
          The intention was not to do anything besides that update. We do not really want an annual timeseries.
          But unfortunately frepp still tries to create a timeseries. -->
      <component type="mdbi_logger"   start="$(ANA_CLIMO_START)" source="ocean_annual">
        <timeSeries freq="annual"  chunkLength="1yr" source="ocean_annual">
         <variables>salt_flux</variables>
         <analysis switch="on" cumulative="no" script="$FRE_CURATOR_HOME/share/bin/database_ingestor.csh"/>
        </timeSeries>
      </component>

    </postProcess>
  </experiment> 


 
 </experimentSuite>


